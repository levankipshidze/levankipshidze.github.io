!function(t){function e(e){for(var n,r,o=e[0],a=e[1],s=0,u=[];s<o.length;s++)r=o[s],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&u.push(i[r][0]),i[r]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n]);for(l&&l(e);u.length;)u.shift()()}var n={},i={1:0};function r(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.e=function(t){var e=[],n=i[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise((function(e,r){n=i[t]=[e,r]}));e.push(n[2]=o);var a,s=document.createElement("script");s.charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.src=function(t){return r.p+""+({0:"Axl",3:"audioworkletaudio"}[t]||t)+".js"}(t);var l=new Error;a=function(e){s.onerror=s.onload=null,clearTimeout(u);var n=i[t];if(0!==n){if(n){var r=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src;l.message="Loading chunk "+t+" failed.\n("+r+": "+o+")",l.name="ChunkLoadError",l.type=r,l.request=o,n[1](l)}i[t]=void 0}};var u=setTimeout((function(){a({type:"timeout",target:s})}),12e4);s.onerror=s.onload=a,document.head.appendChild(s)}return Promise.all(e)},r.m=t,r.c=n,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/blob-opera/",r.oe=function(t){throw console.error(t),t};var o=self.webpackJsonp=self.webpackJsonp||[],a=o.push.bind(o);o.push=e,o=o.slice();for(var s=0;s<o.length;s++)e(o[s]);var l=a;r(r.s=42)}([function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"j",(function(){return a})),n.d(e,"m",(function(){return s})),n.d(e,"l",(function(){return l})),n.d(e,"a",(function(){return u})),n.d(e,"k",(function(){return c})),n.d(e,"g",(function(){return h})),n.d(e,"i",(function(){return f})),n.d(e,"h",(function(){return p})),n.d(e,"f",(function(){return m})),n.d(e,"c",(function(){return g})),n.d(e,"e",(function(){return v})),n.d(e,"d",(function(){return b}));var i=n(2),r=n(1);function o(t,e,n){return Math.min(Math.max(t,e),n)}function a(t,e,n){return o((n-t)/(e-t),0,1)}function s(t,e,n){var i=o((n-t)/(e-t),0,1);return i*i*(3-2*i)}function l(t,e,n){return(1-n)*t+n*e}function u(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}function c(t){return 440*Math.pow(2,(t-69)/12)}function h(t){return 12*Math.log2(t/440)+69}function f(t){return t===r.b.a||t===r.b.e||t===r.b.i||t===r.b.o||t===r.b.u}var d=[0,0,0];function p(t,e,n,r,o){var a=i.a.dot(n,o),s=i.a.dot(i.a.subtract(d,e,r),n)/a;return i.a.add(t,r,i.a.multiplyByScalar(d,o,s)),t}function m(t,e){for(var n=[],i=0;i<t;++i)n.push(e);return n}function g(t,e,n){for(var r=[],o=0;o<t.length;++o)r.push([0,0,0]);var a=function(e){return[t[3*e+0],t[3*e+1],t[3*e+2]*n]};for(o=0;o<e.length/3;++o){var s=e[3*o+0],l=e[3*o+1],u=e[3*o+2],c=a(s),h=a(l),f=a(u),d=i.a.cross([],i.a.subtract([],h,c),i.a.subtract([],f,c));i.a.add(r[s],r[s],d),i.a.add(r[l],r[l],d),i.a.add(r[u],r[u],d)}for(o=0;o<r.length;++o)i.a.normalize(r[o],r[o]);var p=[];for(o=0;o<r.length;++o)p.push(r[o][0]),p.push(r[o][1]),p.push(r[o][2]);return p}function v(t){return Math.PI*t/180}function b(t,e){new Uint8Array(e).set(new Uint8Array(t))}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return l}));var i,r={spectralMin:-128.68316134071944,spectralMax:19,aperiodicMin:-35.112804058126855,aperiodicMax:13877787807814457e-33};function o(t){return t===i.a?"a":t===i.e?"e":t===i.i?"i":t===i.o?"o":t===i.u?"u":void 0}!function(t){t[t.i=0]="i",t[t.a=1]="a",t[t.e=2]="e",t[t.o=3]="o",t[t.sil=4]="sil",t[t.r=5]="r",t[t.n=6]="n",t[t.l=7]="l",t[t.t=8]="t",t[t.s=9]="s",t[t.d=10]="d",t[t.u=11]="u",t[t.m=12]="m",t[t.p=13]="p",t[t.v=14]="v",t[t.ch=15]="ch",t[t.c=16]="c",t[t.f=17]="f",t[t.j=18]="j",t[t.b=19]="b",t[t.h=20]="h",t[t.g=21]="g",t[t.qu=22]="qu",t[t.sh=23]="sh",t[t.ny=24]="ny",t[t.y=25]="y",t[t.sk=26]="sk",t[t.z=27]="z",t[t.tz=28]="tz"}(i||(i={}));for(var a=[],s=0;s<29;++s)a[s]=s===i.t||s===i.s||s===i.p||s===i.v||s===i.ch||s===i.c||s===i.f||s===i.j||s===i.h||s===i.g||s===i.qu||s===i.sh||s===i.sk||s===i.z||s===i.tz;function l(t){return a[t]}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(6);function r(t,e,n){return Math.min(Math.max(t,e),n)}var o={set:function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},clone:function(t){return[t[0],t[1],t[2]]},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},scaleAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},cross:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[0],s=n[1],l=n[2];return t[0]=r*l-o*s,t[1]=o*a-i*l,t[2]=i*s-r*a,t},coneClamp:function(t,e,n,r){if(o.dot(e,n)<-.9999)return t;var a=Math.acos(o.dot(e,n));if(a>r){var s=o.normalize([],o.cross([],n,e)),l=i.a.fromAxisAngle([],s,a-r);return o.multiplyByQuaternion(t,n,l),t}return t},rotateTowards:function(t,e,n,r){var a=Math.acos(o.dot(e,n));r>a&&(r=a);var s=o.normalize([],o.cross([],e,n)),l=i.a.fromAxisAngle([],s,r);return o.multiplyByQuaternion(t,e,l),t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},multiply:function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},addList:function(t,e){t[0]=0,t[1]=0,t[2]=0;for(var n=0;n<e.length;++n)t[0]+=e[n][0],t[1]+=e[n][1],t[2]+=e[n][2];return t},subtract:function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},multiplyByScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},multiplyByQuaternion:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=n[3],s=n[0],l=n[1],u=n[2],c=a*i+l*o-u*r,h=a*r+u*i-s*o,f=a*o+s*r-l*i,d=-s*i-l*r-u*o;return t[0]=d*-s+c*a+h*-u-f*-l,t[1]=d*-l+h*a+f*-s-c*-u,t[2]=d*-u+f*a+c*-l-h*-s,t},normalize:function(t,e){var n=e[0],i=e[1],r=e[2],o=1/Math.sqrt(n*n+i*i+r*r);return t[0]=n*o,t[1]=i*o,t[2]=r*o,t},distance:function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)},distance2:function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r},length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},mix:function(t,e,n,i){return t[0]=(1-i)*e[0]+i*n[0],t[1]=(1-i)*e[1]+i*n[1],t[2]=(1-i)*e[2]+i*n[2],t},linearMix:function(t,e,n,i){for(var r=0;r<3;++r)e[r]<n[r]?t[r]=Math.min(e[r]+i[r],n[r]):e[r]>n[r]?t[r]=Math.max(e[r]-i[r],n[r]):t[r]=n[r]},clampedMix:function(t,e,n,i,r){var a=o.subtract([],n,e),s=o.length(a),l=Math.min(s*i,r);l>0?o.add(t,e,o.multiplyByScalar([],a,l/s)):(t[0]=n[0],t[1]=n[1],t[2]=n[2]),o.multiplyByScalar(a,a,i)},clamp:function(t,e,n,i){return t[0]=r(e[0],n[0],i[0]),t[1]=r(e[1],n[1],i[1]),t[2]=r(e[2],n[2],i[2]),t},slerp:function(t,e,n,i){var a=o.dot(e,n);a=r(a,0,1);for(var s=Math.acos(a)*i,l=o.subtract([],n,o.multiplyByScalar([],e,a)),u=0;u<3;++u)t[u]=e[u]*Math.cos(s)+l[u]*Math.sin(s);return t},pow:function(t,e,n){return t[0]=Math.pow(e[0],n),t[1]=Math.pow(e[1],n),t[2]=Math.pow(e[2],n),t},hsvToRGB:function(t,e){var n=e[0],i=e[1],r=e[2],o=6*(n%=1),a=(e=r*i)*(1-Math.abs(o%2-1)),s=Math.floor(o),l=[e,a,0,0,a,e][s],u=[a,e,e,a,0,0][s],c=[0,0,a,e,e,a][s],h=r-e;return l+=h,u+=h,c+=h,t[0]=l,t[1]=u,t[2]=c,t},rgbToHSV:function(t,e){var n,i,r,o,a,s=e[0],l=e[1],u=e[2],c=Math.max(s,l,u),h=c-Math.min(s,l,u),f=function(t){return(c-t)/6/h+.5};return 0==h?o=a=0:(a=h/c,n=f(s),i=f(l),r=f(u),s===c?o=r-i:l===c?o=1/3+n-r:u===c&&(o=2/3+i-n),o<0?o+=1:o>1&&(o-=1)),t[0]=o,t[1]=a,t[2]=c,t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(0);function r(t){return t}var o=function(){function t(t,e){void 0===e&&(e=r),this.fromValue=t,this.targetValue=t,this.smoothingFunction=e,this.tweenDuration=1,this.tweenStartTime=-99999}return t.prototype.change=function(t,e,n){void 0===n&&(n=0),t!==this.targetValue&&(this.fromValue=this.evaluate(),this.targetValue=t,this.tweenDuration=1e3*e,this.tweenStartTime=Date.now()+1e3*n)},t.prototype.evaluate=function(){if(0===this.tweenDuration)return this.targetValue;var t=this.smoothingFunction(Object(i.j)(this.tweenStartTime,this.tweenStartTime+this.tweenDuration,Date.now()));return Object(i.l)(this.fromValue,this.targetValue,t)},t}()},function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));var i=function(){function t(t,e){this.module=t,this.pointer=this.module._malloc(4*e),this.length=e}return t.prototype.getArray=function(){return this.module.HEAPU32.subarray(this.pointer>>2,(this.pointer>>2)+this.length)},t}(),r=function(){function t(t,e){this.module=t,this.pointer=this.module._malloc(4*e),this.length=e}return t.prototype.getArray=function(){return this.module.HEAPF32.subarray(this.pointer>>2,(this.pointer>>2)+this.length)},t}()},function(t,e,n){"use strict";function i(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(t){var n=i.response;n&&e(n)},i.send(null)}))}function r(t){return new Promise((function(e,n){var i=document.createElement("img");i.onload=function(){e(i)},i.src=t}))}function o(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){e(JSON.parse(i.responseText))},i.send(null)}))}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i={identity:function(){return[0,0,0,1]},makeIdentity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},length:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]},invert:function(t,e){var n=1/(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return t[0]=-e[0]*n,t[1]=-e[1]*n,t[2]=-e[2]*n,t[3]=e[3]*n,t},multiply:function(t,e,n){var i=e[0],r=e[1],o=e[2],a=e[3],s=n[0],l=n[1],u=n[2],c=n[3];return t[0]=s*i-l*r-u*o-c*a,t[1]=s*r+l*i+u*a-c*o,t[2]=s*o-l*a+u*i+c*r,t[3]=s*a+l*o-u*r+c*i,t},normalize:function(t,e){var n=1/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]);return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},fromAxisAngle:function(t,e,n){return t[0]=e[0]*Math.sin(n/2),t[1]=e[1]*Math.sin(n/2),t[2]=e[2]*Math.sin(n/2),t[3]=Math.cos(n/2),t},slerp:function(t,e,n,r){var o,a,s,l,u,c=e[0],h=e[1],f=e[2],d=e[3],p=n[0],m=n[1],g=n[2],v=n[3];return(a=c*p+h*m+f*g+d*v)<0&&(a=-a,p=-p,m=-m,g=-g,v=-v),1-a>1e-6?(o=Math.acos(a),s=Math.sin(o),l=Math.sin((1-r)*o)/s,u=Math.sin(r*o)/s):(l=1-r,u=r),t[0]=l*c+u*p,t[1]=l*h+u*m,t[2]=l*f+u*g,t[3]=l*d+u*v,i.normalize(t,t),t}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i=function(){function t(t){this.buffer=t,this.floatView=new Float32Array(t),this.intView=new Int32Array(t)}return t.prototype.setId=function(t){this.intView[0]=t},t.prototype.getId=function(){return this.intView[0]},t.prototype.setPhoneme=function(t){this.intView[1]=t},t.prototype.getPhoneme=function(){return this.intView[1]},t.prototype.setPreviousPhoneme=function(t){this.intView[2]=t},t.prototype.getPreviousPhoneme=function(){return this.intView[2]},t.prototype.setNextPhoneme=function(t){this.intView[3]=t},t.prototype.getNextPhoneme=function(){return this.intView[3]},t.prototype.setPhonemePosition=function(t){this.floatView[4]=t},t.prototype.getPhonemePosition=function(){return this.floatView[4]},t.prototype.setF0=function(t){this.floatView[5]=t},t.prototype.getF0=function(){return this.floatView[5]},t.prototype.setSingerIndex=function(t){this.intView[6]=t},t.prototype.getSingerIndex=function(){return this.intView[6]},t.prototype.setMidiNote=function(t){this.floatView[7]=t},t.prototype.getMidiNote=function(){return this.floatView[7]},t.prototype.setVowel=function(t){this.intView[8]=t},t.prototype.getVowel=function(){return this.intView[8]},t.prototype.setMuted=function(t){this.intView[9]=t?1:0},t.prototype.getMuted=function(){return 0!==this.intView[9]},t.prototype.setControlled=function(t){this.intView[10]=t?1:0},t.prototype.getControlled=function(){return 0!==this.intView[10]},t.prototype.getAperiodic=function(){return this.floatView.subarray(11,15)},t.getSizeBytes=function(){return 60},t.isExcitationFrame=function(e){return e.byteLength===t.getSizeBytes()},t}()},function(t,e,n){"use strict";function i(t){return"/blob-opera/"+t}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";(function(t){var i=e;function r(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;++r)void 0!==t[i[r]]&&n||(t[i[r]]=e[i[r]]);return t}function o(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}i.asPromise=n(20),i.base64=n(21),i.EventEmitter=n(22),i.float=n(23),i.inquire=n(24),i.utf8=n(25),i.pool=n(26),i.LongBits=n(27),i.isNode=Boolean(void 0!==t&&t&&t.process&&t.process.versions&&t.process.versions.node),i.global=i.isNode&&t||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},i.isString=function(t){return"string"==typeof t||t instanceof String},i.isObject=function(t){return t&&"object"==typeof t},i.isset=i.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var t=i.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(t){return"number"==typeof t?i.Buffer?i._Buffer_allocUnsafe(t):new i.Array(t):i.Buffer?i._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(t){return t?i.LongBits.from(t).toHash():i.LongBits.zeroHash},i.longFromHash=function(t,e){var n=i.LongBits.fromHash(t);return i.Long?i.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},i.merge=r,i.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},i.newError=o,i.ProtocolError=o("ProtocolError"),i.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},i.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var t=i.Buffer;t?(i._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},i._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}).call(this,n(14))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var i=function(){function t(t){this.buffer=t,this.floatView=new Float32Array(t),this.intView=new Int32Array(t)}return t.prototype.setId=function(t){this.intView[0]=t},t.prototype.getId=function(){return this.intView[0]},t.prototype.setPhoneme=function(t){this.intView[1]=t},t.prototype.getPhoneme=function(){return this.intView[1]},t.prototype.setPreviousPhoneme=function(t){this.intView[2]=t},t.prototype.getPreviousPhoneme=function(){return this.intView[2]},t.prototype.setNextPhoneme=function(t){this.intView[3]=t},t.prototype.getNextPhoneme=function(){return this.intView[3]},t.prototype.setPhonemePosition=function(t){this.floatView[4]=t},t.prototype.getPhonemePosition=function(){return this.floatView[4]},t.prototype.setF0=function(t){this.floatView[5]=t},t.prototype.getF0=function(){return this.floatView[5]},t.prototype.setSingerIndex=function(t){this.intView[6]=t},t.prototype.getSingerIndex=function(){return this.intView[6]},t.prototype.setMidiNote=function(t){this.floatView[7]=t},t.prototype.getMidiNote=function(){return this.floatView[7]},t.prototype.setVowel=function(t){this.intView[8]=t},t.prototype.getVowel=function(){return this.intView[8]},t.prototype.setMuted=function(t){this.intView[9]=t?1:0},t.prototype.getMuted=function(){return 0!==this.intView[9]},t.prototype.setControlled=function(t){this.intView[10]=t?1:0},t.prototype.getControlled=function(){return 0!==this.intView[10]},t.prototype.getSpectral=function(){return this.floatView.subarray(11,269)},t.prototype.setSubsteps=function(t){this.intView[269]=t},t.prototype.getSubsteps=function(){return this.intView[269]},t.prototype.setSendTime=function(t){this.floatView[270]=t},t.prototype.getSendTime=function(){return this.floatView[270]},t.getSizeBytes=function(){return 1084},t.isSpectralFrame=function(e){return e.byteLength===t.getSizeBytes()},t}()},function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a}));var i=n(0);function r(t,e,n,r){var o,a=-3*Math.abs(Math.log2(e/Object(i.b)(t,1,16e3)))/n;return((o=a+100)>0?Math.pow(10,(o-100)/20):0)*r}function o(t){for(var e=[],n=0;n<60;++n)e.push(0);for(var i=function(t,e,n){for(var i=[],r=e/2/(t-1),o=0;o<t;++o){var a=o*r,s=2*Math.PI*a/e,l=-n,u=Math.atan2((1-l*l)*Math.sin(s),(1+l*l)*Math.cos(s)-2*l);i.push(u/(2*Math.PI)*e)}return i[t-1]=e/2,i}(60,32e3,.45),o=0,a=t;o<a.length;o++){var s=a[o];for(n=0;n<60;++n)e[n]+=r(i[n],s.centreFrequencyHz,s.bandwidthOctaves,s.gainDB)}return e}var a={forceScriptProcessor:!0,scriptProcessorBufferSize:4096,frameHopSeconds:.005,excitationOffset:0,targetFFTSize:512,spectralSingerMappings:[[1,0,0,0,0,0],[.1,.5,0,0,1,0],[0,0,0,1,0,0],[0,0,0,1,0,0]],aperiodicSingerMappings:[[1,0,0,0,0,0],[.1,.5,0,0,1,0],[0,0,0,1,0,0],[0,0,0,1,0,0]],pitchStops:[[62,72,80],[59,68,74],[48,58,65],[43,52,60]],gains:[[1.883,1.6947,2.4479,1.5064],[1.883,1.6947,2.4479,1.5064],[1.883,1.6947,2.4479,1.5064],[1.883,1.6947,2.4479,1.5064]],pans:[[-23,-6,17,28],[0,-14,14,28],[0,0,-14,14],[0,0,0,0]],jitterScale:1,aperiodicGain:{vowel:[[-15,-9,-6,0,-9,-15],[-3,0,0,0,-3,-6],[0,0,0,0,0,0],[0,0,0,0,0,0]],consonant:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]},periodicGain:{vowel:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]],consonant:[[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0],[0,0,0,0,0,0]]},spectralFilters:[[{centreFrequencyHz:459,bandwidthOctaves:4,gainDB:-4.4},{centreFrequencyHz:1640,bandwidthOctaves:2.6,gainDB:4.4},{centreFrequencyHz:15e3,bandwidthOctaves:4,gainDB:-2.8}],[{centreFrequencyHz:87.8,bandwidthOctaves:3,gainDB:-7.4},{centreFrequencyHz:275.5,bandwidthOctaves:2.15,gainDB:6.8},{centreFrequencyHz:3263,bandwidthOctaves:2,gainDB:-2.2}],[{centreFrequencyHz:72,bandwidthOctaves:4,gainDB:-6.8},{centreFrequencyHz:874.3,bandwidthOctaves:2.18,gainDB:4.8},{centreFrequencyHz:2212,bandwidthOctaves:3.68,gainDB:-3.4}],[{centreFrequencyHz:225.7,bandwidthOctaves:2.95,gainDB:5.2},{centreFrequencyHz:1031.6,bandwidthOctaves:2,gainDB:-4.8},{centreFrequencyHz:2558.2,bandwidthOctaves:3.02,gainDB:1.8}]],reverb:{mix:.6,feedback:.88,lowcut:3e-4,highcut:.741,crossfreq:.833,predelay_ms:0,modamount:.008,modtime:.666},noiseExcitation:!1,onlySpectralGain:!1}},function(t,e,n){"use strict";t.exports=n(19)},function(t,e,n){"use strict";t.exports=h;var i,r=n(9),o=r.LongBits,a=r.base64,s=r.utf8;function l(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function u(){}function c(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var f=function(){return r.Buffer?function(){return(h.create=function(){return new i})()}:function(){return new h}};function d(t,e,n){e[n]=255&t}function p(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function g(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=f(),h.alloc=function(t){return new r.Array(t)},r.Array!==Array&&(h.alloc=r.pool(h.alloc,r.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new l(t,e,n),this.len+=e,this},p.prototype=Object.create(l.prototype),p.prototype.fn=function(t,e,n){for(;t>127;)e[n++]=127&t|128,t>>>=7;e[n]=t},h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new p((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(m,10,o.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=o.from(t);return this._push(m,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=o.from(t).zzEncode();return this._push(m,e.length(),e)},h.prototype.bool=function(t){return this._push(d,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(g,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=o.from(t);return this._push(g,4,e.lo)._push(g,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(r.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(r.float.writeDoubleLE,8,t)};var v=r.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var i=0;i<t.length;++i)e[n+i]=t[i]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(d,1,0);if(r.isString(t)){var n=h.alloc(e=a.length(t));a.decode(t,n,0),t=n}return this.uint32(e)._push(v,e,t)},h.prototype.string=function(t){var e=s.length(t);return e?this.uint32(e)._push(s.write,e,t):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){i=t,h.create=f(),i._configure()}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";t.exports=l;var i,r=n(9),o=r.LongBits,a=r.utf8;function s(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function l(t){this.buf=t,this.pos=0,this.len=t.length}var u,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new l(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new l(t);throw Error("illegal buffer")},h=function(){return r.Buffer?function(t){return(l.create=function(t){return r.Buffer.isBuffer(t)?new i(t):c(t)})(t)}:c};function f(){var t=new o(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw s(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw s(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw s(this,8);return new o(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=h(),l.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,l.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return u;if(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return u;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return u}),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var t=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},l.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var t=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},l.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw s(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},l.prototype.string=function(){var t=this.bytes();return a.read(t,0,t.length)},l.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw s(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},l._configure=function(t){i=t,l.create=h(),i._configure();var e=r.Long?"toLong":"toNumber";r.merge(l.prototype,{int64:function(){return f.call(this)[e](!1)},uint64:function(){return f.call(this)[e](!0)},sint64:function(){return f.call(this).zzDecode()[e](!1)},fixed64:function(){return p.call(this)[e](!0)},sfixed64:function(){return p.call(this)[e](!1)}})}},function(t,e,n){"use strict";var i=n(12),r=i.Reader,o=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.JitterTemplates=function(){function t(t){if(this.templates=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.templates=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.templates&&t.templates.length)for(var n=0;n<t.templates.length;++n)s.JitterTemplates.Template.encode(t.templates[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.JitterTemplates;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.templates&&i.templates.length||(i.templates=[]),i.templates.push(s.JitterTemplates.Template.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.templates&&t.hasOwnProperty("templates")){if(!Array.isArray(t.templates))return"templates: array expected";for(var e=0;e<t.templates.length;++e){var n=s.JitterTemplates.Template.verify(t.templates[e]);if(n)return"templates."+n}}return null},t.fromObject=function(t){if(t instanceof s.JitterTemplates)return t;var e=new s.JitterTemplates;if(t.templates){if(!Array.isArray(t.templates))throw TypeError(".JitterTemplates.templates: array expected");e.templates=[];for(var n=0;n<t.templates.length;++n){if("object"!=typeof t.templates[n])throw TypeError(".JitterTemplates.templates: object expected");e.templates[n]=s.JitterTemplates.Template.fromObject(t.templates[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.templates=[]),t.templates&&t.templates.length){n.templates=[];for(var i=0;i<t.templates.length;++i)n.templates[i]=s.JitterTemplates.Template.toObject(t.templates[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Template=function(){function t(t){if(this.values=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.values=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.values&&t.values.length){e.uint32(10).fork();for(var n=0;n<t.values.length;++n)e.float(t.values[n]);e.ldelim()}return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.JitterTemplates.Template;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:if(i.values&&i.values.length||(i.values=[]),2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)i.values.push(t.float());else i.values.push(t.float());break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.values&&t.hasOwnProperty("values")){if(!Array.isArray(t.values))return"values: array expected";for(var e=0;e<t.values.length;++e)if("number"!=typeof t.values[e])return"values: number[] expected"}return null},t.fromObject=function(t){if(t instanceof s.JitterTemplates.Template)return t;var e=new s.JitterTemplates.Template;if(t.values){if(!Array.isArray(t.values))throw TypeError(".JitterTemplates.Template.values: array expected");e.values=[];for(var n=0;n<t.values.length;++n)e.values[n]=Number(t.values[n])}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.values=[]),t.values&&t.values.length){n.values=[];for(var i=0;i<t.values.length;++i)n.values[i]=e.json&&!isFinite(t.values[i])?String(t.values[i]):t.values[i]}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t}(),t.exports=s},,function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));var i=n(0),r=n(16),o=function(){function t(t){this.templates=[];for(var e=0,n=r.JitterTemplates.decode(t).templates;e<n.length;e++){var i=n[e];this.templates.push(i.values)}this.previousTemplate=this.getRandomTemplate(),this.currentTemplate=this.getRandomTemplate(),this.currentTemplateFrame=0}return t.prototype.getRandomTemplate=function(){return this.templates[Math.floor(Math.random()*this.templates.length)]},t.prototype.next=function(){var t=0;if(this.currentTemplateFrame<10){var e=this.previousTemplate.length-1-10+this.currentTemplateFrame,n=Object(i.j)(0,10,this.currentTemplateFrame);t=Object(i.l)(this.previousTemplate[e],this.currentTemplate[this.currentTemplateFrame],n)}else t=this.currentTemplate[this.currentTemplateFrame];return this.currentTemplateFrame=this.currentTemplateFrame+1,this.currentTemplateFrame>=this.currentTemplate.length-10&&(this.previousTemplate=this.currentTemplate,this.currentTemplate=this.getRandomTemplate(),this.currentTemplateFrame=0),t},t}(),a=n(11),s=n(1),l=function(){function t(t,e){this.objects=[];for(var n=0;n<e;++n)this.objects.push(t());this.index=0}return t.prototype.next=function(){return this.index=(this.index+1)%this.objects.length,this.objects[this.index]},t.prototype.head=function(){return this.objects[this.index]},t}(),u=function(){function t(t,e,n,r,s,u){this.onFrameUsed=null,this.lastSubsteps=1,this.jitter=new o(r),this.audioParameters=u,this.synthPointer=e,this.voiceIndex=n,this.voicePointer=t._synthGetVoice(e,n),this.sampleRate=s,this.module=t,this.spectralFramePointers=new l((function(){return t._createSpectralFrame(258)}),100),this.excitationFramePointers=new l((function(){return t._createExcitationFrame(6)}),100),this.previousF0=440,this.nextExcitationFrames=[],this.nextSpectralFrames=[],this.lastOverrideFrequency=440,this.overrideF0s=[],this.overrideFrequency=!1,this.setSpectralFrameData(this.spectralFramePointers.next(),Object(i.f)(258,0),!0),this.setExcitationFrameData(this.excitationFramePointers.next(),Object(i.f)(4,-120),!0,!1);for(var c=0;c<u.excitationOffset;++c)this.setSpectralFrameData(this.spectralFramePointers.next(),Object(i.f)(258,0),!0);for(c=0;c<-u.excitationOffset;++c)this.setExcitationFrameData(this.excitationFramePointers.next(),Object(i.f)(4,-120),!0,!1);this.spectralGain=Object(a.b)(u.spectralFilters[this.voiceIndex])}return t.prototype.pushExcitationFrame=function(t){this.nextExcitationFrames.push(t)},t.prototype.pushSpectralFrame=function(t){this.nextSpectralFrames.push(t)},t.prototype.setSpectralFrameData=function(t,e,n){this.module._spectralFrameReset(t,n?1:0);if(!n)for(var i=this.module._spectralFrameGetSpectrogram(t),r=this.module.HEAPF32.subarray(i>>2,258+(i>>2)),o=0;o<258;++o)r[o]=e[o]},t.prototype.setExcitationFrameData=function(t,e,n,r){if(this.module._excitationFrameReset(t,n?1:0),!n){var o=this.module._excitationFrameGetAperiodic(t),a=this.module.HEAPF32.subarray(o>>2,6+(o>>2));a[0]=-60,a[5]=-1e-12;for(var l=0;l<4;++l)a[1+l]=s.a.aperiodicMin+(.5*e[l]+.5)*(s.a.aperiodicMax-s.a.aperiodicMin);var u=r?this.audioParameters.aperiodicGain.consonant:this.audioParameters.aperiodicGain.vowel;for(l=0;l<6;++l)a[l]+=u[this.voiceIndex][l],a[l]=Math.pow(10,a[l]/10);var c=this.module._excitationFrameGetPeriodic(t),h=this.module.HEAPF32.subarray(c>>2,6+(c>>2));h[0]=-60,h[5]=-1e-12;for(l=0;l<4;++l)h[1+l]=s.a.aperiodicMin+(.5*e[l]+.5)*(s.a.aperiodicMax-s.a.aperiodicMin);for(l=0;l<6;++l)h[l]=Math.pow(10,h[l]/10),h[l]=1-h[l];var f=r?this.audioParameters.periodicGain.consonant:this.audioParameters.periodicGain.vowel;for(l=0;l<6;++l){var d=Object(i.b)(h[l],1e-8,.999999999);d=10*Math.log10(d),d+=f[this.voiceIndex][l],h[l]=Math.pow(10,d/10)}}},t.prototype.setAudioParameters=function(t){this.audioParameters=t,this.spectralGain=Object(a.b)(t.spectralFilters[this.voiceIndex])},t.prototype.step=function(t){for(var e=0;1!==this.module._synthHasEnoughExcitationFrames(this.synthPointer,t,this.voiceIndex)||1!==this.module._synthHasEnoughSpectralFrames(this.synthPointer,t,this.voiceIndex);){var n=null;if(0!==this.nextSpectralFrames.length){var i=this.nextSpectralFrames[0];this.lastSubsteps=i.getSubsteps(),n=this.spectralFramePointers.next(),this.setSpectralFrameData(n,i.getSpectral(),i.getMuted()),this.onFrameUsed&&this.onFrameUsed(i.buffer),this.nextSpectralFrames.splice(0,1)}else n=this.spectralFramePointers.head();for(var r=0;r<this.lastSubsteps;++r)this.module._voiceAddSpectralFrame(this.voicePointer,n);for(var o=0;o<this.lastSubsteps;++o){var a=-1,l=!1;for(r=this.overrideF0s.length-1;r>=0;--r)if(e>this.overrideF0s[r].delay){a=this.overrideF0s[r].f0,this.lastOverrideFrequency=a,l=!0;break}if(!l&&this.overrideF0s.length>0&&(a=this.overrideF0s[0].f0,this.lastOverrideFrequency=a),-1===a&&(a=this.lastOverrideFrequency),this.overrideFrequency||(a=-1),0!==this.nextExcitationFrames.length){var u=(i=this.nextExcitationFrames[0]).getF0();a>0&&(u=a),this.previousF0=u;var c=u+this.jitter.next()*u*this.audioParameters.jitterScale,h=this.excitationFramePointers.next();this.setExcitationFrameData(h,i.getAperiodic(),i.getMuted(),Object(s.d)(i.getPhoneme())),this.module._voiceAddExcitationFrame(this.voicePointer,c,h),this.onFrameUsed&&this.onFrameUsed(i.buffer),this.nextExcitationFrames.splice(0,1)}else{u=this.previousF0;a>0&&(u=a),this.previousF0=u;c=u+this.jitter.next()*u*this.audioParameters.jitterScale;var f=this.excitationFramePointers.head();this.module._voiceAddExcitationFrame(this.voicePointer,c,f)}e+=this.audioParameters.frameHopSeconds}}this.overrideF0s.length=0},t.prototype.addOverrideF0=function(t,e){this.overrideF0s.push({f0:t,delay:e})},t}(),c=n(4),h=n(3);var f=function(){function t(t,e,n,i,r,o,a,s){var l=this;this.onFrameUsed=null,this.module=t,this.sampleRate=i,this.processingSampleRate=r,this.bufferSize=s;for(var f=this.module._malloc(e.length),d=this.module.HEAPU8.subarray(f,f+e.length),p=0;p<e.length;++p)d[p]=e[p];var m,g=a.frameHopSeconds,v=g,b=(m=a.targetFFTSize*this.processingSampleRate/32e3,2*Math.ceil(m/2));this.synthPointer=this.module._createSynth(this.processingSampleRate,o,g,v,b,2,4,f,e.length);this.pans=[-23,-6,17,28].map((function(t){return new h.a(t)})),this.gains=a.gains[0],this.voices=[];for(p=0;p<4;++p)this.voices.push(new u(t,this.synthPointer,p,n,this.processingSampleRate,a));for(var y=0,x=this.voices;y<x.length;y++){x[y].onFrameUsed=function(t){l.onFrameUsed&&l.onFrameUsed(t)}}this.reverbContext=t._createDCReverbContext(this.processingSampleRate);var w=t.cwrap("heavySendMessage",null,["number","string","number","number"]);for(var _ in a.reverb)w(this.reverbContext,_,a.reverb[_],0);w(this.reverbContext,"init",1,0),this.module._synthSetOnlyNoise(this.synthPointer,a.noiseExcitation?1:0),this.combinedBuffer=new c.a(t,2*this.bufferSize),this.outputBuffer=new c.a(t,2*this.bufferSize),this.lastAudioProcessTime=Date.now()}return t.prototype.setPans=function(t){for(var e=0;e<t.length;++e)this.pans[e].change(t[e],.5)},t.prototype.process=function(t,e){var n=e*this.processingSampleRate/this.sampleRate;this.module._clearBuffer(this.combinedBuffer.pointer,2*n);for(var i=0;i<this.voices.length;++i){this.voices[i].step(n);var r=this.pans[i].evaluate();r=r/180*Math.PI+Math.PI/4;var o=this.gains[i],a=Math.cos(r)*o,s=Math.sin(r)*o;this.module._voiceSetGain(this.voices[i].voicePointer,0,a),this.module._voiceSetGain(this.voices[i].voicePointer,1,s)}this.module._synthStep(this.synthPointer,n),this.module._copyBuffer(this.module._synthGetBuffer(this.synthPointer,0),this.combinedBuffer.pointer,n,0,1),this.module._copyBuffer(this.module._synthGetBuffer(this.synthPointer,1),this.combinedBuffer.pointer,n,n,1),this.module._reverbContextProcess(this.reverbContext,this.combinedBuffer.pointer,this.outputBuffer.pointer,n);for(var l=this.outputBuffer.getArray(),u=this.sampleRate/this.processingSampleRate,c=0;c<2;++c){var h=t[c],f=c*n;if(1===u)for(var d=0;d<e;++d)h[d]=l[f+d];else if(2===u)for(d=0;d<n;++d)h[2*d+0]=l[f+d],h[2*d+1]=0;else for(d=0;d<n;++d){h[d*u+0]=l[f+d];for(var p=1;p<u;++p)h[d*u+p]=0}}this.lastAudioProcessTime=Date.now()},t.prototype.addSpectralFrame=function(t,e){this.voices[t].pushSpectralFrame(e)},t.prototype.addExcitationFrame=function(t,e){this.voices[t].pushExcitationFrame(e)},t.prototype.setOverrideFrequency=function(t,e){this.voices[t].overrideFrequency=e},t.prototype.addOverrideF0=function(t,e){this.voices[t].addOverrideF0(e,(Date.now()-this.lastAudioProcessTime)/1e3)},t.prototype.benchmarkSpectrumGeneration=function(t){var e=performance.now();this.voices[0].module._synthBenchmarkSpectrumGeneration(this.voices[0].synthPointer,t);var n=performance.now();console.log(n-e)},t.prototype.setAudioParameters=function(t){this.gains=t.gains[0];var e=this.module.cwrap("heavySendMessage",null,["number","string","number","number"]);for(var n in t.reverb)e(this.reverbContext,n,t.reverb[n],0);for(var i=0;i<this.voices.length;++i)this.voices[i].setAudioParameters(t);this.module._synthSetOnlyNoise(this.synthPointer,t.noiseExcitation?1:0)},t}()},function(t,e,n){"use strict";var i=e;function r(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}i.build="minimal",i.Writer=n(13),i.BufferWriter=n(28),i.Reader=n(15),i.BufferReader=n(29),i.util=n(9),i.rpc=n(30),i.roots=n(32),i.configure=r,r()},function(t,e,n){"use strict";t.exports=function(t,e){var n=new Array(arguments.length-1),i=0,r=2,o=!0;for(;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,a){n[i]=function(t){if(o)if(o=!1,t)a(t);else{for(var e=new Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];r.apply(null,e)}};try{t.apply(e||null,n)}catch(t){o&&(o=!1,a(t))}}))}},function(t,e,n){"use strict";var i=e;i.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;--e%4>1&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};for(var r=new Array(64),o=new Array(123),a=0;a<64;)o[r[a]=a<26?a+65:a<52?a+71:a<62?a-4:a-59|43]=a++;i.encode=function(t,e,n){for(var i,o=null,a=[],s=0,l=0;e<n;){var u=t[e++];switch(l){case 0:a[s++]=r[u>>2],i=(3&u)<<4,l=1;break;case 1:a[s++]=r[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[s++]=r[i|u>>6],a[s++]=r[63&u],l=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return l&&(a[s++]=r[i],a[s++]=61,1===l&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};i.decode=function(t,e,n){for(var i,r=n,a=0,s=0;s<t.length;){var l=t.charCodeAt(s++);if(61===l&&a>1)break;if(void 0===(l=o[l]))throw Error("invalid encoding");switch(a){case 0:i=l,a=1;break;case 1:e[n++]=i<<2|(48&l)>>4,i=l,a=2;break;case 2:e[n++]=(15&i)<<4|(60&l)>>2,i=l,a=3;break;case 3:e[n++]=(3&i)<<6|l,a=0}}if(1===a)throw Error("invalid encoding");return n-r},i.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},function(t,e,n){"use strict";function i(){this._listeners={}}t.exports=i,i.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},i.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],i=0;i<n.length;)n[i].fn===e?n.splice(i,1):++i;return this},i.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,n)}return this}},function(t,e,n){"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),i=128===n[3];function r(t,i,r){e[0]=t,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function o(t,i,r){e[0]=t,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function a(t,i){return n[0]=t[i],n[1]=t[i+1],n[2]=t[i+2],n[3]=t[i+3],e[0]}function s(t,i){return n[3]=t[i],n[2]=t[i+1],n[1]=t[i+2],n[0]=t[i+3],e[0]}t.writeFloatLE=i?r:o,t.writeFloatBE=i?o:r,t.readFloatLE=i?a:s,t.readFloatBE=i?s:a}():function(){function e(t,e,n,i){var r=e<0?1:0;if(r&&(e=-e),0===e)t(1/e>0?0:2147483648,n,i);else if(isNaN(e))t(2143289344,n,i);else if(e>34028234663852886e22)t((r<<31|2139095040)>>>0,n,i);else if(e<11754943508222875e-54)t((r<<31|Math.round(e/1401298464324817e-60))>>>0,n,i);else{var o=Math.floor(Math.log(e)/Math.LN2);t((r<<31|o+127<<23|8388607&Math.round(e*Math.pow(2,-o)*8388608))>>>0,n,i)}}function n(t,e,n){var i=t(e,n),r=2*(i>>31)+1,o=i>>>23&255,a=8388607&i;return 255===o?a?NaN:r*(1/0):0===o?1401298464324817e-60*r*a:r*Math.pow(2,o-150)*(a+8388608)}t.writeFloatLE=e.bind(null,r),t.writeFloatBE=e.bind(null,o),t.readFloatLE=n.bind(null,a),t.readFloatBE=n.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),i=128===n[7];function r(t,i,r){e[0]=t,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function o(t,i,r){e[0]=t,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function a(t,i){return n[0]=t[i],n[1]=t[i+1],n[2]=t[i+2],n[3]=t[i+3],n[4]=t[i+4],n[5]=t[i+5],n[6]=t[i+6],n[7]=t[i+7],e[0]}function s(t,i){return n[7]=t[i],n[6]=t[i+1],n[5]=t[i+2],n[4]=t[i+3],n[3]=t[i+4],n[2]=t[i+5],n[1]=t[i+6],n[0]=t[i+7],e[0]}t.writeDoubleLE=i?r:o,t.writeDoubleBE=i?o:r,t.readDoubleLE=i?a:s,t.readDoubleBE=i?s:a}():function(){function e(t,e,n,i,r,o){var a=i<0?1:0;if(a&&(i=-i),0===i)t(0,r,o+e),t(1/i>0?0:2147483648,r,o+n);else if(isNaN(i))t(0,r,o+e),t(2146959360,r,o+n);else if(i>17976931348623157e292)t(0,r,o+e),t((a<<31|2146435072)>>>0,r,o+n);else{var s;if(i<22250738585072014e-324)t((s=i/5e-324)>>>0,r,o+e),t((a<<31|s/4294967296)>>>0,r,o+n);else{var l=Math.floor(Math.log(i)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(s=i*Math.pow(2,-l))>>>0,r,o+e),t((a<<31|l+1023<<20|1048576*s&1048575)>>>0,r,o+n)}}}function n(t,e,n,i,r){var o=t(i,r+e),a=t(i,r+n),s=2*(a>>31)+1,l=a>>>20&2047,u=4294967296*(1048575&a)+o;return 2047===l?u?NaN:s*(1/0):0===l?5e-324*s*u:s*Math.pow(2,l-1075)*(u+4503599627370496)}t.writeDoubleLE=e.bind(null,r,0,4),t.writeDoubleBE=e.bind(null,o,4,0),t.readDoubleLE=n.bind(null,a,0,4),t.readDoubleBE=n.bind(null,s,4,0)}(),t}function r(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function o(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function a(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function s(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}t.exports=i(i)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},function(t,e,n){"use strict";var i=e;i.length=function(t){for(var e=0,n=0,i=0;i<t.length;++i)(n=t.charCodeAt(i))<128?e+=1:n<2048?e+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(i+1))?(++i,e+=4):e+=3;return e},i.read=function(t,e,n){if(n-e<1)return"";for(var i,r=null,o=[],a=0;e<n;)(i=t[e++])<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},i.write=function(t,e,n){for(var i,r,o=n,a=0;a<t.length;++a)(i=t.charCodeAt(a))<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=t.charCodeAt(a+1)))?(i=65536+((1023&i)<<10)+(1023&r),++a,e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128);return n-o}},function(t,e,n){"use strict";t.exports=function(t,e,n){var i=n||8192,r=i>>>1,o=null,a=i;return function(n){if(n<1||n>r)return t(n);a+n>i&&(o=t(i),a=0);var s=e.call(o,a,a+=n);return 7&a&&(a=1+(7|a)),s}}},function(t,e,n){"use strict";t.exports=r;var i=n(9);function r(t,e){this.lo=t>>>0,this.hi=e>>>0}var o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var a=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(t){if(0===t)return o;var e=t<0;e&&(t=-t);var n=t>>>0,i=(t-n)/4294967296>>>0;return e&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)},r.from=function(t){if("number"==typeof t)return r.fromNumber(t);if(i.isString(t)){if(!i.Long)return r.fromNumber(parseInt(t,10));t=i.Long.fromString(t)}return t.low||t.high?new r(t.low>>>0,t.high>>>0):o},r.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(t){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var s=String.prototype.charCodeAt;r.fromHash=function(t){return t===a?o:new r((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},r.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},r.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},function(t,e,n){"use strict";t.exports=o;var i=n(13);(o.prototype=Object.create(i.prototype)).constructor=o;var r=n(9);function o(){i.call(this)}function a(t,e,n){t.length<40?r.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}o._configure=function(){o.alloc=r._Buffer_allocUnsafe,o.writeBytesBuffer=r.Buffer&&r.Buffer.prototype instanceof Uint8Array&&"set"===r.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var i=0;i<t.length;)e[n++]=t[i++]}},o.prototype.bytes=function(t){r.isString(t)&&(t=r._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(o.writeBytesBuffer,e,t),this},o.prototype.string=function(t){var e=r.Buffer.byteLength(t);return this.uint32(e),e&&this._push(a,e,t),this},o._configure()},function(t,e,n){"use strict";t.exports=o;var i=n(15);(o.prototype=Object.create(i.prototype)).constructor=o;var r=n(9);function o(t){i.call(this,t)}o._configure=function(){r.Buffer&&(o.prototype._slice=r.Buffer.prototype.slice)},o.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},o._configure()},function(t,e,n){"use strict";e.Service=n(31)},function(t,e,n){"use strict";t.exports=r;var i=n(9);function r(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(r.prototype=Object.create(i.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function t(e,n,r,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return i.asPromise(t,s,e,n,r,o);if(s.rpcImpl)try{return s.rpcImpl(e,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(t,n){if(t)return s.emit("error",t,e),a(t);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return s.emit("error",t,e),a(t)}return s.emit("data",n,e),a(null,n)}s.end(!0)}))}catch(t){return s.emit("error",t,e),void setTimeout((function(){a(t)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},r.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(t,e,n){"use strict";t.exports={}},function(t,e,n){"use strict";var i=n(12),r=i.Reader,o=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.RecordedLibrettos=function(){function t(t){if(this.librettos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.librettos=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.librettos&&t.librettos.length)for(var n=0;n<t.librettos.length;++n)s.RecordedLibrettos.RecordedLibretto.encode(t.librettos[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.librettos&&i.librettos.length||(i.librettos=[]),i.librettos.push(s.RecordedLibrettos.RecordedLibretto.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.librettos&&t.hasOwnProperty("librettos")){if(!Array.isArray(t.librettos))return"librettos: array expected";for(var e=0;e<t.librettos.length;++e){var n=s.RecordedLibrettos.RecordedLibretto.verify(t.librettos[e]);if(n)return"librettos."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos)return t;var e=new s.RecordedLibrettos;if(t.librettos){if(!Array.isArray(t.librettos))throw TypeError(".RecordedLibrettos.librettos: array expected");e.librettos=[];for(var n=0;n<t.librettos.length;++n){if("object"!=typeof t.librettos[n])throw TypeError(".RecordedLibrettos.librettos: object expected");e.librettos[n]=s.RecordedLibrettos.RecordedLibretto.fromObject(t.librettos[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.librettos=[]),t.librettos&&t.librettos.length){n.librettos=[];for(var i=0;i<t.librettos.length;++i)n.librettos[i]=s.RecordedLibrettos.RecordedLibretto.toObject(t.librettos[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Phoneme=(e={},(n=Object.create(e))[e[0]="i"]=0,n[e[1]="a"]=1,n[e[2]="e"]=2,n[e[3]="o"]=3,n[e[4]="sil"]=4,n[e[5]="r"]=5,n[e[6]="n"]=6,n[e[7]="l"]=7,n[e[8]="t"]=8,n[e[9]="s"]=9,n[e[10]="d"]=10,n[e[11]="u"]=11,n[e[12]="m"]=12,n[e[13]="p"]=13,n[e[14]="v"]=14,n[e[15]="ch"]=15,n[e[16]="c"]=16,n[e[17]="f"]=17,n[e[18]="j"]=18,n[e[19]="b"]=19,n[e[20]="h"]=20,n[e[21]="g"]=21,n[e[22]="qu"]=22,n[e[23]="sh"]=23,n[e[24]="ny"]=24,n[e[25]="y"]=25,n[e[26]="sk"]=26,n[e[27]="z"]=27,n[e[28]="tz"]=28,n),t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name=0,t.prototype.startTimeSeconds=0,t.prototype.endTimeSeconds=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),e.uint32(8).int32(t.name),e.uint32(21).float(t.startTimeSeconds),e.uint32(29).float(t.endTimeSeconds),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos.Note;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.name=t.int32();break;case 2:i.startTimeSeconds=t.float();break;case 3:i.endTimeSeconds=t.float();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("name"))throw a.ProtocolError("missing required 'name'",{instance:i});if(!i.hasOwnProperty("startTimeSeconds"))throw a.ProtocolError("missing required 'startTimeSeconds'",{instance:i});if(!i.hasOwnProperty("endTimeSeconds"))throw a.ProtocolError("missing required 'endTimeSeconds'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.name){default:return"name: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:}return"number"!=typeof t.startTimeSeconds?"startTimeSeconds: number expected":"number"!=typeof t.endTimeSeconds?"endTimeSeconds: number expected":null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos.Note)return t;var e=new s.RecordedLibrettos.Note;switch(t.name){case"i":case 0:e.name=0;break;case"a":case 1:e.name=1;break;case"e":case 2:e.name=2;break;case"o":case 3:e.name=3;break;case"sil":case 4:e.name=4;break;case"r":case 5:e.name=5;break;case"n":case 6:e.name=6;break;case"l":case 7:e.name=7;break;case"t":case 8:e.name=8;break;case"s":case 9:e.name=9;break;case"d":case 10:e.name=10;break;case"u":case 11:e.name=11;break;case"m":case 12:e.name=12;break;case"p":case 13:e.name=13;break;case"v":case 14:e.name=14;break;case"ch":case 15:e.name=15;break;case"c":case 16:e.name=16;break;case"f":case 17:e.name=17;break;case"j":case 18:e.name=18;break;case"b":case 19:e.name=19;break;case"h":case 20:e.name=20;break;case"g":case 21:e.name=21;break;case"qu":case 22:e.name=22;break;case"sh":case 23:e.name=23;break;case"ny":case 24:e.name=24;break;case"y":case 25:e.name=25;break;case"sk":case 26:e.name=26;break;case"z":case 27:e.name=27;break;case"tz":case 28:e.name=28}return null!=t.startTimeSeconds&&(e.startTimeSeconds=Number(t.startTimeSeconds)),null!=t.endTimeSeconds&&(e.endTimeSeconds=Number(t.endTimeSeconds)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.name=e.enums===String?"i":0,n.startTimeSeconds=0,n.endTimeSeconds=0),null!=t.name&&t.hasOwnProperty("name")&&(n.name=e.enums===String?s.RecordedLibrettos.Phoneme[t.name]:t.name),null!=t.startTimeSeconds&&t.hasOwnProperty("startTimeSeconds")&&(n.startTimeSeconds=e.json&&!isFinite(t.startTimeSeconds)?String(t.startTimeSeconds):t.startTimeSeconds),null!=t.endTimeSeconds&&t.hasOwnProperty("endTimeSeconds")&&(n.endTimeSeconds=e.json&&!isFinite(t.endTimeSeconds)?String(t.endTimeSeconds):t.endTimeSeconds),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.RecordedLibretto=function(){function t(t){if(this.notes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.notes=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.notes&&t.notes.length)for(var n=0;n<t.notes.length;++n)s.RecordedLibrettos.Note.encode(t.notes[n],e.uint32(10).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordedLibrettos.RecordedLibretto;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(s.RecordedLibrettos.Note.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(var e=0;e<t.notes.length;++e){var n=s.RecordedLibrettos.Note.verify(t.notes[e]);if(n)return"notes."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordedLibrettos.RecordedLibretto)return t;var e=new s.RecordedLibrettos.RecordedLibretto;if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".RecordedLibrettos.RecordedLibretto.notes: array expected");e.notes=[];for(var n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".RecordedLibrettos.RecordedLibretto.notes: object expected");e.notes[n]=s.RecordedLibrettos.Note.fromObject(t.notes[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.notes=[]),t.notes&&t.notes.length){n.notes=[];for(var i=0;i<t.notes.length;++i)n.notes[i]=s.RecordedLibrettos.Note.toObject(t.notes[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t}(),t.exports=s},function(t,e,n){"use strict";var i=n(12),r=i.Reader,o=i.Writer,a=i.util,s=i.roots.default||(i.roots.default={});s.RecordingMessage=function(){function t(t){if(this.parts=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e,n;return t.prototype.theme=0,t.prototype.parts=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),e.uint32(8).int32(t.theme),null!=t.parts&&t.parts.length)for(var n=0;n<t.parts.length;++n)s.RecordingMessage.Part.encode(t.parts[n],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.theme=t.int32();break;case 2:i.parts&&i.parts.length||(i.parts=[]),i.parts.push(s.RecordingMessage.Part.decode(t,t.uint32()));break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("theme"))throw a.ProtocolError("missing required 'theme'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.theme){default:return"theme: enum value expected";case 0:case 1:}if(null!=t.parts&&t.hasOwnProperty("parts")){if(!Array.isArray(t.parts))return"parts: array expected";for(var e=0;e<t.parts.length;++e){var n=s.RecordingMessage.Part.verify(t.parts[e]);if(n)return"parts."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage)return t;var e=new s.RecordingMessage;switch(t.theme){case"Normal":case 0:e.theme=0;break;case"Festive":case 1:e.theme=1}if(t.parts){if(!Array.isArray(t.parts))throw TypeError(".RecordingMessage.parts: array expected");e.parts=[];for(var n=0;n<t.parts.length;++n){if("object"!=typeof t.parts[n])throw TypeError(".RecordingMessage.parts: object expected");e.parts[n]=s.RecordingMessage.Part.fromObject(t.parts[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.parts=[]),e.defaults&&(n.theme=e.enums===String?"Normal":0),null!=t.theme&&t.hasOwnProperty("theme")&&(n.theme=e.enums===String?s.RecordingMessage.Theme[t.theme]:t.theme),t.parts&&t.parts.length){n.parts=[];for(var i=0;i<t.parts.length;++i)n.parts[i]=s.RecordingMessage.Part.toObject(t.parts[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t.Phoneme=(e={},(n=Object.create(e))[e[0]="i"]=0,n[e[1]="a"]=1,n[e[2]="e"]=2,n[e[3]="o"]=3,n[e[4]="sil"]=4,n[e[5]="r"]=5,n[e[6]="n"]=6,n[e[7]="l"]=7,n[e[8]="t"]=8,n[e[9]="s"]=9,n[e[10]="d"]=10,n[e[11]="u"]=11,n[e[12]="m"]=12,n[e[13]="p"]=13,n[e[14]="v"]=14,n[e[15]="ch"]=15,n[e[16]="c"]=16,n[e[17]="f"]=17,n[e[18]="j"]=18,n[e[19]="b"]=19,n[e[20]="h"]=20,n[e[21]="g"]=21,n[e[22]="qu"]=22,n[e[23]="sh"]=23,n[e[24]="ny"]=24,n[e[25]="y"]=25,n[e[26]="sk"]=26,n[e[27]="z"]=27,n[e[28]="tz"]=28,n),t.PhonemeWithDuration=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.name=0,t.prototype.duration=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),e.uint32(8).int32(t.name),e.uint32(21).float(t.duration),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.PhonemeWithDuration;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.name=t.int32();break;case 2:i.duration=t.float();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("name"))throw a.ProtocolError("missing required 'name'",{instance:i});if(!i.hasOwnProperty("duration"))throw a.ProtocolError("missing required 'duration'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";switch(t.name){default:return"name: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:}return"number"!=typeof t.duration?"duration: number expected":null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.PhonemeWithDuration)return t;var e=new s.RecordingMessage.PhonemeWithDuration;switch(t.name){case"i":case 0:e.name=0;break;case"a":case 1:e.name=1;break;case"e":case 2:e.name=2;break;case"o":case 3:e.name=3;break;case"sil":case 4:e.name=4;break;case"r":case 5:e.name=5;break;case"n":case 6:e.name=6;break;case"l":case 7:e.name=7;break;case"t":case 8:e.name=8;break;case"s":case 9:e.name=9;break;case"d":case 10:e.name=10;break;case"u":case 11:e.name=11;break;case"m":case 12:e.name=12;break;case"p":case 13:e.name=13;break;case"v":case 14:e.name=14;break;case"ch":case 15:e.name=15;break;case"c":case 16:e.name=16;break;case"f":case 17:e.name=17;break;case"j":case 18:e.name=18;break;case"b":case 19:e.name=19;break;case"h":case 20:e.name=20;break;case"g":case 21:e.name=21;break;case"qu":case 22:e.name=22;break;case"sh":case 23:e.name=23;break;case"ny":case 24:e.name=24;break;case"y":case 25:e.name=25;break;case"sk":case 26:e.name=26;break;case"z":case 27:e.name=27;break;case"tz":case 28:e.name=28}return null!=t.duration&&(e.duration=Number(t.duration)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.name=e.enums===String?"i":0,n.duration=0),null!=t.name&&t.hasOwnProperty("name")&&(n.name=e.enums===String?s.RecordingMessage.Phoneme[t.name]:t.name),null!=t.duration&&t.hasOwnProperty("duration")&&(n.duration=e.json&&!isFinite(t.duration)?String(t.duration):t.duration),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.LibrettoChunk=function(){function t(t){if(this.suffix=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.vowel=null,t.prototype.suffix=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),s.RecordingMessage.PhonemeWithDuration.encode(t.vowel,e.uint32(10).fork()).ldelim(),null!=t.suffix&&t.suffix.length)for(var n=0;n<t.suffix.length;++n)s.RecordingMessage.PhonemeWithDuration.encode(t.suffix[n],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.LibrettoChunk;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.vowel=s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32());break;case 2:i.suffix&&i.suffix.length||(i.suffix=[]),i.suffix.push(s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32()));break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("vowel"))throw a.ProtocolError("missing required 'vowel'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.vowel))return"vowel."+n;if(null!=t.suffix&&t.hasOwnProperty("suffix")){if(!Array.isArray(t.suffix))return"suffix: array expected";for(var e=0;e<t.suffix.length;++e){var n;if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.suffix[e]))return"suffix."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.LibrettoChunk)return t;var e=new s.RecordingMessage.LibrettoChunk;if(null!=t.vowel){if("object"!=typeof t.vowel)throw TypeError(".RecordingMessage.LibrettoChunk.vowel: object expected");e.vowel=s.RecordingMessage.PhonemeWithDuration.fromObject(t.vowel)}if(t.suffix){if(!Array.isArray(t.suffix))throw TypeError(".RecordingMessage.LibrettoChunk.suffix: array expected");e.suffix=[];for(var n=0;n<t.suffix.length;++n){if("object"!=typeof t.suffix[n])throw TypeError(".RecordingMessage.LibrettoChunk.suffix: object expected");e.suffix[n]=s.RecordingMessage.PhonemeWithDuration.fromObject(t.suffix[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.suffix=[]),e.defaults&&(n.vowel=null),null!=t.vowel&&t.hasOwnProperty("vowel")&&(n.vowel=s.RecordingMessage.PhonemeWithDuration.toObject(t.vowel,e)),t.suffix&&t.suffix.length){n.suffix=[];for(var i=0;i<t.suffix.length;++i)n.suffix[i]=s.RecordingMessage.PhonemeWithDuration.toObject(t.suffix[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.timeSeconds=0,t.prototype.midiPitch=0,t.prototype.librettoChunk=null,t.prototype.controlled=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=o.create()),e.uint32(13).float(t.timeSeconds),e.uint32(21).float(t.midiPitch),s.RecordingMessage.LibrettoChunk.encode(t.librettoChunk,e.uint32(26).fork()).ldelim(),null!=t.controlled&&Object.hasOwnProperty.call(t,"controlled")&&e.uint32(32).bool(t.controlled),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.Note;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.timeSeconds=t.float();break;case 2:i.midiPitch=t.float();break;case 3:i.librettoChunk=s.RecordingMessage.LibrettoChunk.decode(t,t.uint32());break;case 4:i.controlled=t.bool();break;default:t.skipType(7&o)}}if(!i.hasOwnProperty("timeSeconds"))throw a.ProtocolError("missing required 'timeSeconds'",{instance:i});if(!i.hasOwnProperty("midiPitch"))throw a.ProtocolError("missing required 'midiPitch'",{instance:i});if(!i.hasOwnProperty("librettoChunk"))throw a.ProtocolError("missing required 'librettoChunk'",{instance:i});return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if("number"!=typeof t.timeSeconds)return"timeSeconds: number expected";if("number"!=typeof t.midiPitch)return"midiPitch: number expected";var e=s.RecordingMessage.LibrettoChunk.verify(t.librettoChunk);return e?"librettoChunk."+e:null!=t.controlled&&t.hasOwnProperty("controlled")&&"boolean"!=typeof t.controlled?"controlled: boolean expected":null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.Note)return t;var e=new s.RecordingMessage.Note;if(null!=t.timeSeconds&&(e.timeSeconds=Number(t.timeSeconds)),null!=t.midiPitch&&(e.midiPitch=Number(t.midiPitch)),null!=t.librettoChunk){if("object"!=typeof t.librettoChunk)throw TypeError(".RecordingMessage.Note.librettoChunk: object expected");e.librettoChunk=s.RecordingMessage.LibrettoChunk.fromObject(t.librettoChunk)}return null!=t.controlled&&(e.controlled=Boolean(t.controlled)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.timeSeconds=0,n.midiPitch=0,n.librettoChunk=null,n.controlled=!1),null!=t.timeSeconds&&t.hasOwnProperty("timeSeconds")&&(n.timeSeconds=e.json&&!isFinite(t.timeSeconds)?String(t.timeSeconds):t.timeSeconds),null!=t.midiPitch&&t.hasOwnProperty("midiPitch")&&(n.midiPitch=e.json&&!isFinite(t.midiPitch)?String(t.midiPitch):t.midiPitch),null!=t.librettoChunk&&t.hasOwnProperty("librettoChunk")&&(n.librettoChunk=s.RecordingMessage.LibrettoChunk.toObject(t.librettoChunk,e)),null!=t.controlled&&t.hasOwnProperty("controlled")&&(n.controlled=t.controlled),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Part=function(){function t(t){if(this.notes=[],this.startSuffix=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.notes=a.emptyArray,t.prototype.startSuffix=a.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=o.create()),null!=t.notes&&t.notes.length)for(var n=0;n<t.notes.length;++n)s.RecordingMessage.Note.encode(t.notes[n],e.uint32(10).fork()).ldelim();if(null!=t.startSuffix&&t.startSuffix.length)for(n=0;n<t.startSuffix.length;++n)s.RecordingMessage.PhonemeWithDuration.encode(t.startSuffix[n],e.uint32(18).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof r||(t=r.create(t));for(var n=void 0===e?t.len:t.pos+e,i=new s.RecordingMessage.Part;t.pos<n;){var o=t.uint32();switch(o>>>3){case 1:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(s.RecordingMessage.Note.decode(t,t.uint32()));break;case 2:i.startSuffix&&i.startSuffix.length||(i.startSuffix=[]),i.startSuffix.push(s.RecordingMessage.PhonemeWithDuration.decode(t,t.uint32()));break;default:t.skipType(7&o)}}return i},t.decodeDelimited=function(t){return t instanceof r||(t=new r(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!=typeof t||null===t)return"object expected";if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(var e=0;e<t.notes.length;++e){if(n=s.RecordingMessage.Note.verify(t.notes[e]))return"notes."+n}}if(null!=t.startSuffix&&t.hasOwnProperty("startSuffix")){if(!Array.isArray(t.startSuffix))return"startSuffix: array expected";for(e=0;e<t.startSuffix.length;++e){var n;if(n=s.RecordingMessage.PhonemeWithDuration.verify(t.startSuffix[e]))return"startSuffix."+n}}return null},t.fromObject=function(t){if(t instanceof s.RecordingMessage.Part)return t;var e=new s.RecordingMessage.Part;if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".RecordingMessage.Part.notes: array expected");e.notes=[];for(var n=0;n<t.notes.length;++n){if("object"!=typeof t.notes[n])throw TypeError(".RecordingMessage.Part.notes: object expected");e.notes[n]=s.RecordingMessage.Note.fromObject(t.notes[n])}}if(t.startSuffix){if(!Array.isArray(t.startSuffix))throw TypeError(".RecordingMessage.Part.startSuffix: array expected");e.startSuffix=[];for(n=0;n<t.startSuffix.length;++n){if("object"!=typeof t.startSuffix[n])throw TypeError(".RecordingMessage.Part.startSuffix: object expected");e.startSuffix[n]=s.RecordingMessage.PhonemeWithDuration.fromObject(t.startSuffix[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.notes=[],n.startSuffix=[]),t.notes&&t.notes.length){n.notes=[];for(var i=0;i<t.notes.length;++i)n.notes[i]=s.RecordingMessage.Note.toObject(t.notes[i],e)}if(t.startSuffix&&t.startSuffix.length){n.startSuffix=[];for(i=0;i<t.startSuffix.length;++i)n.startSuffix[i]=s.RecordingMessage.PhonemeWithDuration.toObject(t.startSuffix[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},t}(),t.Theme=function(){var t={},e=Object.create(t);return e[t[0]="Normal"]=0,e[t[1]="Festive"]=1,e}(),t}(),t.exports=s},function(t,e,n){"use strict";var i=n(38),r=n.n(i)()((function(t){return t[1]}));r.push([t.i,'html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:"";content:none}table{border-collapse:collapse;border-spacing:0}.prompt{position:fixed;color:#000;font-weight:300;font-size:16px;line-height:20px;padding:10px;text-align:center;background:#ffffffcc;border-radius:10px;z-index:1}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.prompt{font-size:12px;line-height:16px;padding:6px}}.voice-prompt{will-change:transform;transform:translateZ(0)}#pitch-prompt{will-change:transform;transform:translateZ(0)}.voice-prompt span{font-weight:800}#pitch-prompt-pitch{font-weight:400;transition:font-weight .1s linear}#pitch-prompt-pitch.sounding{font-weight:600}.prompt-right-arrow{margin-left:10px}.prompt-right-arrow:after{position:absolute;left:100%;border-top:5px solid transparent;border-bottom:5px solid transparent;border-left:5px solid #ffffffcc;content:" ";margin-top:-5px;top:50%}.prompt-left-arrow{margin-right:10px}.prompt-left-arrow:after{position:absolute;right:100%;border-top:5px solid transparent;border-bottom:5px solid transparent;border-right:5px solid #ffffffcc;content:" ";margin-top:-5px;top:50%}.prompt-bottom-arrow:after{position:absolute;top:100%;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid #ffffffcc;content:" ";margin-left:-5px;left:50%}#vowel-prompt{transform:translate(-50%, 0)}#vowel-prompt-vowel{font-weight:400;transition:font-weight .1s linear}#vowel-prompt-vowel.sounding{font-weight:600}#stop-recording-prompt{left:90px;bottom:45px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#stop-recording-prompt{left:75px;bottom:40px}}.share-prompt{bottom:100px;left:105px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.share-prompt{left:85px;bottom:80px}}.share-prompt:after{left:25px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.share-prompt:after{left:15px}}#festive-prompt{bottom:85px;right:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-prompt{bottom:75px;right:5px}}#festive-prompt:after{left:auto;right:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-prompt:after{right:20px}}#carols-prompt{bottom:100px;right:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#carols-prompt{bottom:80px;right:10px}}#carols-prompt:after{left:auto;right:80px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#carols-prompt:after{right:70px}}#loading{width:300px;margin:30px auto 0 auto;color:#fff;text-align:center}.loading-visible{-moz-animation:fade .3s;-webkit-animation:fade .3s;animation:fade .3s;opacity:1}.loading-hidden{-moz-animation:fade-out .3s !important;-webkit-animation:fade-out .3s !important;animation:fade-out .3s !important;opacity:0}#loading-bar{width:200px;height:15px;margin:0 auto 0 auto;border-width:1px;border-style:solid;border-color:#fff;border-radius:15px;overflow:hidden;transition:width .3s,height .3s,margin .3s,border-radius .3s,border-color .3s}#loading-fill{background-color:#fff;height:100%;width:0%;transition:background-color .3s linear,width .2s linear;position:relative;overflow:hidden}.loading-button{width:120px !important;height:50px !important;margin-top:-10px !important;border-radius:25px !important;border-color:transparent !important;cursor:pointer;pointer-events:auto;-webkit-tap-highlight-color:rgba(255,255,255,0)}.loading-button #loading-fill{background:#22b82e;box-shadow:0px 0px 6px #0000008e}#loading-play{position:absolute;height:30px;width:100%;top:50%;margin-top:-15px;line-height:30px;text-align:center;color:#fff;font-size:20px;opacity:0;display:none}.loading-button #loading-play{display:block !important}.loading-button #loading-fill #loading-play{opacity:1 !important}#audio-prompt{font-weight:200;font-size:16px;margin-top:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#audio-prompt{font-size:14px}}#silent-hint{display:none;font-weight:100}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#silent-hint{font-size:14px}}.silent-hint-show{display:block !important}#error{text-align:center;font-size:20px}#disclaimer{position:fixed;left:20px;bottom:20px;right:20px;color:#fff;text-align:center}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#disclaimer{font-size:14px;left:10px;right:10px;bottom:10px}}#info-overlay{top:0;left:0;background:#000000cc;position:fixed;width:100%;height:100%;overflow:auto}#info-container{margin:100px auto;padding:20px;max-width:500px;color:#fff;font-weight:300;font-size:16px;line-height:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#info-container{margin:10px auto;font-size:12px;line-height:14px}}#info-container p{margin-top:1em}#info-container span{font-weight:bold}#info-container a{color:#fff}#info-container a:visited{color:#fff}#info-title{color:#fff;font-size:24px;margin-bottom:1em}#info-title-image{width:auto;height:auto;max-width:180px}#close-info{color:#000;position:relative;margin-top:40px}.festive-button{position:fixed;width:55px;height:55px;line-height:55px;border-radius:50%;box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear,fill .1s linear,#fff .1s linear;color:#000;text-align:center;user-select:none}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.festive-button{width:40px;height:40px;line-height:40px}}.festive-button.depressed{color:#fff;background-color:#666}#festive-playlist{right:80px;bottom:30px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-playlist{right:65px;bottom:30px}}#festive-songs-container{bottom:95px;right:20px;width:250px;position:fixed;color:#000;font-weight:300;font-size:14px;text-align:left;background:#ffffffcc;padding:5px;border-radius:10px;white-space:nowrap}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-songs-container{left:50%;margin-left:-125px;font-size:12px}}#festive-songs-container:after{left:auto;right:80px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-songs-container:after{display:none}}#festive-songs .material-icons{vertical-align:middle;padding-bottom:3px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-songs .material-icons{font-size:18px}}#festive-songs li{position:relative;padding:5px;border-top:1px solid #aaa;cursor:pointer;transition:background-color .1s linear}#festive-songs li:first-child{border-top:none}@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}#festive-songs li .spinner{position:absolute;width:12px;height:12px;left:8px;top:8px;border-radius:50%;border:3px solid currentColor;border-top-color:currentcolor;border-right-color:currentcolor;border-bottom-color:currentcolor;border-left-color:currentcolor;border-color:currentColor transparent currentColor transparent;display:none}#festive-songs li.loading .spinner{display:block;animation:spin 1.2s linear infinite}#festive-songs li.loading .material-icons{opacity:0}#festive-songs .song-name{margin-left:5px}#festive-songs .playing{color:#22b82e}#festive-switch-container{position:absolute;right:20px;bottom:45px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#festive-switch-container{right:10px;bottom:40px}}.switch{position:relative;display:inline-block;width:48px;height:20px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#eee;-webkit-transition:.4s;transition:.4s;border-radius:34px}.slider:before{position:absolute;content:"";height:32px;width:32px;left:0px;bottom:-6px;background-color:#fff;box-shadow:0px 0px 12px #00000063;-webkit-transition:.4s;transition:125ms;border-radius:50%;background-image:url("/blob-opera/tree.svg");background-repeat:no-repeat;background-position:center}input:checked+.slider:before{background-color:#22b82e}input:checked+.slider{background-color:#afdab3}input:focus+.slider{box-shadow:0 0 1px #afdab3}input:checked+.slider:before{-webkit-transform:translateX(19px);-ms-transform:translateX(19px);transform:translateX(19px)}.indicator{position:fixed;width:20px;height:20px;border-radius:20px;margin-left:-10px;margin-top:-10px;left:0;right:0;opacity:0;transition:opacity .2s linear;pointer-events:none;border:2px solid #fff}.indicator.active{opacity:1}#multiplayer-container{position:absolute;right:170px;bottom:10px;pointer-events:none;text-align:center;width:80px}#multiplayer-status{background:#00000080;padding:8px 10px;display:inline-block;vertical-align:middle;margin-bottom:5px}#multiplayer-people-label{font-weight:300;color:#fff;font-weight:200;margin-top:10px}#multiplayer-people{margin-left:-100%;margin-right:-100%;white-space:nowrap}.multiplayer-person{font-family:"Material Icons";vertical-align:middle;transition:width .3s linear,height .3s linear,margin .3s linear,opacity .2s linear;animation:slidein .3s forwards;opacity:.4;overflow:hidden}.multiplayer-person.self{-webkit-text-stroke:1px #fff}.multiplayer-person.inactive{animation:slideout .3s forwards}.multiplayer-person.connected{opacity:1}@keyframes slidein{from{font-size:0px}to{font-size:30px}}@keyframes slideout{from{font-size:30px}to{font-size:0px}}.tutorial-prompt{position:fixed;color:#fff;font-size:24px;top:20%;text-align:center;width:90%;padding:0 5% 0 5%}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.tutorial-prompt{font-size:16px}}body{margin:0;padding:0;overflow:hidden;font-family:"Google Sans",sans-serif;width:100%;height:100%;background:url("/blob-opera/background.jpg") no-repeat center center fixed,#000;-webkit-background-size:cover;-moz-background-size:cover;-o-background-size:cover;background-size:cover}#skip{position:fixed;bottom:20px;right:20px;font-size:16px;font-weight:300;cursor:pointer;color:#fff}.hideable-clickable{opacity:0;pointer-events:none;transition:opacity .2s}.hideable-clickable.visible{opacity:1;pointer-events:auto}.hideable-unclickable{opacity:0;pointer-events:none;transition:opacity .4s}.hideable-unclickable.visible{opacity:1}#intro{font-size:21px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#intro{font-size:16px}}#title{margin-top:20px}.title{color:#fff;pointer-events:none}#title-image{width:auto;height:auto;max-width:455px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-image{max-width:300px}}#splash{position:fixed;width:100%;top:25%;text-align:center;color:#fff}#tagline{font-weight:200;margin-top:20px;font-size:21px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#tagline{font-size:16px}}#title-small{position:fixed;font-size:32px;left:20px;top:20px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-small{left:10px;font-size:24px}}#title-small-image{width:auto;height:auto;max-width:180px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#title-small-image{max-width:120px}}#record-container{left:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record-container{left:0px}}#record,#stop-record{position:absolute;border-width:6px;border-style:solid;border-color:#fff;bottom:24px;width:46px;height:46px;border-radius:50%;box-shadow:0px 0px 12px #00000063;cursor:pointer;left:50%;transform:translate(-50%, 0)}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record,#stop-record{width:36px;height:36px;bottom:20px;border-width:5px}}@keyframes pulse{from{border-color:#fff}50%{border-color:#ffffffcc}to{border-color:#fff}}#record-start{position:absolute;width:40px;height:40px;border-radius:50%;background:#ff3030;margin:0 auto;position:absolute;left:50%;top:50%;transform:translate(-50%, -50%);box-shadow:0px 0px 12px #00000063;transition:width .1s linear,height .1s linear,border-radius .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#record-start{width:30px;height:30px}}.recording #record-start{width:20px;height:20px;border-radius:0}#stop-recording-container{left:50%;margin-left:-40px}#record-text{opacity:1}.recording #record-text{opacity:0}#finish-text{opacity:0}.recording #finish-text{opacity:1}.timecode{transition:opacity .1s linear;opacity:0;position:absolute;top:-35px;text-align:center;pointer-events:none;width:100%;font-size:14px;font-family:"Roboto Mono",monospace;color:#fff;padding:5px 0 5px 0;border-radius:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.timecode{font-size:12px;top:-10px;width:90%;left:10%}}#recording-timecode{background:#ff3030}.recording #recording-timecode{opacity:1}#playback-timecode{opacity:1;background:#0000008a}.button-container{position:fixed;bottom:10px;width:80px;height:80px}.button{width:55px;height:55px;line-height:55px;border-radius:27.5px;text-align:center;position:absolute;bottom:24px;left:50%;transform:translate(-50%, 0);box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear;user-select:none}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.button{font-size:18px;width:40px;height:40px;line-height:40px;bottom:20px}}.button-text{position:absolute;text-align:center;color:#fff;font-weight:200;bottom:0;pointer-events:none;width:100%;transition:opacity .1s linear;user-select:none;font-size:16px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.button-text{font-size:14px;font-weight:300}}#save-container{left:90px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#save-container{left:60px}}#save-text{opacity:1}.saving #save-text{opacity:0}#saving-text{opacity:0}.saving #saving-text{opacity:1}#discard-container{left:160px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#discard-container{left:110px}}#startstop-container{left:10px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop-container{left:0px}}#recording-copy-link-container{left:90px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-copy-link-container{left:60px}}.copy-link-text{opacity:1}.copying .copy-link-text{opacity:0}.copying-link-text{opacity:0}.copying .copying-link-text{opacity:1}#back-container{left:160px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#back-container{left:110px}}#startstop{position:absolute;bottom:31px;left:50%;transform:translate(-50%, 0);width:40px;height:40px;border-radius:50%;box-shadow:0px 0px 12px #00000063;background-color:#eee;cursor:pointer;transition:background-color .1s linear,box-shadow .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop{width:30px;height:30px;bottom:28px}}.playing #startstop-stop{opacity:1}.playing #startstop-play{opacity:0}#startstop-stop{position:absolute;background:#333;width:15px;height:15px;left:50%;top:50%;transform:translate(-50%, -50%);transition:opacity .1s linear;opacity:0}#startstop-ring{width:58px;height:58px;border-radius:50%;box-shadow:0px 0px 12px #00000063;position:absolute;left:50%;bottom:22px;transform:translate(-50%, 0%)}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#startstop-ring{width:46px;height:46px;bottom:20px}}#startstop-play{position:absolute;width:0;height:0;left:50%;top:50%;transform:translate(-40%, -50%);border-radius:2px;border-top:10px solid transparent;border-bottom:10px solid transparent;border-left:15px solid #333;transition:opacity .1s linear;opacity:1}#play-text{opacity:1}.playing #play-text{opacity:0}#stop-text{opacity:0}.playing #stop-text{opacity:1}#play{background:#22b82e;color:#fff;text-align:center;position:fixed;right:20px;bottom:20px;width:150px;height:60px;border-radius:30px;font-weight:100;line-height:60px;cursor:pointer;font-size:20px;box-shadow:0px 0px 6px #0000008e}#muted-container{position:fixed;width:150px;height:150px;left:50%;top:50%;margin-left:-75px;margin-top:-75px;background:#ffffff33;pointer-events:none;border-radius:75px}#muted-text{color:#fff;font-weight:300;text-align:center;margin-top:10px}.silence-button{position:fixed;width:50px;height:50px;margin-left:-25px;border-radius:50%;background:#ffffff33;cursor:pointer}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.silence-button{width:36px;height:36px;margin-left:-18px}}.silence-button .silence-line{transform-origin:20% 20%;transform:scale(0);transition:transform .1s linear}.silenced .silence-line{transform:scale(1)}#error{color:#fff;position:absolute;width:400px;left:50%;margin-left:-200px;top:50%;margin-top:-25px;pointer-events:none}#info{color:#fff;position:fixed;width:25px;height:25px;top:20px;left:220px;border:1px solid #fff;line-height:25px;border-radius:50%;cursor:pointer;user-select:none;text-align:center;font-size:16px;font-weight:900;z-index:999;background-color:rgba(255,255,255,0);transition:background-color .1s linear}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#info{width:20px;height:20px;line-height:20px;font-size:11px;left:140px}}#recording-indicator{position:fixed;top:90px;left:40px;color:#fff;font-size:24px;padding-left:25px}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-indicator{left:35px;top:85px;font-size:18px;padding-left:20px}}#recording-icon{position:absolute;left:0;top:2px;width:20px;height:20px;border-radius:50%;background:#ff3030;margin-right:10px;opacity:1}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){#recording-icon{width:15px;height:15px;margin-right:5px}}@keyframes recording-pulse{from{opacity:.7}50%{opacity:1}to{opacity:.7}}#recording-frame{position:fixed;top:50px;bottom:0;left:0;right:0}.recording-frame-corner{display:block;position:fixed;stroke:rgba(255,255,255,.7);width:60px;height:60px;stroke-width:.15}@media screen and (max-width: 499.5px),screen and (max-height: 499.5px){.recording-frame-corner{width:40px;height:40px;stroke-width:.1}}@keyframes recording-frame-pulse{from{stroke:rgba(255,255,255,.7)}50%{stroke:#fff}to{stroke:rgba(255,255,255,.7)}}#recording-frame-top-left{top:70px;left:20px}#recording-frame-top-right{top:70px;right:20px}#recording-frame-bottom-left{bottom:20px;left:20px}#recording-frame-bottom-right{bottom:20px;right:20px}#landscape-warning-overlay{display:none;position:fixed;width:100%;height:100%;overflow:none;background:#000;z-index:99999999;align-items:center !important;justify-content:center !important}.landscape-warning-icon{position:auto;width:24px;height:24px;padding:16px;background:#fff;border-radius:50%;margin-left:auto;margin-right:auto}.landscape-warning-text{color:#fff;font-size:20px;text-align:center;margin-top:15px}#timer{font-family:"Roboto Mono",monospace;font-weight:bold;position:fixed;left:10px;top:80px;color:#fff;font-size:20px}#performance-warning{display:flex;position:fixed;left:0;right:0;top:0;bottom:0;overflow:none;margin:30px;z-index:9999999;align-items:center !important;justify-content:center !important;text-align:center}#performance-warning-content{border-radius:10px;background:rgba(0,0,0,.9);padding:20px;max-width:500px}#performance-warning-icon{color:#fff;position:auto;font-size:48px;margin-left:auto;margin-right:auto}#performance-warning-text{color:#fff;font-size:20px;text-align:center;margin-top:10px}#performance-warning-dismiss{display:inline-block;background:#333;color:#fff;padding:10px;margin-top:15px;border-radius:5px;cursor:pointer;user-select:none}#credit{cursor:pointer;text-decoration:underline}',""]),e.a=r},function(t,e){t.exports=[["Name","en-GB","es"],["splash_intro","Google Arts & Culture presents",null],["splash_title","Blob Opera","pera de blob"],["splash_description","Play four voices with the help of machine learning",null],["splash_sound_hint","Turn up your sound!",null],["splash_silent_hint","Make sure your device isn't on silent",null],["label_skip_tutorial","Skip tutorial",null],["button_begin","Ready!",null],["label_record","Record",null],["label_finish","Finish",null],["label_back","Back",null],["label_share","Share",null],["label_play","Play",null],["label_stop","Stop",null],["label_saving","Saving...",null],["label_discard","Discard",null],["label_copy_link","Copy link",null],["label_copied_link","Copied!",null],["label_leave","Leave",null],["tutorial_pitch","Drag blobs up and down to sing different pitches",null],["tutorial_vowel","Drag blobs forwards and backwards to sing different vowels",null],["tutorial_harmonization","The highest voice leads the harmony",null],["tutorial_mute","All together now! Use the mute buttons to silence blobs",null],["tutorial_end","That's it! Now sing your own operas. Hit record if you want to share what you make.",null],["prompt_in_playback_shared","Have a go!",null],["prompt_in_playback_creator","Start again",null],["prompt_share","Share your creation",null],["prompt_share_carol","Share this carol",null],["prompt_unmute","Click to unmute",null],["prompt_soprano","Drag to sing *soprano*",null],["prompt_mezzo","Drag to sing *mezzo-soprano*",null],["prompt_tenor","Drag to sing *tenor*",null],["prompt_bass","Drag to sing *bass*",null],["prompt_pitch","Pitch:",null],["prompt_vowel","Vowel:",null],["prompt_stop_recording","Press to finish your recording",null],["prompt_festive","Let it snow!",null],["prompt_harmonization","The highest voice type leads the harmony",null],["prompt_carols","Hear some festive songs!",null],["info_body","*Blob Opera is a machine learning experiment by David Li in collaboration with Google Arts and Culture.*\n\nThis experiment pays tribute to and explores the original musical instrument: the voice. Play four opera voices in real time. No singing skills required! \n\nWe developed a machine learning model trained on the voices of four opera singers in order to create an engaging experiment for everyone, regardless of musical skills. Tenor, Christian Joel, bass Frederick Tong, mezzo-soprano Joanna Gamble and soprano Olivia Doutney recorded 16 hours of singing. In the experiment you dont hear their voices, but the machine learning models understanding of what opera singing sounds like, based on what it learnt from them.\n\n*How it works:*\nDrag the blobs up and down to change pitch. Or forwards and backwards for different vowel sounds. Another machine learning model lets the blobs respond to and harmonise your input in real time. \n\n*Feeling festive?*\nClick the Christmas Tree for a holiday surprise based on the top searched Christmas Carols of the year.\n\n*With special thanks to:*\nTenor Christian Joel, bass Frederick Tong, mezzo-soprano Joanna Gamble and soprano Olivia Doutney. Additional singing from Ingunn Gyda Hrafnkelsdottir and John Holland-Avery.\n\n*Not working?*\nBlob Opera is an experiment using the latest web audio technology and may not perform optimally on older devices. If you're on a mobile device, why not try a desktop one!",null],["song_away_in_a_manger","Away in a Manger",null],["song_silent_night","Silent Night",null],["song_hark_the_herald_angels_sing","Hark the Herald Angels Sing",null],["song_jingle_bells","Jingle Bells",null],["song_the_first_noel","The First Noel",null],["song_o_come_all_ye_faithful","O Come all Ye Faithful",null],["song_once_in_royal_davids_city","Once in Royal David's City",null],["song_joy_to_the_world","Joy to the World",null],["song_auld_lang_syne","Auld Lang Syne",null],["axl_share_recording_ugc","Introducing Blob Opera - play four opera voices and create your own composition. Here's one I made earlier  ",null],["axl_share_recording_cc","Listen to <song> performed by Blob Opera. Then play four opera voices to create your own composition  ",null],["landscape_warning_desktop","Expand the height of your window to view this experiment",null],["landscape_warning_mobile","This experiment is best viewed in portrait mode",null],["performance_warning","We've detected that you may not be having an optimal experience. Why not try this on a desktop device!",null],["performance_warning_dismiss","Try anyway",null],["disclaimer","This is an experiment using the latest web audio technology. It may not perform optimally on older devices.",null]]},function(t,e,n){"use strict";var i,r=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function s(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function l(t,e){for(var n={},i=[],r=0;r<t.length;r++){var o=t[r],l=e.base?o[0]+e.base:o[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var h=s(c),f={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(a[h].references++,a[h].updater(f)):a.push({identifier:c,updater:g(f,e),references:1}),i.push(c)}return i}function u(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var r=n.nc;r&&(i.nonce=r)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var a=o(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var c,h=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function f(t,e,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=h(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function d(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var p=null,m=0;function g(t,e){var n,i,r;if(e.singleton){var o=m++;n=p||(p=u(e)),i=f.bind(null,n,o,!1),r=f.bind(null,n,o,!0)}else n=u(e),i=d.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=r());var n=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var r=s(n[i]);a[r].references--}for(var o=l(t,e),u=0;u<n.length;u++){var c=s(n[u]);0===a[c].references&&(a[c].updater(),a.splice(c,1))}n=o}}}},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(i)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(r[a]=!0)}for(var s=0;s<t.length;s++){var l=[].concat(t[s]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),e.push(l))}},e}},,function(t,e,n){(function(t){!function(t){"use strict";var e,n=function(){try{if(t.URLSearchParams&&"bar"===new t.URLSearchParams("foo=bar").get("foo"))return t.URLSearchParams}catch(t){}return null}(),i=n&&"a=1"===new n({a:1}).toString(),r=n&&"+"===new n("s=%2B").get("s"),o=!n||((e=new n).append("s"," &"),"s=+%26"===e.toString()),a=c.prototype,s=!(!t.Symbol||!t.Symbol.iterator);if(!(n&&i&&r&&o)){a.append=function(t,e){m(this.__URLSearchParams__,t,e)},a.delete=function(t){delete this.__URLSearchParams__[t]},a.get=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t][0]:null},a.getAll=function(t){var e=this.__URLSearchParams__;return this.has(t)?e[t].slice(0):[]},a.has=function(t){return v(this.__URLSearchParams__,t)},a.set=function(t,e){this.__URLSearchParams__[t]=[""+e]},a.toString=function(){var t,e,n,i,r=this.__URLSearchParams__,o=[];for(e in r)for(n=h(e),t=0,i=r[e];t<i.length;t++)o.push(n+"="+h(i[t]));return o.join("&")};var l=!!r&&n&&!i&&t.Proxy;Object.defineProperty(t,"URLSearchParams",{value:l?new Proxy(n,{construct:function(t,e){return new t(new c(e[0]).toString())}}):c});var u=t.URLSearchParams.prototype;u.polyfill=!0,u.forEach=u.forEach||function(t,e){var n=p(this.toString());Object.getOwnPropertyNames(n).forEach((function(i){n[i].forEach((function(n){t.call(e,n,i,this)}),this)}),this)},u.sort=u.sort||function(){var t,e,n,i=p(this.toString()),r=[];for(t in i)r.push(t);for(r.sort(),e=0;e<r.length;e++)this.delete(r[e]);for(e=0;e<r.length;e++){var o=r[e],a=i[o];for(n=0;n<a.length;n++)this.append(o,a[n])}},u.keys=u.keys||function(){var t=[];return this.forEach((function(e,n){t.push(n)})),d(t)},u.values=u.values||function(){var t=[];return this.forEach((function(e){t.push(e)})),d(t)},u.entries=u.entries||function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),d(t)},s&&(u[t.Symbol.iterator]=u[t.Symbol.iterator]||u.entries)}function c(t){((t=t||"")instanceof URLSearchParams||t instanceof c)&&(t=t.toString()),this.__URLSearchParams__=p(t)}function h(t){var e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'\(\)~]|%20|%00/g,(function(t){return e[t]}))}function f(t){return t.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/gi,(function(t){return decodeURIComponent(t)}))}function d(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(n[t.Symbol.iterator]=function(){return n}),n}function p(t){var e={};if("object"==typeof t)if(g(t))for(var n=0;n<t.length;n++){var i=t[n];if(!g(i)||2!==i.length)throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements");m(e,i[0],i[1])}else for(var r in t)t.hasOwnProperty(r)&&m(e,r,t[r]);else{0===t.indexOf("?")&&(t=t.slice(1));for(var o=t.split("&"),a=0;a<o.length;a++){var s=o[a],l=s.indexOf("=");-1<l?m(e,f(s.slice(0,l)),f(s.slice(l+1))):s&&m(e,f(s),"")}}return e}function m(t,e,n){var i="string"==typeof n?n:null!=n&&"function"==typeof n.toString?n.toString():JSON.stringify(n);v(t,e)?t[e].push(i):t[e]=[i]}function g(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function v(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(void 0!==t?t:"undefined"!=typeof window?window:this)}).call(this,n(14))},,function(t,e,n){"use strict";function i(t,e,n,i){var o=t.createProgram(),a=r(t,t.VERTEX_SHADER,e),s=r(t,t.FRAGMENT_SHADER,n);for(var l in t.attachShader(o,a),t.attachShader(o,s),i)t.bindAttribLocation(o,i[l],l);t.linkProgram(o);for(var u={},c=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),h=0;h<c;h+=1){var f=t.getActiveUniform(o,h),d=t.getUniformLocation(o,f.name);u[f.name]=d}return{program:o,uniformLocations:u,vertexShaderSource:e,fragmentShaderSource:n}}function r(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(i)),i}function o(t,e,n,i,r,o,a,s,l,u,c){var h=t.createTexture();return t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,h),t.texImage2D(t.TEXTURE_2D,0,n,r,o,0,n,i,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,c),h}function a(t,e,n,i,r,o,a,s,l,u,c,h){return t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,i,o,a,0,i,r,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,u),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,c),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,h),e}function s(t,e,n,i,r,o,a){var s=t.createTexture();return t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,a),s}function l(t,e,n,i){var r=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,r),t.renderbufferStorage(t.RENDERBUFFER,e,n,i),r}function u(t,e,n,i){var r=t.createBuffer();return t.bindBuffer(e,r),t.bufferData(e,n,i),r}n.r(e);var c={set:function(t,e,n,i,r,o,a,s,l,u,c,h,f,d,p,m,g){t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=a,t[6]=s,t[7]=l,t[8]=u,t[9]=c,t[10]=h,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=g},copy:function(t,e){for(var n=0;n<16;n++)t[n]=e[n]},makeIdentity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeTranslation:function(t,e,n,i){return c.makeIdentity(t),t[12]=e,t[13]=n,t[14]=i,t},makeScale:function(t,e,n,i){return t[0]=e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeXRotation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=Math.cos(e),t[6]=Math.sin(e),t[7]=0,t[8]=0,t[9]=-Math.sin(e),t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makeYRotation:function(t,e){return t[0]=Math.cos(e),t[1]=0,t[2]=-Math.sin(e),t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=Math.sin(e),t[9]=0,t[10]=Math.cos(e),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transformPosition:function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12],t[1]=n[1]*i+n[5]*r+n[9]*o+n[13],t[2]=n[2]*i+n[6]*r+n[10]*o+n[14],t[3]=n[3]*i+n[7]*r+n[11]*o+n[15],t},transformDirection:function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=n[0]*i+n[4]*r+n[8]*o,t[1]=n[1]*i+n[5]*r+n[9]*o,t[2]=n[2]*i+n[6]*r+n[10]*o,t[3]=n[3]*i+n[7]*r+n[11]*o,t},multiplyVector:function(t,e,n){var i=n[0],r=n[1],o=n[2],a=n[3];return t[0]=e[0]*i+e[4]*r+e[8]*o+e[12]*a,t[1]=e[1]*i+e[5]*r+e[9]*o+e[13]*a,t[2]=e[2]*i+e[6]*r+e[10]*o+e[14]*a,t[3]=e[3]*i+e[7]*r+e[11]*o+e[15]*a,t},premultiply:function(t,e,n){var i=n[0],r=n[4],o=n[8],a=n[12],s=n[1],l=n[5],u=n[9],c=n[13],h=n[2],f=n[6],d=n[10],p=n[14],m=n[3],g=n[7],v=n[11],b=n[15],y=e[0],x=e[1],w=e[2],_=e[3];return t[0]=i*y+r*x+o*w+a*_,t[1]=s*y+l*x+u*w+c*_,t[2]=h*y+f*x+d*w+p*_,t[3]=m*y+g*x+v*w+b*_,y=e[4],x=e[5],w=e[6],_=e[7],t[4]=i*y+r*x+o*w+a*_,t[5]=s*y+l*x+u*w+c*_,t[6]=h*y+f*x+d*w+p*_,t[7]=m*y+g*x+v*w+b*_,y=e[8],x=e[9],w=e[10],_=e[11],t[8]=i*y+r*x+o*w+a*_,t[9]=s*y+l*x+u*w+c*_,t[10]=h*y+f*x+d*w+p*_,t[11]=m*y+g*x+v*w+b*_,y=e[12],x=e[13],w=e[14],_=e[15],t[12]=i*y+r*x+o*w+a*_,t[13]=s*y+l*x+u*w+c*_,t[14]=h*y+f*x+d*w+p*_,t[15]=m*y+g*x+v*w+b*_,t},transpose:function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],a=e[7],s=e[11];e[1]=e[4],e[4]=n,e[2]=e[8],e[8]=i,e[3]=e[12],e[12]=r,e[6]=e[9],e[9]=o,e[7]=e[13],e[13]=a,e[11]=e[14],e[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]},invert:function(t,e){var n=e[0],i=e[4],r=e[8],o=e[12],a=e[1],s=e[5],l=e[9],u=e[13],c=e[2],h=e[6],f=e[10],d=e[14],p=e[3],m=e[7],g=e[11],v=e[15],b=f*v,y=d*g,x=h*v,w=d*m,_=h*g,P=f*m,A=c*v,S=d*p,R=c*g,T=f*p,E=c*m,M=h*p,k=r*u,F=o*l,I=i*u,B=o*s,C=i*l,D=r*s,L=n*u,O=o*a,N=n*l,U=r*a,j=n*s,z=i*a,G=b*s+w*l+_*u-(y*s+x*l+P*u),V=y*a+A*l+T*u-(b*a+S*l+R*u),H=x*a+S*s+E*u-(w*a+A*s+M*u),Y=P*a+R*s+M*l-(_*a+T*s+E*l),W=1/(n*G+i*V+r*H+o*Y);return t[0]=W*G,t[1]=W*V,t[2]=W*H,t[3]=W*Y,t[4]=W*(y*i+x*r+P*o-(b*i+w*r+_*o)),t[5]=W*(b*n+S*r+R*o-(y*n+A*r+T*o)),t[6]=W*(w*n+A*i+M*o-(x*n+S*i+E*o)),t[7]=W*(_*n+T*i+E*r-(P*n+R*i+M*r)),t[8]=W*(k*m+B*g+C*v-(F*m+I*g+D*v)),t[9]=W*(F*p+L*g+U*v-(k*p+O*g+N*v)),t[10]=W*(I*p+O*m+j*v-(B*p+L*m+z*v)),t[11]=W*(D*p+N*m+z*g-(C*p+U*m+j*g)),t[12]=W*(I*f+D*d+F*h-(C*d+k*h+B*f)),t[13]=W*(N*d+k*c+O*f-(L*f+U*d+F*c)),t[14]=W*(L*h+z*d+B*c-(j*d+I*c+O*h)),t[15]=W*(j*f+C*c+U*h-(N*h+z*f+D*c)),t},fromQuaternion:function(t,e){var n=e[3],i=e[0],r=e[1],o=e[2];return t[0]=1-2*r*r-2*o*o,t[1]=2*i*r+2*n*o,t[2]=2*i*o-2*n*r,t[3]=0,t[4]=2*i*r-2*n*o,t[5]=1-2*i*i-2*o*o,t[6]=2*r*o+2*n*i,t[7]=0,t[8]=2*i*o+2*n*r,t[9]=2*r*o-2*n*i,t[10]=1-2*i*i-2*r*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},makePerspective:function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},makeInfinitePerspective:function(t,e,n,i,r){var o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1e-8-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=(1e-8-2)*i,t[15]=0,t},makePerspectiveHorizontal:function(t,e,n,i,r){var o=1/Math.tan(e/2),a=1/(i-r);return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*a,t[15]=0,t},makeLookAt:function(t,e,n,i){var r=e[0],o=e[1],a=e[2],s=i[0],l=i[1],u=i[2],c=r-n[0],h=o-n[1],f=a-n[2],d=c*c+h*h+f*f;d>0&&(c*=d=1/Math.sqrt(d),h*=d,f*=d);var p=l*f-u*h,m=u*c-s*f,g=s*h-l*c;return(d=p*p+m*m+g*g)>0&&(p*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=p,t[1]=m,t[2]=g,t[3]=0,t[4]=h*g-f*m,t[5]=f*p-c*g,t[6]=c*m-h*p,t[7]=0,t[8]=c,t[9]=h,t[10]=f,t[11]=0,t[12]=r,t[13]=o,t[14]=a,t[15]=1,t},makeOrthographic:function(t,e,n,i,r,o,a){return t[0]=2/(n-e),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2/(r-i),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-2/(a-o),t[11]=0,t[12]=-(n+e)/(n-e),t[13]=-(r+i)/(r-i),t[14]=-(a+o)/(a-o),t[15]=1,t}},h=n(2),f=n(0),d=n(3),p=function(){function t(t,e,n){this.centerPosition=new Float32Array(3),this.lookPitch=0,this.lookYaw=0,this.lookDirection=new Float32Array([0,0,1]),this.localLookDirection=new Float32Array([0,0,1]),this.gl=t,this.module=e,this.eyePointer=n,this.vertexCount=this.module._eyeGetVertexCount(this.eyePointer),this.indexCount=this.module._eyeGetIndexCount(this.eyePointer);var i=this.module.HEAPU16.subarray(this.module._eyeGetIndices(this.eyePointer)>>1,(this.module._eyeGetIndices(this.eyePointer)>>1)+this.indexCount);this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),this.positionsBuffer=t.createBuffer(),this.normalsBuffer=t.createBuffer();var r=this.module.HEAPF32.subarray(this.module._eyeGetRestPositions(this.eyePointer)>>2,(this.module._eyeGetRestPositions(this.eyePointer)>>2)+3*this.vertexCount);this.restPositionsBuffer=u(t,t.ARRAY_BUFFER,r,t.STATIC_DRAW)}return t.prototype.step=function(t){var e=this.module.HEAPF32.subarray(this.module._eyeGetPositions(this.eyePointer)>>2,(this.module._eyeGetPositions(this.eyePointer)>>2)+3*this.vertexCount),n=this.module.HEAPF32.subarray(this.module._eyeGetNormals(this.eyePointer)>>2,(this.module._eyeGetNormals(this.eyePointer)>>2)+3*this.vertexCount),i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,this.positionsBuffer),i.bufferData(i.ARRAY_BUFFER,e,i.DYNAMIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,this.normalsBuffer),i.bufferData(i.ARRAY_BUFFER,n,i.DYNAMIC_DRAW);var r=this.module._eyeGetCenterPosition(this.eyePointer);this.centerPosition[0]=this.module.HEAPF32[0+(r>>2)],this.centerPosition[1]=this.module.HEAPF32[1+(r>>2)],this.centerPosition[2]=this.module.HEAPF32[2+(r>>2)],h.a.subtract(this.localLookDirection,t,this.centerPosition),h.a.normalize(this.localLookDirection,this.localLookDirection);var o=Object(f.b)(Math.atan2(this.localLookDirection[0],this.localLookDirection[2]),-Math.PI/2,Math.PI/2*.3),a=Object(f.b)(Math.acos(this.localLookDirection[1]),0,.55*Math.PI);this.lookYaw=Object(f.l)(this.lookYaw,o,.5),this.lookPitch=Object(f.l)(this.lookPitch,a,.5),this.lookDirection[0]=Math.sin(this.lookPitch)*Math.sin(this.lookYaw),this.lookDirection[1]=Math.cos(this.lookPitch),this.lookDirection[2]=Math.sin(this.lookPitch)*Math.cos(this.lookYaw)},t}(),m=function(){function t(t,e){this.vertexCount=0,this.gl=t,this.positionsBuffer=t.createBuffer(),this.colorsBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.positionsData=new Float32Array(3*e*3),this.colorsData=new Float32Array(3*e*4),this.clear()}return t.prototype.clear=function(){this.vertexCount=0},t.prototype.drawTriangle=function(t,e,n,i,r,o,a,s,l,u,c,h,f){this.positionsData[3*this.vertexCount+0]=t,this.positionsData[3*this.vertexCount+1]=e,this.positionsData[3*this.vertexCount+2]=n,this.positionsData[3*this.vertexCount+3]=i,this.positionsData[3*this.vertexCount+4]=r,this.positionsData[3*this.vertexCount+5]=o,this.positionsData[3*this.vertexCount+6]=a,this.positionsData[3*this.vertexCount+7]=s,this.positionsData[3*this.vertexCount+8]=l;for(var d=0;d<3;++d)this.colorsData[4*this.vertexCount+4*d+0]=u,this.colorsData[4*this.vertexCount+4*d+1]=c,this.colorsData[4*this.vertexCount+4*d+2]=h,this.colorsData[4*this.vertexCount+4*d+3]=f;this.vertexCount+=3},t.prototype.commit=function(){var t=this.gl;this.vertexCount>0&&(t.bindBuffer(t.ARRAY_BUFFER,this.positionsBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionsData.subarray(0,3*this.vertexCount),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.colorsBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorsData.subarray(0,4*this.vertexCount),t.DYNAMIC_DRAW))},t}(),g=function(){function t(t,e){this.gl=t,this.maxVertices=e,this.clear(),this.positionsBuffer=t.createBuffer(),this.colorsBuffer=t.createBuffer(),this.positionsData=new Float32Array(3*e),this.colorsData=new Float32Array(4*e)}return t.prototype.clear=function(){this.vertexCount=0},t.prototype.addLine=function(t,e,n,i){for(var r=0;r<3;++r)this.positionsData[3*this.vertexCount+r]=t[r];for(r=0;r<3;++r)this.positionsData[3*this.vertexCount+3+r]=e[r];for(r=0;r<4;++r)this.colorsData[4*this.vertexCount+r]=n[r];for(r=0;r<4;++r)this.colorsData[4*this.vertexCount+4+r]=i[r];this.vertexCount+=2},t.prototype.commit=function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.positionsBuffer),t.bufferData(t.ARRAY_BUFFER,this.positionsData.subarray(0,3*this.vertexCount),t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this.colorsBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorsData.subarray(0,4*this.vertexCount),t.DYNAMIC_DRAW)},t}(),v=function(){function t(t,e,n,i,r){this.indicatorY=new d.a(0),this.alpha=new d.a(0),this.overrideAlpha=new d.a(1),this.soundingAlphas=[],this.yOffset=new d.a(0),this.gl=t,this.scale=e,this.minY=n,this.maxY=i,this.modelMatrix=r;for(var o=0;o<e.length;++o)this.soundingAlphas.push(new d.a(0));this.lines=new g(t,2*(this.scale.length+1)),this.triangles=new m(t,2*this.scale.length+1);var a=[1,1,1,.5];for(o=0;o<=this.scale.length;++o){var s=Object(f.l)(this.minY,this.maxY,o/this.scale.length);this.lines.addLine([0,s,0],[.2,s,0],a,a)}this.lines.commit()}return t.prototype.getModelMatrix=function(){return c.premultiply(new Float32Array(16),this.modelMatrix,c.makeTranslation([],0,this.yOffset.evaluate(),0))},t.prototype.drawRect=function(t,e,n,i,r){this.triangles.drawTriangle(t,e,0,t+n,e,0,t+n,e+i,0,1,1,1,r),this.triangles.drawTriangle(t,e,0,t+n,e+i,0,t,e+i,0,1,1,1,r)},t.prototype.update=function(t,e,n){this.triangles.clear();var i=-1;if(t){this.currentDraggedValue=e;var r=this.scale.indexOf(e);i=r;var o=Object(f.l)(this.minY,this.maxY,(r+.5)/this.scale.length);this.indicatorY.change(o,.05)}this.alpha.change(t?1:0,.2);var a=this.indicatorY.evaluate();this.triangles.drawTriangle(0,a,0,-.1,a-.05,0,-.1,a+.05,0,1,1,1,1),this.currentSoundedValue=n;var s=-1;null!==n&&(s=this.scale.indexOf(n));for(var l=0;l<this.soundingAlphas.length;++l){var u=this.soundingAlphas[l];l===s?u.change(1,.1):l===i?u.change(.1,.1):u.change(0,.1);var c=u.evaluate();if(c>0){var h=(this.maxY-this.minY)/this.scale.length;this.drawRect(0,this.minY+l*h,.2,h,c)}}this.triangles.commit()},t}(),b=n(6);var y=function(){function t(t,e){this.module=t,this.hatPointer=e,this.splinePointCount=this.module._hatGetPointCount(this.hatPointer)}return t.prototype.getSplinePositions=function(){return this.module.HEAPF32.subarray(this.module._hatGetPositions(this.hatPointer)>>2,(this.module._hatGetPositions(this.hatPointer)>>2)+3*this.splinePointCount)},t.prototype.getSplineTangents=function(){return this.module.HEAPF32.subarray(this.module._hatGetTangents(this.hatPointer)>>2,(this.module._hatGetTangents(this.hatPointer)>>2)+3*this.splinePointCount)},t.prototype.getSplineNormals=function(){return this.module.HEAPF32.subarray(this.module._hatGetNormals(this.hatPointer)>>2,(this.module._hatGetNormals(this.hatPointer)>>2)+3*this.splinePointCount)},t}(),x=n(1);function w(t,e){for(var n=t._malloc(e.length),i=t.HEAPU8.subarray(n,n+e.length),r=0;r<e.length;++r)i[r]=e[r];return n}function _(t,e,n){var i=c.makeScale(new Float32Array(16),n,n,n),r=c.fromQuaternion([],e),o=c.makeTranslation(new Float32Array(16),t[0],t[1],t[2]),a=i;return c.premultiply(a,a,r),c.premultiply(a,a,o),a}var P,A=function(){function t(){this.lastBlinkTime=0,this.lastBlinkTime=Date.now()-Object(f.l)(3e3,6e3,Math.random()),this.msToNextBlink=Object(f.l)(3e3,6e3,Math.random())}return t.prototype.evaluate=function(){var t=Date.now();t-this.lastBlinkTime>this.msToNextBlink&&(this.lastBlinkTime=t,this.msToNextBlink=Object(f.l)(3e3,6e3,Math.random()));var e=Math.max(t-this.lastBlinkTime,0);return 1-Object(f.j)(0,120,e)*Object(f.j)(300,180,e)},t}();function S(t,e){return t.midiPitch===e.midiPitch&&t.vowel===e.vowel}function R(t,e,n,i){var r=t.indexOf(n);return-1!==r&&e>(r-i)/t.length&&e<(r+1+i)/t.length?n:t[Object(f.b)(Math.floor(e*t.length),0,t.length-1)]}function T(t,e){if(t<=e[0])return 0;if(t>=e[e.length-1])return e.length-1;for(var n=0;n<e.length-1;++n)if(t>=e[n]&&t<=e[n+1])return n+Object(f.j)(e[n],e[n+1],t)}!function(t){t[t.Offscreen=0]="Offscreen",t[t.Falling=1]="Falling",t[t.Rising=2]="Rising",t[t.Idle=3]="Idle"}(P||(P={}));var E={scale:[1.3,.2,1],bend:0},M={};M[x.b.a]={scale:[1.8,1.8,1],bend:.4},M[x.b.e]={scale:[1.2,1,1],bend:.5},M[x.b.i]={scale:[1.5,.7,1],bend:.5},M[x.b.o]={scale:[.8,.8,2],bend:0},M[x.b.u]={scale:[.4,.4,3],bend:0};var k=[x.b.a,x.b.e,x.b.i,x.b.o,x.b.u];function F(t,e,n){if(t.state===P.Idle){var i=t.rayIntersect(e,n);if(-1!==i){var r=t.indices[3*i+0];return{draggingRestPosition:[t.restPositions[3*r+0],t.restPositions[3*r+1],t.restPositions[3*r+2]]}}return null}}var I=[0,0,1],B=function(){function t(t,e){this.draggingRestPosition=[0,0,0],this.yScale=1,this.zOffset=0,this.localRayOrigin=[0,0,0],this.localRayDirection=[0,0,0],this.localZDirection=[0,0,0],this.planeIntersection=[0,0,0],this.blob=t,this.draggingRestPosition=e}return t.prototype.step=function(t,e){c.transformPosition(this.localRayOrigin,t,this.blob.inverseModelMatrix),c.transformDirection(this.localRayDirection,e,this.blob.inverseModelMatrix),h.a.normalize(this.localRayDirection,this.localRayDirection),c.transformDirection(this.localZDirection,I,this.blob.inverseModelMatrix),Object(f.h)(this.planeIntersection,this.draggingRestPosition,this.localZDirection,this.localRayOrigin,this.localRayDirection),this.localPosition=this.planeIntersection,this.yScale=Math.max(1+.6*(this.planeIntersection[1]-this.draggingRestPosition[1]),.6),this.zOffset=Object(f.b)(.2*(this.planeIntersection[2]-this.draggingRestPosition[2]),-.15,.35)},t}(),C=function(){function t(e,n,i,r,o,a,s,l){this.eyes=[],this.modelMatrix=new Float32Array(16),this.inverseModelMatrix=new Float32Array(16),this.offset=[0,0,0],this.blinker=new A,this.state=P.Offscreen,this.timeCurrentNoteReached=0,this.frame=0,this.fallStartFrame=0,this.fallStartY=0,this.riseStartFrame=0,this.riseStartY=0,this.lookPosition=[0,0,0],this.localLookPosition=[0,0,0],this.yScale=1,this.zOffset=0,this.mouthScaleX=new d.a(E.scale[0]),this.mouthScaleY=new d.a(E.scale[1]),this.mouthScaleZ=new d.a(E.scale[2]),this.mouthBend=new d.a(E.bend),this.isSinging=!1,this.lastSoundedVowel=null,this.isDragging=!1,this.hatOffset=new d.a(1,(function(t){return Object(f.m)(0,1,t)})),this.eyeBottomOpenness=new d.a(0),this.eyeTopOpenness=new d.a(1),this.tempMatrix=new Float32Array(16),this.hatModelMatrix=new Float32Array(16),this.gl=e,this.module=n,this.scale=o,this.bodyColor=h.a.pow(new Float32Array(3),h.a.hsvToRGB(new Float32Array(3),[s,.8,1]),J),this.mouthColor=h.a.pow(new Float32Array(3),h.a.hsvToRGB(new Float32Array(3),[s+.07,.8,1]),J);var m=w(this.module,i),g=w(this.module,r);this.blobPointer=this.module._createBlob(m,i.length,g,r.length,l),this.mouthIndex=this.module._blobGetMouthIndex(this.blobPointer),this.topIndex=this.module._blobGetTopIndex(this.blobPointer),this.vertexCount=this.module._blobGetVertexCount(this.blobPointer),this.renderingVertexCount=this.module._blobGetRenderingVertexCount(this.blobPointer),this.renderingIndexCount=this.module._blobGetRenderingIndexCount(this.blobPointer),this.indexCount=this.module._blobGetIndexCount(this.blobPointer),this.indices=this.module.HEAPU16.subarray(this.module._blobGetIndices(this.blobPointer)>>1,(this.module._blobGetIndices(this.blobPointer)>>1)+this.indexCount).slice(0);var S=this.module.HEAPU16.subarray(this.module._blobGetRenderingIndices(this.blobPointer)>>1,(this.module._blobGetRenderingIndices(this.blobPointer)>>1)+this.renderingIndexCount).slice(0);this.indexBuffer=u(e,e.ELEMENT_ARRAY_BUFFER,S,e.STATIC_DRAW),this.positionsBuffer=e.createBuffer(),this.normalsBuffer=e.createBuffer();var R=this.module.HEAPF32.subarray(this.module._blobGetRenderingUVs(this.blobPointer)>>2,(this.module._blobGetRenderingUVs(this.blobPointer)>>2)+2*this.renderingVertexCount);this.uvsBuffer=u(e,e.ARRAY_BUFFER,R,e.STATIC_DRAW),this.restPositions=this.module.HEAPF32.subarray(this.module._blobGetRestPositions(this.blobPointer)>>2,(this.module._blobGetRestPositions(this.blobPointer)>>2)+3*this.vertexCount).slice(0);for(var T=0;T<2;++T){var M=this.module._blobGetEye(this.blobPointer,T);this.eyes.push(new p(e,this.module,M))}this.hat=new y(this.module,this.module._blobGetHat(this.blobPointer)),this.baseModelMatrix=new Float32Array(function(t,e,n,i){var r=c.makeScale(new Float32Array(16),i,i,i),o=c.makeYRotation(new Float32Array(16),n),a=c.makeXRotation(new Float32Array(16),e),s=c.makeTranslation(new Float32Array(16),t[0],t[1],t[2]),l=r;return c.premultiply(l,l,a),c.premultiply(l,l,o),c.premultiply(l,l,s),l}(a,0,Math.PI/4,1)),this.mouthTriangleIndexCount=this.module._blobGetMouthTriangleIndexCount(this.blobPointer);var F=this.module.HEAPU16.subarray(this.module._blobGetMouthTriangleIndices(this.blobPointer)>>1,(this.module._blobGetMouthTriangleIndices(this.blobPointer)>>1)+this.mouthTriangleIndexCount);this.mouthTriangleIndexBuffer=u(e,e.ELEMENT_ARRAY_BUFFER,F,e.STATIC_DRAW),this.mouthPositionCount=this.module._blobGetMouthPositionCount(this.blobPointer),this.mouthGeometry=function(t,e,n,i){for(var r=[],o=0;o<e;++o)for(var a=0;a<n;++a)for(var s=o+a/n,l=0;l<i;++l){var c=2*Math.PI*l/i,h=Math.cos(c),f=Math.sin(c);r.push(h),r.push(f),r.push(s),r.push(0)}var d=u(t,t.ARRAY_BUFFER,new Float32Array(r),t.STATIC_DRAW),p=[],m=e*n;for(o=0;o<m;++o)for(l=0;l<i;++l){var g=0+o*i+l,v=0+o*i+(l+1)%i,b=0+(o+1)%m*i+l,y=0+(o+1)%m*i+(l+1)%i;p.push(g),p.push(b),p.push(y),p.push(y),p.push(v),p.push(g)}return{vertexBuffer:d,indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(p),t.STATIC_DRAW),indexCount:p.length}}(e,this.mouthPositionCount,10,10),this.tonguePointer=this.module._blobGetTongue(this.blobPointer),this.tonguePositionCount=this.module._tongueGetPointCount(this.tonguePointer),this.currentPitchVowel={midiPitch:0,vowel:x.b.a},this.mouthY=this.getRestPosition(this.mouthIndex)[1],this.liveMidiNote=new d.a(this.scale[0]),this.frame=Math.floor(1e4*Math.random());var I=_([0,0,1.5],b.a.fromAxisAngle([],[0,1,0],-Math.PI/2),1),B=c.premultiply(new Float32Array(16),I,this.baseModelMatrix);this.pitchUI=new v(e,this.scale,t.MIN_Y,t.MAX_Y,B);var C=_([0,.4,0],b.a.multiply([],b.a.fromAxisAngle([],[0,1,0],Math.PI/2),b.a.fromAxisAngle([],[0,0,1],Math.PI/2)),1),D=c.premultiply(new Float32Array(16),C,this.baseModelMatrix);this.vowelUI=new v(e,k,t.MIN_Z,t.MAX_Z,D)}return t.prototype.recomputeMatrices=function(){var t=c.makeTranslation(this.tempMatrix,this.offset[0],this.offset[1],this.offset[2]);c.premultiply(this.modelMatrix,this.baseModelMatrix,t),c.invert(this.inverseModelMatrix,this.modelMatrix)},t.prototype.startFalling=function(t){this.state!==P.Falling&&(this.fallStartFrame=this.frame+(this.state===P.Rising?0:t),this.state===P.Rising?this.fallStartY=this.getRiseY():this.fallStartY=12,this.state=P.Falling,this.module._blobReset(this.blobPointer,1,0,0,0,0),this.offset[1]=this.fallStartY,this.recomputeMatrices())},t.prototype.startRising=function(t){this.state!==P.Rising&&(this.state===P.Falling?this.riseStartY=this.getFallY():this.riseStartY=0,this.riseStartFrame=this.frame+(this.state===P.Falling?0:t),this.state=P.Rising,this.offset[1]=0,this.recomputeMatrices())},t.prototype.getFallY=function(){if(this.state===P.Falling){var e=Math.max(0,this.frame-this.fallStartFrame);return this.fallStartY+t.INITIAL_FALL_SPEED*e+.5*t.GRAVITY*e*e}return 0},t.prototype.getFallVelocity=function(){if(this.state===P.Falling){return Math.max(0,this.frame-this.fallStartFrame)*t.GRAVITY-.02}return 0},t.prototype.getRiseY=function(){var e=Math.max(0,this.frame-this.riseStartFrame);return this.riseStartY+t.INITIAL_RISE_SPEED*e+.5*t.RISE_ACCELERATION*e*e},t.prototype.step=function(e,n){var i=n?function(t){return t.getMuted()||!(t.getPhoneme()in M)?E:t.getPhoneme()in M?M[t.getPhoneme()]:null}(n):E;this.mouthScaleX.change(i.scale[0],.1),this.mouthScaleY.change(i.scale[1],.1),this.mouthScaleZ.change(i.scale[2],.1),this.mouthBend.change(i.bend,.1);var r=1+.04*Math.sin(.5*this.frame);n&&!n.getMuted()||(r=1),this.module._blobSetMouthScale(this.blobPointer,this.mouthScaleX.evaluate()*r,this.mouthScaleY.evaluate()*r,this.mouthScaleZ.evaluate()*r),this.module._blobSetMouthBend(this.blobPointer,this.mouthBend.evaluate()),this.module._blobSetMouthNoiseScale(this.blobPointer,!n||n.getMuted()?0:.04*this.mouthScaleY.evaluate()),this.module._blobSetMouthNoiseFrequency(this.blobPointer,2.5),this.module._blobSetMouthNoiseOffset(this.blobPointer,.05*this.frame),this.isSinging=n&&!n.getMuted(),this.isSinging&&Object(f.i)(n.getVowel())&&(this.lastSoundedVowel=n.getVowel());var o=[0,0,0];if(this.state===P.Idle)if(e.length>0){for(var a=0,s=0,l=0,u=e;l<u.length;l++){var h=u[l];a+=h.yScale/e.length,s+=h.zOffset/e.length}this.yScale=a,this.zOffset=s,this.module._blobSetMouthDamping(this.blobPointer,.05),this.module._blobSetDamping(this.blobPointer,.995),this.module._blobSetIsDragging(this.blobPointer,!0),this.isDragging=!0}else if(this.module._blobSetIsDragging(this.blobPointer,!1),this.isDragging=!1,!n||n.getMuted()){this.yScale=Object(f.l)(this.yScale,1,.07),this.zOffset=Object(f.l)(this.zOffset,0,.07),this.module._blobSetMouthDamping(this.blobPointer,.995)}else{var d=n.getF0(),p=Object(f.g)(d)-ht,m=T(p,this.scale),g=1+m/(this.scale.length-1)*.5,v=.1;if(n.getControlled())g=Object(f.l)(t.MIN_Y,t.MAX_Y,m/(this.scale.length-1))/this.getRestPosition(this.mouthIndex)[1],v=.3;this.yScale=Object(f.l)(this.yScale,g,v),this.module._blobSetMouthDamping(this.blobPointer,0),this.module._blobSetDamping(this.blobPointer,.995);var b=0;if(n.getControlled())b=T(this.lastSoundedVowel,k)/(k.length-1)*.1-.05;this.zOffset=Object(f.l)(this.zOffset,b,.3),this.liveMidiNote.change(p,0)}else if(this.state===P.Falling){var y=this.getFallY(),w=this.getFallVelocity();this.offset[1]=y,y<=0&&(this.state=P.Idle,this.offset[1]=0,this.module._blobAddImpulse(this.blobPointer,0,60*w,0)),this.module._blobSetMouthDamping(this.blobPointer,.97),this.module._blobSetDamping(this.blobPointer,.97)}else if(this.state===P.Rising){y=this.getRiseY();this.offset[1]=y;y>=12&&(this.state=P.Offscreen,this.offset[1]=12),this.module._blobSetMouthDamping(this.blobPointer,.97),this.module._blobSetDamping(this.blobPointer,.97)}var _=2*this.frame,A=this.isSinging?.4:0;this.module._blobSetNoiseParameters(this.blobPointer,100,_,A);var F=1+.2*Math.sin(this.frame/60*3);this.module._blobSetBreathVolumeScale(this.blobPointer,F);var I=this.isSinging?2:0;if(this.module._tongueSetWindForce(this.tonguePointer,.006),this.module._tongueSetOscillationScale(this.tonguePointer,I),this.module._blobStep(this.blobPointer,this.yScale,this.zOffset,o[0],o[1],o[2]),e.length>0){var B=this.getVertexPosition(this.mouthIndex);this.mouthY=Object(f.l)(this.mouthY,B[1],1);var C={midiPitch:R(this.scale,Object(f.j)(t.MIN_Y,t.MAX_Y,this.mouthY),this.currentPitchVowel.midiPitch,.3),vowel:R(k,Object(f.j)(t.MIN_Z,t.MAX_Z,B[2]),this.currentPitchVowel.vowel,.2)};this.liveMidiNote.change(C.midiPitch,.2),S(this.currentPitchVowel,C)||(this.timeCurrentNoteReached=Date.now(),this.currentPitchVowel=C)}else this.currentPitchVowel={midiPitch:0,vowel:x.b.a};var D=this.isSinging?n.getMidiNote()-ht:null;this.pitchUI.update(!!e.find((function(t){return t.isSelf})),this.currentPitchVowel.midiPitch,D),this.vowelUI.update(!!e.find((function(t){return t.isSelf})),this.currentPitchVowel.vowel,this.isSinging?this.lastSoundedVowel:null),this.recomputeMatrices(),c.transformPosition(this.localLookPosition,this.lookPosition,this.inverseModelMatrix);for(var L=0,O=this.eyes;L<O.length;L++){O[L].step(this.localLookPosition)}this.updateRenderData(),this.frame+=1},t.prototype.getTimeOnCurrentNote=function(){return(Date.now()-this.timeCurrentNoteReached)/1e3},t.prototype.updateRenderData=function(){var t=this.module.HEAPF32.subarray(this.module._blobGetRenderingPositions(this.blobPointer)>>2,(this.module._blobGetRenderingPositions(this.blobPointer)>>2)+3*this.renderingVertexCount),e=this.module.HEAPF32.subarray(this.module._blobGetRenderingNormals(this.blobPointer)>>2,(this.module._blobGetRenderingNormals(this.blobPointer)>>2)+3*this.renderingVertexCount),n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,this.positionsBuffer),n.bufferData(n.ARRAY_BUFFER,t,n.DYNAMIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,this.normalsBuffer),n.bufferData(n.ARRAY_BUFFER,e,n.DYNAMIC_DRAW)},t.prototype.getMouthPositions=function(){return this.module.HEAPF32.subarray(this.module._blobGetMouthPositions(this.blobPointer)>>2,(this.module._blobGetMouthPositions(this.blobPointer)>>2)+3*this.mouthPositionCount)},t.prototype.rayIntersect=function(t,e){var n=c.transformPosition([],t,this.inverseModelMatrix),i=c.transformDirection([],e,this.inverseModelMatrix);return h.a.normalize(i,i),this.module._blobRayIntersect(this.blobPointer,n[0],n[1],n[2],i[0],i[1],i[2])},t.prototype.getVertexPosition=function(t){return this.module.HEAPF32.subarray((this.module._blobGetPositions(this.blobPointer)>>2)+3*t,(this.module._blobGetPositions(this.blobPointer)>>2)+3*t+3)},t.prototype.getRestPosition=function(t){return this.module.HEAPF32.subarray((this.module._blobGetRestPositions(this.blobPointer)>>2)+3*t,(this.module._blobGetRestPositions(this.blobPointer)>>2)+3*t+3)},t.prototype.getBrimPositions=function(){return this.module.HEAPF32.subarray(this.module._blobGetBrimPositions(this.blobPointer)>>2,48+(this.module._blobGetBrimPositions(this.blobPointer)>>2))},t.prototype.getHatModelMatrix=function(){return c.premultiply(this.hatModelMatrix,c.makeTranslation(this.tempMatrix,0,10*this.hatOffset.evaluate(),0),this.modelMatrix),this.hatModelMatrix},t.prototype.getTonguePositions=function(){return this.module.HEAPF32.subarray(this.module._tongueGetPositions(this.tonguePointer)>>2,(this.module._tongueGetPositions(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getTongueTangents=function(){return this.module.HEAPF32.subarray(this.module._tongueGetTangents(this.tonguePointer)>>2,(this.module._tongueGetTangents(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getTongueNormals=function(){return this.module.HEAPF32.subarray(this.module._tongueGetNormals(this.tonguePointer)>>2,(this.module._tongueGetNormals(this.tonguePointer)>>2)+3*this.tonguePositionCount)},t.prototype.getBottomEyelidAngle=function(){return this.blinker.evaluate()*this.eyeBottomOpenness.evaluate()*Math.PI*.5},t.prototype.getTopEyelidAngle=function(){return this.blinker.evaluate()*this.eyeTopOpenness.evaluate()*Math.PI*.5},t.MIN_Y=1.1,t.MAX_Y=5,t.MIN_Z=0,t.MAX_Z=2,t.INITIAL_FALL_SPEED=-.02,t.GRAVITY=-.002,t.INITIAL_RISE_SPEED=0,t.RISE_ACCELERATION=.006,t}();function D(t,e){return t+Math.random()*(e-t)}function L(t,e,n,i){var r=D(-10,10),o=D(-10,10);return[r,(-i-t*r-n*o)/e,o]}var O=function(){function t(t,e,n,i){this.particleCount=1e4,this.nextSpawnIndex=0,this.gl=t;for(var r=[],o=[],a=0;a<this.particleCount;++a){o.push(-1,-1),o.push(1,-1),o.push(1,1),o.push(-1,1);var s=4*a;r.push(s+0,s+1,s+2),r.push(s+2,s+3,s+0)}this.offsetBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW);var l=-i[1]+i[3],c=-i[5]+i[7],h=-i[9]+i[11],f=-i[13]+i[15],d=[],p=[];for(a=0;a<this.particleCount;++a)for(var m=e?-(this.particleCount-1-a)/n:-999999999,g=e?L(l,c,h,f):[0,0,0],v=0;v<4;++v)d.push(m),p.push(g[0]),p.push(g[1]),p.push(g[2]);this.spawnTimeBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(d),t.DYNAMIC_DRAW),this.spawnPositionBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(p),t.DYNAMIC_DRAW);var b=[];for(a=0;a<this.particleCount;++a){var y=[Math.random(),Math.random(),Math.random(),Math.random()];for(v=0;v<4;++v)b.push(Math.random(),y[1],y[2],y[3])}this.randomBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(b),t.STATIC_DRAW),this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW),this.spawnTimeData=new Float32Array(4*this.particleCount),this.spawnPositionData=new Float32Array(3*this.particleCount*4)}return t.prototype.prespawn=function(t){},t.prototype.spawn=function(t,e,n,i){if(0!==e){this.nextSpawnIndex+e>=this.particleCount&&(this.nextSpawnIndex=0);for(var r=-i[1]+i[3],o=-i[5]+i[7],a=-i[9]+i[11],s=-i[13]+i[15],l=0;l<e;++l)for(var u=L(r,o,a,s),c=t-Math.random()*n,h=0;h<4;++h)this.spawnTimeData[4*l+h]=c,this.spawnPositionData[4*l*3+3*h+0]=u[0],this.spawnPositionData[4*l*3+3*h+1]=u[1],this.spawnPositionData[4*l*3+3*h+2]=u[2];var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,this.spawnTimeBuffer),f.bufferSubData(f.ARRAY_BUFFER,4*this.nextSpawnIndex*4,this.spawnTimeData.subarray(0,4*e)),f.bindBuffer(f.ARRAY_BUFFER,this.spawnPositionBuffer),f.bufferSubData(f.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnPositionData.subarray(0,4*e*3)),this.nextSpawnIndex+=e}},t.prototype.update=function(t,e,n,i){var r=Math.floor(e*n);this.spawn(t,r,e,i)},t}();var N=[1,.37,.3];function U(t,e){for(var n=[],i=0;i<3;++i){var r=e/(.001+N[i]);n[i]=Math.exp(-r*r/(2*t))/(2*Math.PI*t)}return n}function j(t){var e=function(t){for(var e=t>20?3:2,n=[],i=2*e/(t-1),r=0;r<t;++r){var o=r*i-e,a=o<0?-1:1;n.push(e*a*Math.abs(Math.pow(o,2))/Math.pow(e,2))}var s,l=[];for(r=0;r<t;++r){var u=((r>0?Math.abs(n[r]-n[r-1]):0)+(r<t-1?Math.abs(n[r]-n[r+1]):0))/2;(c=h.a.multiplyByScalar([],(s=n[r],h.a.addList([],[h.a.multiplyByScalar([],U(.0484,s),.1),h.a.multiplyByScalar([],U(.187,s),.118),h.a.multiplyByScalar([],U(.567,s),.113),h.a.multiplyByScalar([],U(1.99,s),.358),h.a.multiplyByScalar([],U(7.41,s),.078)])),u))[3]=n[r],l.push(c)}var c=l[Math.floor(t/2)];for(r=Math.floor(t/2);r>0;--r)l[r]=l[r-1];l[0]=c;var f=h.a.addList([],l);for(r=0;r<t;++r)l[r][0]/=f[0],l[r][1]/=f[1],l[r][2]/=f[2];return l}(t),n="precision highp float;\n\n        varying vec2 v_coordinates;\n\n        uniform sampler2D u_colorTexture;\n\n        uniform vec2 u_direction;\n        uniform vec2 u_resolution;\n\n        uniform mat4 u_projectionMatrix;\n        uniform float u_near;\n        uniform float u_far;\n\n        #define SSS_INDEX_COUNT 8\n        float getSSSAlpha(int sssIndex) {\n            return float(sssIndex + 1) / float(SSS_INDEX_COUNT);\n        }\n\n        int sssAlphaToIndex(float sssAlpha) {\n            return int(sssAlpha * float(SSS_INDEX_COUNT) - 0.9);\n        }\n\n        float linearizeDepth (float depth, float near, float far) {\n            depth = 2.0 * depth - 1.0;\n            return 2.0 * near * far / (far + near - depth * (far - near));\n        }\n\n        float rand(vec2 co){\n            return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n        }\n\n        void main () {\n            vec4 color = texture2D(u_colorTexture, v_coordinates);\n\n            if (color.a == 0.0) discard;\n\n            vec3 colorM = color.rgb;\n            float z = 20.0;\n\n            float width = 0.1; //filter width in world space\n            width *= (1.0 + rand(gl_FragCoord.xy) * 0.3);\n\n            vec4 corner = vec4(width, width, z, 1.0);\n            corner = u_projectionMatrix * corner;\n            corner.xyz /= corner.w;\n            corner.xy *= 0.5;\n            corner.xy = abs(corner.xy);\n\n            int sssIndex = sssAlphaToIndex(color.a);\n            vec3 strength = vec3(0.2);\n\n            if (sssIndex == 0) {\n                strength = vec3(0.8, 0.3, 0.0);\n            } else if (sssIndex == 1) {\n                strength = vec3(0.0, 1.0, 0.3);\n            } else if (sssIndex == 2) {\n                strength = vec3(0.0, 1.0, 0.3);\n            } else if (sssIndex == 3) {\n                strength = vec3(0.58, 0.2, 0.0);\n            }\n\n            vec3 kernel0 = "+("vec3("+e[0][0].toFixed(10)+","+e[0][1].toFixed(10)+","+e[0][2].toFixed(10)+")")+";\n            kernel0 = (1.0 - strength) + strength * kernel0;\n\n            vec3 colorBlurred = colorM;\n            colorBlurred *= kernel0;\n\n            vec2 delta = u_direction * corner.xy;\n    ";n+="\n";for(var i=1;i<e.length;++i){var r=e[i],o="sample"+i.toFixed(0);n+="\n            vec4 "+o+" = texture2D(u_colorTexture, v_coordinates + delta * "+r[3].toFixed(10)+");\n            //'if (' + sampleName + '.a == 0.0) ' + sampleName + '.rgb = colorM;\n            "+o+".rgb = color.a == "+o+".a ? "+o+".rgb : colorM;\n            colorBlurred.rgb += vec3("+r[0].toFixed(10)+", "+r[1].toFixed(10)+", "+r[2].toFixed(10)+") * "+o+".rgb * strength;\n        "}return n+="\n            gl_FragColor = vec4(colorBlurred, color.a);\n        }"}function z(t,e){return t+Math.random()*(e-t)}function G(t,e){var n=z(-10,10),i=z(-10,10),r=z(-10,10);return 0===e?n=(-t.d-t.b*i-t.c*r)/t.a:1===e&&(i=(-t.d-t.a*n-t.c*r)/t.b),[n,i,r]}function V(t,e){t.a=-e[1]+e[3],t.b=-e[5]+e[7],t.c=-e[9]+e[11],t.d=-e[13]+e[15]}function H(t,e){t.a=e[1]+e[3],t.b=e[5]+e[7],t.c=e[9]+e[11],t.d=e[13]+e[15]}function Y(t,e){t.a=-e[0]+e[3],t.b=-e[4]+e[7],t.c=-e[8]+e[11],t.d=-e[12]+e[15]}function W(t,e){t.a=e[0]+e[3],t.b=e[4]+e[7],t.c=e[8]+e[11],t.d=e[12]+e[15]}var q=["left","right","bottom","top"],X=function(){function t(t,e,n,i){this.particleCount=1e4,this.nextSpawnIndex=0,this.gl=t;for(var r=[],o=[],a=0;a<this.particleCount;++a){o.push(-1,-1),o.push(1,-1),o.push(1,1),o.push(-1,1);var s=4*a;r.push(s+0,s+1,s+2),r.push(s+2,s+3,s+0)}this.offsetBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(o),t.STATIC_DRAW),this.spawnTimeBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount),t.DYNAMIC_DRAW),this.spawnPositionBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount*3),t.DYNAMIC_DRAW),this.spawnVelocityBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(4*this.particleCount*3),t.DYNAMIC_DRAW);var l=[];for(a=0;a<this.particleCount;++a)for(var c=[Math.random(),Math.random(),Math.random(),Math.random()],h=0;h<4;++h)l.push(Math.random(),c[1],c[2],c[3]);this.randomBuffer=u(t,t.ARRAY_BUFFER,new Float32Array(l),t.STATIC_DRAW),this.indexBuffer=u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW),this.spawnTimeData=new Float32Array(4*this.particleCount*1),this.spawnPositionData=new Float32Array(4*this.particleCount*3),this.spawnVelocityData=new Float32Array(4*this.particleCount*3),e&&this.spawn(0,this.particleCount,0,i,1/n)}return t.prototype.spawn=function(t,e,n,i,r){if(0!==e){this.nextSpawnIndex+e>=this.particleCount&&(this.nextSpawnIndex=0);for(var o=0;o<e;++o){var a=q[Math.floor(Math.random()*q.length)],s={a:0,b:0,c:0,d:0},l=.5*Math.PI,u=z(-l/2,l/2),c=0;"left"===a?(Y(s,i),c=Math.PI+u):"right"===a?(W(s,i),c=0+u):"top"===a?(V(s,i),c=-Math.PI/2+u):"bottom"===a&&(H(s,i),c=Math.PI/2+u);var h=void 0;"left"===a||"right"===a?h=G(s,0):"bottom"!==a&&"top"!==a||(h=G(s,1));for(var f=z(.01,.1),d=t-Math.random()*n-(this.particleCount-1-o)*r,p=0;p<4;++p)this.spawnTimeData[4*o+p]=d,this.spawnPositionData[4*o*3+3*p+0]=h[0],this.spawnPositionData[4*o*3+3*p+1]=h[1],this.spawnPositionData[4*o*3+3*p+2]=h[2],this.spawnVelocityData[4*o*3+3*p+0]=Math.cos(c)*f,this.spawnVelocityData[4*o*3+3*p+1]=Math.sin(c)*f,this.spawnVelocityData[4*o*3+3*p+2]=0}var m=this.gl;m.bindBuffer(m.ARRAY_BUFFER,this.spawnTimeBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*4,this.spawnTimeData.subarray(0,4*e)),m.bindBuffer(m.ARRAY_BUFFER,this.spawnPositionBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnPositionData.subarray(0,4*e*3)),m.bindBuffer(m.ARRAY_BUFFER,this.spawnVelocityBuffer),m.bufferSubData(m.ARRAY_BUFFER,4*this.nextSpawnIndex*3*4,this.spawnVelocityData.subarray(0,4*e*3)),this.nextSpawnIndex+=e}},t.prototype.update=function(t,e,n,i){var r=Math.floor(e*n);this.spawn(t,r,e,i,0)},t}();var J=2.2,Z="\nprecision highp float;\n\nattribute vec4 a_data;\n\nuniform int u_vertexCount;\nuniform vec3 u_positions[12];\n\nuniform mat4 u_modelMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\n\n#ifdef SHADOW\nvarying vec4 v_clipSpacePosition;\n#endif\n\nvec3 sampleFilament(float filamentIndex, float vertexIndex) {\n    return u_positions[int(vertexIndex + 0.001)] + vec3(0.0, 0.0, 0.05);\n}\n\nvec3 evaluateCubicSpline(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    float t3 = t2 * t;\n\n    return (2.0 * t3 - 3.0 * t2 + 1.0) * leftPosition + (t3 - 2.0 * t2 + t) * leftTangent + (-2.0 * t3 + 3.0 * t2) * rightPosition + (t3 - t2) * rightTangent;\n}\n\nvec3 evaluateCubicSplineTangent(vec3 leftPosition, vec3 rightPosition, vec3 leftTangent, vec3 rightTangent, float t) {\n    float t2 = t * t;\n    return (6.0 * t2 - 6.0 * t) * leftPosition + (3.0 * t2 - 4.0 * t + 1.0) * leftTangent + (-6.0 * t2 + 6.0 * t) * rightPosition + (3.0 * t2 - 2.0 * t) * rightTangent;\n}\n\nfloat posMod(float i, float n) {\n    return mod((n + mod(i, n)), n);\n}\n\nvoid main () {\n    vec3 position = a_data.xyz;\n    float filamentIndex = a_data.w;\n\n    float index = position.z;\n    float leftIndex = floor(position.z + 0.001);\n    float rightIndex = floor(mod(leftIndex + 1.0001, float(u_vertexCount)));\n    \n    float t = clamp(index - leftIndex, 0.0, 1.0);\n\n    vec3 leftLeftPosition = sampleFilament(filamentIndex, floor(posMod(leftIndex - 0.9999, float(u_vertexCount)))).xyz;\n    vec3 leftPosition = sampleFilament(filamentIndex, leftIndex).xyz;\n    vec3 rightPosition = sampleFilament(filamentIndex, rightIndex).xyz;\n    vec3 rightRightPosition = sampleFilament(filamentIndex, floor(posMod(rightIndex + 1.0001, float(u_vertexCount)))).xyz;\n\n    vec3 leftTangent = (rightPosition - leftLeftPosition) * 0.5;\n    vec3 rightTangent = (rightRightPosition - leftPosition) * 0.5;\n\n    //vec3 tangent = normalize(mix(leftTangent, rightTangent, t));\n    vec3 tangent = normalize(evaluateCubicSplineTangent(leftPosition, rightPosition, leftTangent, rightTangent, t));\n\n    float radius = 0.06;\n\n    vec3 right = normalize(cross(tangent, vec3(0.0, 0.0, 1.0))) * radius;\n    vec3 up = normalize(cross(right, tangent)) * radius;\n\n    vec3 localNormal = normalize(position.x * right + position.y * up);\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    vec3 localPosition = evaluateCubicSpline(leftPosition, rightPosition, leftTangent, rightTangent, t) + position.x * right + position.y * up;\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_position = worldPosition;\n\n    #ifdef SHADOW\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    #endif\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n\n    //gl_Position = vec4(position.xz, 0.0, 1.0);\n}\n",Q="\nprecision highp float;\n\nvarying vec4 v_clipSpacePosition;\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\n\nvoid main () {\n\tfloat ndcDepth = v_clipSpacePosition.z / v_clipSpacePosition.w;\n\tgl_FragColor = packDepthToRGBA(ndcDepth * 0.5 + 0.5);\n}\n",K="\nprecision highp float;\n\nattribute vec4 a_parameters; //(aroundIndex, alongIndex, scale, material)\nattribute vec3 a_normal;\n\nvarying vec3 v_worldPosition;\nvarying vec3 v_color;\nvarying vec3 v_normal;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\n\nuniform vec3 u_profilePoints[16];\n\n#define PI 3.14159265358979323846\n#define SPLINE_POINT_COUNT 10\n\nuniform vec3 u_splinePositions[SPLINE_POINT_COUNT];\nuniform vec3 u_splineTangents[SPLINE_POINT_COUNT];\nuniform vec3 u_splineNormals[SPLINE_POINT_COUNT];\n\n#ifdef SHADOW\nvarying vec4 v_clipSpacePosition;\n#endif\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main() {\n    float aroundIndex = a_parameters.x;\n    float alongIndex = a_parameters.y;\n    float scale = a_parameters.z;\n    float material = a_parameters.w;\n\n    float angle = 2.0 * PI * float(aroundIndex) / 16.0;\n    vec3 flatPlanarPosition = vec3(\n        -cos(angle),\n        -sin(angle),\n        0.0\n    ) * 0.35;\n\n    vec3 planarPosition = u_profilePoints[int(aroundIndex + 0.1)];\n    planarPosition = mix(planarPosition, flatPlanarPosition, linearstep(3.0, float(SPLINE_POINT_COUNT - 1), alongIndex));\n\n    vec3 planarNormal = a_normal;\n\n    vec3 framePosition = vec3(0.0);\n    vec3 frameTangent = vec3(0.0);\n    vec3 frameNormal = vec3(0.0);\n\n    float SPACING = 0.13;\n\n    if (alongIndex >= float(SPLINE_POINT_COUNT - 1)) {\n        framePosition = u_splinePositions[SPLINE_POINT_COUNT - 1] + u_splineTangents[SPLINE_POINT_COUNT - 1] * SPACING * (alongIndex - float(SPLINE_POINT_COUNT - 1));\n        frameTangent = u_splineTangents[SPLINE_POINT_COUNT - 1];\n        frameNormal = u_splineNormals[SPLINE_POINT_COUNT - 1];\n    } else if (alongIndex <= 0.0) {\n        framePosition = u_splinePositions[0];\n        frameTangent = u_splineTangents[0];\n        frameNormal = u_splineNormals[0];\n    } else {\n        int leftIndex = int(alongIndex + 0.001);\n        int rightIndex = leftIndex + 1;\n\n        framePosition = mix(u_splinePositions[leftIndex], u_splinePositions[rightIndex], fract(alongIndex));\n        frameTangent = normalize(mix(u_splineTangents[leftIndex], u_splineTangents[rightIndex], fract(alongIndex)));\n        frameNormal = normalize(mix(u_splineNormals[leftIndex], u_splineNormals[rightIndex], fract(alongIndex)));\n    }\n\n    vec3 frameRight = normalize(cross(frameTangent, frameNormal));\n\n    vec3 localPosition = framePosition + planarPosition.x * frameRight * scale + planarPosition.y * frameNormal * scale + planarPosition.z * frameTangent;\n    vec3 localNormal = normalize(planarNormal.x * frameRight + planarNormal.y * frameNormal + planarNormal.z * frameTangent);\n\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    v_color = material < 0.5 ? vec3(1.0, 1.0, 1.0) : vec3(1.0, vec2(0.03));\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_worldPosition = worldPosition;\n\n    #ifdef SHADOW\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    #endif\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",$="\nprecision highp float;\n\nattribute vec2 a_position;\n\nvarying vec2 v_coordinates;\n\nvoid main () {\n    v_coordinates = a_position * 0.5 + 0.5;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}\n",tt=function(t,e,n,i,r){this.color=new Float32Array([r,r,r]);var a=[0,3.5,2];this.position=new Float32Array([a[0]+i*Math.sin(Math.PI/2-n)*Math.sin(-e),a[1]+i*Math.cos(Math.PI/2-n),a[2]+i*Math.sin(Math.PI/2-n)*Math.cos(-e)]),this.viewMatrix=c.makeLookAt(new Float32Array(16),this.position,[0,.5,0],[0,1,0]),c.invert(this.viewMatrix,this.viewMatrix),this.projectionMatrix=c.makePerspective(new Float32Array(16),Math.PI/8,1,.5,100),this.projectionViewMatrix=c.premultiply(new Float32Array(16),this.viewMatrix,this.projectionMatrix),this.shadowMapWidth=512,this.depthColorTexture=o(t,0,t.RGBA,t.UNSIGNED_BYTE,this.shadowMapWidth,this.shadowMapWidth,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),this.depthRenderbuffer=l(t,t.DEPTH_COMPONENT16,this.shadowMapWidth,this.shadowMapWidth)},et=function(){function t(t,e,n,r,a,h,p){this.projectionMatrix=new Float32Array(16),this.infiniteProjectionMatrix=new Float32Array(16),this.referenceProjectionMatrix=new Float32Array(16),this.inverseProjectionMatrix=new Float32Array(16),this.viewMatrix=new Float32Array(16),this.inverseViewMatrix=new Float32Array(16),this.cameraPosition=new Float32Array(3),this.projectionViewMatrix=new Float32Array(16),this.lights=[],this.dustScale=new d.a(0),this.paddingHeight=0,this.snowSpawnRate=0,this.backgroundIntensity=new d.a(0),this.canvas=t,this.gl=e;var m="\nprecision highp float;\n\n#define PI 3.14159265358979323846\n\nuniform vec3 u_cameraPosition;\n\nuniform float u_gamma;\n\nuniform vec3 u_lightPosition0;\nuniform vec3 u_lightColor0;\nuniform mat4 u_lightProjectionViewMatrix0;\nuniform sampler2D u_shadowDepthTexture0;\nuniform vec2 u_shadowResolution0;\n\nuniform vec3 u_lightPosition1;\nuniform vec3 u_lightColor1;\nuniform mat4 u_lightProjectionViewMatrix1;\nuniform sampler2D u_shadowDepthTexture1;\nuniform vec2 u_shadowResolution1;\n\nfloat square (float x) {\n    return x * x;\n}\n\nfloat fresnel (float F0, float lDotH) {\n    float f = pow(1.0 - lDotH, 5.0);\n\n    return (1.0 - F0) * f + F0;\n}\n\nfloat GGX (float alpha, float nDotH) {\n    float a2 = square(alpha);\n\n    return a2 / (PI * square(square(nDotH) * (a2 - 1.0) + 1.0));\n}\n\nfloat GGGX (float alpha, float nDotL, float nDotV) {\n    float a2 = square(alpha);\n\n    float gl = nDotL + sqrt(a2 + (1.0 - a2) * square(nDotL));\n    float gv = nDotV + sqrt(a2 + (1.0 - a2) * square(nDotV));\n\n    return 1.0 / (gl * gv);\n}\n\nfloat saturate (float x) {\n    return clamp(x, 0.0, 1.0);\n}\n\nfloat specularBRDF (vec3 lightDirection, vec3 eyeDirection, vec3 normal, float roughness, float F0) {\n    vec3 halfVector = normalize(lightDirection + eyeDirection);\n\n    float nDotH = saturate(dot(normal, halfVector));\n    float nDotL = saturate(dot(normal, lightDirection));\n    float nDotV = saturate(dot(normal, eyeDirection));\n    float lDotH = saturate(dot(lightDirection, halfVector));\n\n    float D = GGX(roughness, nDotH);\n    float G = GGGX(roughness, nDotL, nDotV);\n    float F = fresnel(F0, lDotH);\n\n    return smoothstep(-0.2, 0.0, dot(lightDirection, normal)) * D * G * F;\n}\n\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n    return step(compare, unpackRGBAToDepth(texture2D( depths, uv)));\n}\n\nfloat texture2DShadow(sampler2D depths, vec2 size, vec2 uv, float compare) {\n    return texture2DCompare(depths, uv, compare);\n}\n\nfloat getShadow (vec3 worldPosition, vec3 worldNormal, mat4 projectionViewMatrix, sampler2D depthTexture, vec2 resolution) {\n    vec4 lightSpacePosition = projectionViewMatrix * vec4(worldPosition + worldNormal * 0.00001, 1.0);\n    lightSpacePosition /= lightSpacePosition.w;\n    lightSpacePosition = lightSpacePosition * 0.5 + 0.5;\n    vec2 lightSpaceCoordinates = lightSpacePosition.xy;\n\n    <shadow>\n}\n\nvec3 shadeSurfaceWithLightWithoutShadow(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0, vec3 lightPosition, vec3 lightColor) {\n    vec3 lightDirection = normalize(lightPosition - worldPosition);\n    vec3 eyeDirection = normalize(u_cameraPosition - worldPosition);\n\n    float diffuse = saturate(dot(lightDirection, worldNormal));\n    float specular = specularBRDF(lightDirection, eyeDirection, worldNormal, roughness, F0);\n\n    float ambient = 0.0;\n    vec3 color = ((diffuse + ambient) * albedo + vec3(specular)) * lightColor;\n\n    return color;\n}\n\nvec3 shadeSurfaceWithLight (vec3 worldPosition, vec3 normal, vec3 albedo, float roughness, float F0, vec3 lightPosition, vec3 lightColor, mat4 projectionViewMatrix, sampler2D depthTexture, vec2 depthResolution) {\n    float shadow = getShadow(worldPosition, normal, projectionViewMatrix, depthTexture, depthResolution);\n    float ambient = 0.04;\n    vec3 color = shadeSurfaceWithLightWithoutShadow(worldPosition, normal, albedo, roughness, F0, lightPosition, lightColor) * shadow + ambient * albedo;\n    return color;\n}\n\nvec3 shadeSurfaceWithLights(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0) {\n    vec3 total = vec3(0.0);\n    total += shadeSurfaceWithLight(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition0, u_lightColor0, u_lightProjectionViewMatrix0, u_shadowDepthTexture0, u_shadowResolution0);\n    total += shadeSurfaceWithLight(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition1, u_lightColor1, u_lightProjectionViewMatrix1, u_shadowDepthTexture1, u_shadowResolution1);\n    return total;\n}\n\nvec3 shadeSurfaceWithLightsWithoutShadow(vec3 worldPosition, vec3 worldNormal, vec3 albedo, float roughness, float F0) {\n    vec3 total = vec3(0.0);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition0, u_lightColor0);\n    total += shadeSurfaceWithLightWithoutShadow(worldPosition, worldNormal, albedo, roughness, F0, u_lightPosition1, u_lightColor1);\n    return total;\n}\n\nfloat getShadowFromLights(vec3 worldPosition) {\n    float total = 1.0;\n    total *= getShadow(worldPosition, vec3(0.0, 1.0, 0.0), u_lightProjectionViewMatrix0, u_shadowDepthTexture0, u_shadowResolution0);\n    total *= getShadow(worldPosition, vec3(0.0, 1.0, 0.0), u_lightProjectionViewMatrix1, u_shadowDepthTexture1, u_shadowResolution1);\n    return total;\n}\n\n#define SSS_INDEX_COUNT 8\nfloat getSSSAlpha(int sssIndex) {\n    return float(sssIndex + 1) / float(SSS_INDEX_COUNT);\n}\n\nint sssAlphaToIndex(float sssAlpha) {\n    return int(sssAlpha * float(SSS_INDEX_COUNT) - 0.99);\n}\n".replace("<shadow>",function(t,e){for(var n=function(t,e){var n=[],i=.5/(t/2)-1,r=1/(t/2);i*=e,r*=e;for(var o=0;o<t;++o)for(var a=0;a<t;++a)n.push([i+a*r,i+o*r]);return n}(t,e/1024),i=["float shadow = 0.0;"],r=1/n.length,o=0;o<n.length;++o){var a=n[o],s="vec2("+a[0].toFixed(8)+","+a[1].toFixed(8)+")";i.push("shadow += "+r.toFixed(8)+" * texture2DShadow(depthTexture, resolution, lightSpaceCoordinates + "+s+", lightSpacePosition.z);")}return i.push("float ambient = 0.0;"),i.push("return ambient + shadow * (1.0 - ambient);"),i.join("\n")}(3,10));this.backgroundOriginalViewMatrix=p,this.blobProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_uv;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec2 v_uv;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvoid main () {\n    v_uv = a_uv;\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying vec3 v_position;\nvarying vec3 v_normal;\nvarying vec2 v_uv;\n\nuniform vec3 u_color;\nuniform vec3 u_rimColor;\nuniform int u_blobIndex;\n\nuniform sampler2D u_noiseTexture;\n\nvoid main () {\n    vec3 diffuseColor = u_color;\n    float noise = texture2D(u_noiseTexture, v_uv * 2.0).r;\n    diffuseColor *= 1.0 + noise * 0.1;\n\n    float roughness = 0.25;\n    float f0 = 0.05;\n\n    vec3 normal = normalize(v_normal + vec3((noise * 2.0 - 1.0) * 0.03, 0.0, 0.0));\n\n    vec3 color = shadeSurfaceWithLights(v_position, normal, diffuseColor, roughness, f0);\n\n    //color += (1.0 - saturate(dot(v_normal, vec3(0.0, 0.0, 1.0))) * 0.5) * diffuseColor * 1.0;\n    //color += diffuseColor * 0.3;\n\n    float rim = abs(dot(normalize(u_cameraPosition - v_position), normalize(v_normal)));\n    color.rgb += pow(1.0 - rim, 6.0) * u_rimColor;\n\n    gl_FragColor = vec4(color, getSSSAlpha(u_blobIndex));\n    //gl_FragColor = vec4(v_normal * 0.5 + 0.5, 1.0);\n\n    //gl_FragColor = texture2D(u_shadowDepthTexture[1], gl_FragCoord.xy / 1024.0);\n}\n",{a_position:0,a_normal:1,a_uv:2}),this.eyeProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec3 a_restPosition;\n\nvarying vec3 v_normal;\nvarying vec3 v_localPosition;\nvarying vec3 v_restPosition;\nvarying vec3 v_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvoid main () {\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n    v_restPosition = a_restPosition;\n\n    v_localPosition = a_position;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying vec3 v_normal;\nvarying vec3 v_position;\nvarying vec3 v_localPosition;\nvarying vec3 v_restPosition;\n\nuniform int u_blobIndex;\nuniform float u_time;\nuniform vec3 u_lookDirection;\nuniform vec3 u_eyePosition;\nuniform float u_pupilNoiseOffset;\nuniform bool u_hipnotized;\nuniform vec3 u_bodyColor;\nuniform float u_bottomEyelidAngle;\nuniform float u_topEyelidAngle;\n\n//\n// Description : Array and textureless GLSL 2D simplex noise function.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : stegu\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//               https://github.com/stegu/webgl-noise\n// \n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec2 mod289(vec2 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec3 permute(vec3 x) {\n  return mod289(((x*34.0)+1.0)*x);\n}\n\nfloat snoise(vec2 v)\n  {\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\n                      0.024390243902439); // 1.0 / 41.0\n// First corner\n  vec2 i  = floor(v + dot(v, C.yy) );\n  vec2 x0 = v -   i + dot(i, C.xx);\n\n// Other corners\n  vec2 i1;\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\n  //i1.y = 1.0 - i1.x;\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\n  // x1 = x0 - i1 + 1.0 * C.xx ;\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\n  vec4 x12 = x0.xyxy + C.xxzz;\n  x12.xy -= i1;\n\n// Permutations\n  i = mod289(i); // Avoid truncation effects in permutation\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n\t\t+ i.x + vec3(0.0, i1.x, 1.0 ));\n\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n  m = m*m ;\n  m = m*m ;\n\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\n\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\n  vec3 h = abs(x) - 0.5;\n  vec3 ox = floor(x + 0.5);\n  vec3 a0 = x - ox;\n\n// Normalise gradients implicitly by scaling m\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n\n// Compute final noise value at P\n  vec3 g;\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n  return 130.0 * dot(m, g);\n}\n\nvec3 closestPointOnAxis (vec3 base, vec3 direction, vec3 point) {\n    return base + dot(point - base, direction) * direction;\n}\n\nfloat distanceFromAxis (vec3 base, vec3 direction, vec3 point) {\n    return distance(point, closestPointOnAxis(base, direction, point));\n}\n\nfloat spiral(float theta, float r) {\n  float alpha = step(0.1, r);\n  return mix(step(0.5, mod(r * 25.0 + theta / (2.0 * PI) - u_time * 1.1, 1.0)), 1.0, alpha);\n}\n\nvec3 eyeColor (vec3 point) {\n    //closest point on cylinder axis\n    vec3 closestPoint = closestPointOnAxis(u_eyePosition, u_lookDirection, point);\n\n    if (dot(u_lookDirection, v_localPosition - u_eyePosition) < 0.0) return vec3(1.0);\n\n    vec3 offset = point - closestPoint;\n\n    //find plane of cylinder\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.0), u_lookDirection));\n    vec3 up = cross(u_lookDirection, right);\n\n    //project onto cylinder plane\n    float x = dot(offset, right);\n    float y = dot(offset, up);\n\n    float theta = mod(atan(y, x) + PI + u_pupilNoiseOffset, 2.0 * PI);\n\n    if (u_hipnotized) {\n      return vec3(spiral(theta, length(vec2(x, y)))) * 2.0 - 1.0;\n    } else {\n      float PUPIL_FREQUENCY = 8.0;\n\n      float r = 0.045 + snoise(vec2(PUPIL_FREQUENCY * theta / (2.0 * PI), 0.0)) * 0.003;\n\n      return length(vec2(x, y)) < r ? vec3(-1.0) : vec3(1.0);\n    }\n}\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main () {\n    vec3 normal = normalize(v_normal);\n\n    vec3 albedo = eyeColor(v_localPosition);\n\n    float roughness = 0.1;\n    float F0 = 0.5;\n\n    vec3 restOffset = vec3(0.0, -0.03, 0.05);\n\n    float angle = atan(v_restPosition.y - restOffset.y, -v_restPosition.z - restOffset.z);\n    \n    bool isEyelid = angle > -PI + u_bottomEyelidAngle && angle < PI - u_topEyelidAngle;\n\n    float angleRange = 0.2;\n    float bottomEyelidness = linearstep(-PI + u_bottomEyelidAngle, -PI + u_bottomEyelidAngle + angleRange, angle);\n    float topEyelidness = linearstep(PI - u_topEyelidAngle, PI - u_topEyelidAngle - angleRange, angle);\n\n    if (v_restPosition.y > restOffset.y && isEyelid) {\n        normal.y -= (1.0 - topEyelidness) * 1.0;\n    } else if (isEyelid) {\n        normal.y += (1.0 - bottomEyelidness) * 0.4;\n    }\n    normal = normalize(normal);\n\n    if (isEyelid) {\n        albedo = u_bodyColor;\n        roughness = 0.25;\n        F0 = 0.05;\n    }\n\n    vec3 color = shadeSurfaceWithLights(v_position, normal, albedo, roughness, F0);\n\n    float alpha = 0.0;\n\n    if (!isEyelid) {\n        color += step(0.1, albedo.r) * 0.2;\n        color *= 1.5;\n        /*\n        alpha = getSSSAlpha(u_blobIndex) * step(0.1, albedo.r);\n        */\n        alpha = getSSSAlpha(5) * step(0.1, albedo.r);\n    } else {\n        alpha = getSSSAlpha(u_blobIndex);\n        //color += albedo * 0.3;\n    }\n\n    gl_FragColor = vec4(color, alpha);\n}\n",{a_position:0,a_normal:1,a_restPosition:2}),this.mouthInsideProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\n\nvarying vec3 v_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvoid main () {\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec3 v_position;\n\nvoid main () {\n    gl_FragColor = vec4(vec3(0.0), 0.0);\n}\n",{a_position:0}),this.mouthProgram=i(e,Z,m+"\nvarying vec3 v_position;\nvarying vec3 v_normal;\n\nuniform vec3 u_color;\nuniform int u_blobIndex;\n\nvoid main () {\n    vec3 diffuseColor = u_color * 1.5;\n\n    float roughness = 0.1;\n    float f0 = 0.5;\n\n    vec3 color = shadeSurfaceWithLights(v_position, v_normal, diffuseColor, roughness, f0);\n\n    gl_FragColor = vec4(color, getSSSAlpha(u_blobIndex) + 0.05);\n}\n",{a_data:0}),this.tongueProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n\nvarying float v_z;\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\n\n#define SPLINE_POINT_COUNT 20\n\nuniform vec3 u_splinePositions[SPLINE_POINT_COUNT];\nuniform vec3 u_splineTangents[SPLINE_POINT_COUNT];\nuniform vec3 u_splineNormals[SPLINE_POINT_COUNT];\n\nfloat linearstep(float left, float right, float x) {\n    return clamp((x - left) / (right - left), 0.0, 1.0);\n}\n\nvoid main() {\n    v_z = a_position.z;\n    float alongIndex = a_position.z * float(SPLINE_POINT_COUNT - 1);\n\n    vec3 framePosition = vec3(0.0);\n    vec3 frameTangent = vec3(0.0);\n    vec3 frameNormal = vec3(0.0);\n\n    float SPACING = 0.13;\n\n    if (alongIndex >= float(SPLINE_POINT_COUNT - 1)) {\n        framePosition = u_splinePositions[SPLINE_POINT_COUNT - 1] + u_splineTangents[SPLINE_POINT_COUNT - 1] * SPACING * (alongIndex - float(SPLINE_POINT_COUNT - 1));\n        frameTangent = u_splineTangents[SPLINE_POINT_COUNT - 1];\n        frameNormal = u_splineNormals[SPLINE_POINT_COUNT - 1];\n    } else if (alongIndex <= 0.0) {\n        framePosition = u_splinePositions[0];\n        frameTangent = u_splineTangents[0];\n        frameNormal = u_splineNormals[0];\n    } else {\n        int leftIndex = int(alongIndex + 0.001);\n        int rightIndex = leftIndex + 1;\n\n        framePosition = mix(u_splinePositions[leftIndex], u_splinePositions[rightIndex], fract(alongIndex));\n        frameTangent = normalize(mix(u_splineTangents[leftIndex], u_splineTangents[rightIndex], fract(alongIndex)));\n        frameNormal = normalize(mix(u_splineNormals[leftIndex], u_splineNormals[rightIndex], fract(alongIndex)));\n    }\n\n    vec3 frameRight = normalize(cross(frameTangent, frameNormal));\n\n    vec3 localPosition = framePosition + a_position.x * frameRight + a_position.y * frameNormal;\n    vec3 localNormal = normalize(a_normal.x * frameRight + a_normal.y * frameNormal + a_normal.z * frameTangent);\n\n    v_normal = (u_modelMatrix * vec4(localNormal, 0.0)).xyz;\n\n    vec3 worldPosition = (u_modelMatrix * vec4(localPosition, 1.0)).xyz;\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying float v_z;\nvarying vec3 v_worldPosition;\nvarying vec3 v_normal;\n\nvoid main () {\n    vec3 diffuseColor = vec3(1.0, 0.1, 0.1);\n\n    float roughness = 0.1;\n    float f0 = 0.05;\n\n    vec3 color = shadeSurfaceWithLights(v_worldPosition, normalize(v_normal), diffuseColor, roughness, f0);\n\n    color += diffuseColor * 0.1;\n\n    color = mix(vec3(0.0, 0.0, 0.0), color, smoothstep(0.0, 0.2, v_z));\n\n    gl_FragColor = vec4(color, 1.0);\n}\n",{a_position:0,a_normal:1}),this.floorProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_position;\n\nvarying vec2 v_uv;\nvarying vec3 v_position;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform float u_yOffset;\n\nvoid main () {\n    float scale = 100.0;\n    vec3 worldPosition = vec3(0.0, 0.0, -2.0) + vec3(a_position.x * scale, -0.75 + u_yOffset, a_position.y * scale);\n    v_uv = rotate(worldPosition.xz / 10.0, 0.25 * 3.14159265358979323846) * 0.5 + 0.5;\n    v_position = worldPosition;\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying vec3 v_position;\nvarying vec2 v_uv;\n\nuniform sampler2D u_texture;\nuniform float u_scale;\n\nvoid main () {\n    float shadow = pow(mix(0.1, 1.0, getShadowFromLights(v_position)), 1.0 / u_gamma);\n    vec3 color = texture2D(u_texture, v_uv).rgb * u_scale;\n    float alpha = smoothstep(10.0, 4.0, distance(v_position.xz, vec2(0.0, -2.0)));\n    if (v_position.z > 0.0) alpha = 1.0;\n    gl_FragColor = vec4(color * shadow * alpha, alpha);\n}\n",{a_position:0}),this.backgroundProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_position;\nvarying vec2 v_uv;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nuniform mat4 u_referenceProjectionViewMatrix;\n\nvarying vec4 v_clipSpacePosition;\nvarying vec4 v_referenceClipSpacePosition;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, -s, s, c);\n\treturn m * v;\n}\n\n#define PI 3.1415926535\n\nvoid main () {\n    v_uv = a_position * 0.5 + 0.5;\n\n    vec2 planarPosition = rotate(vec2(a_position.x, 0.0), PI * 0.0);\n\n    vec3 worldPosition = vec3(\n        planarPosition.x,\n        a_position.y,\n        planarPosition.y\n    );\n\n    worldPosition *= 1000.0;\n    worldPosition.z -= 30.0;\n\n    v_referenceClipSpacePosition = u_referenceProjectionViewMatrix * vec4(worldPosition, 1.0);\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec2 v_uv;\n\nvarying vec4 v_clipSpacePosition;\nvarying vec4 v_referenceClipSpacePosition;\nuniform sampler2D u_texture;\n\nuniform vec2 u_screenResolution;\nuniform vec2 u_imageResolution;\n\nuniform float u_zoom;\n\nuniform float u_intensity;\nuniform float u_time;\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec2 cover(vec2 uv, vec2 s, vec2 i) {\n    float imageRatio = i.y / i.x;\n    float screenRatio = s.y / s.x;\n\n    vec2 imageDimensions = screenRatio > imageRatio ?\n        vec2(s.y / imageRatio, s.y) :\n        vec2(s.x, s.x * imageRatio);\n\n    vec2 imageOrigin = s * 0.5 - imageDimensions * vec2(1.0, 1.0) * 0.5;\n    vec2 result = (((vec2(uv.x, 1.0 - uv.y) * s)) - imageOrigin) / imageDimensions;\n    result.y = result.y;\n    return result;\n}\n\nvoid main () {\n    vec2 referenceTextureCoordinates = (v_referenceClipSpacePosition.xy / v_referenceClipSpacePosition.w) * 0.5 + 0.5;\n    referenceTextureCoordinates = cover(referenceTextureCoordinates, u_screenResolution, u_imageResolution);\n    //referenceTextureCoordinates = referenceTextureCoordinates * 0.75 + vec2(0.15, 0.05);\n    referenceTextureCoordinates = 0.5 + (referenceTextureCoordinates - 0.5) * u_zoom;\n\n    vec4 color = texture2D(u_texture, referenceTextureCoordinates);\n    color.rgb = vec3(0.5) + (color.rgb - 0.5) * 1.0;\n\n\n    vec3 hsv = rgb2hsv(color.rgb);\n    hsv.g *= mix(1.0, 1.5, u_intensity);\n    //hsv.z *= mix(1.0, 0.5, u_intensity);\n\n    vec3 finalColor = hsv2rgb(hsv);\n\n    vec2 textureCoordinates = (v_clipSpacePosition.xy / v_clipSpacePosition.w) * 0.5 + 0.5;\n    vec3 direction = normalize(vec3(\n    \t(textureCoordinates * 2.0 - 1.0) * mix(0.001, 1.0, u_intensity),\n    \t-1.0));\n\n    float factor = pow(max(-direction.z, 0.0), 4.0);\n    finalColor *= factor;\n\n    gl_FragColor = vec4(finalColor, 1.0);\n\n   // gl_FragColor = vec4(vec3(factor * 0.3), 1.0);\n}\n",{a_position:0}),this.colorProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_position;\n\nvoid main () {\n    gl_Position = vec4(a_position, 0.0, 1.0);\n}\n","\nprecision highp float;\n\nvarying vec2 v_uv;\n\nuniform vec4 u_color;\n\nvoid main () {\n    gl_FragColor = u_color;\n}\n",{a_position:0}),this.blobDepthProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec3 a_normal;\n//attribute vec2 a_uv;\n\nvarying vec3 v_normal;\nvarying vec3 v_position;\n//varying vec2 v_uv;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_modelMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec4 v_clipSpacePosition;\n\nvoid main () {\n    //v_uv = a_uv;\n    vec3 worldPosition = (u_modelMatrix * vec4(a_position, 1.0)).xyz;\n    v_normal = (u_modelMatrix * vec4(-a_normal, 0.0)).xyz;\n\n    v_position = worldPosition;\n    v_clipSpacePosition = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n    gl_Position = v_clipSpacePosition;\n}\n","\nprecision highp float;\n\nvarying vec4 v_clipSpacePosition;\n\nconst float PackUpscale = 256.0 / 255.0;\nconst float UnpackDownscale = 255.0 / 256.0;\n\nconst vec3 PackFactors = vec3( 256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\n\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\n\nvoid main () {\n\tfloat ndcDepth = v_clipSpacePosition.z / v_clipSpacePosition.w;\n\tgl_FragColor = packDepthToRGBA(ndcDepth * 0.5 + 0.5);\n}\n",{a_position:0,a_normal:1}),this.mouthDepthProgram=i(e,"#define SHADOW \n "+Z,Q,{a_data:0}),this.uiProgram=i(e,"\nprecision highp float;\n\nattribute vec3 a_position;\nattribute vec4 a_color;\n\nvarying vec4 v_color;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_modelMatrix;\n\nvoid main () {\n    v_color = a_color;\n    gl_Position = u_projectionMatrix * u_viewMatrix * u_modelMatrix * vec4(a_position, 1.0);\n}\n","\nprecision highp float;\n\nuniform float u_alpha;\n\nvarying vec4 v_color;\n\nvoid main () {\n    gl_FragColor = v_color * vec4(1.0, 1.0, 1.0, u_alpha);\n}\n",{a_position:0,a_color:1}),this.dustProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_offset;\nattribute vec4 a_random;\nattribute vec3 a_spawnPosition;\nattribute vec3 a_spawnVelocity;\nattribute float a_spawnTime;\n\nuniform float u_time;\nuniform float u_scale;\nuniform vec3 u_cameraPosition;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec2 v_offset;\nvarying vec3 v_worldPosition;\nvarying vec4 v_random;\n\nvarying float v_alpha;\n\nvoid main () {\n    v_offset = a_offset;\n    v_random = a_random;\n\n    float elapsedTime = u_time - a_spawnTime;\n    vec3 particlePosition = a_spawnPosition + a_spawnVelocity * elapsedTime;\n\n    v_alpha = 1.0;\n\n    vec3 toCamera = u_cameraPosition - particlePosition;\n    vec3 forwardDirection = toCamera;\n\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.1), forwardDirection));\n    vec3 up = normalize(cross(forwardDirection, right));\n\n    vec2 size = vec2(mix(0.01, 0.015, a_random.w)) * u_scale;\n    vec3 worldPosition = particlePosition + a_offset.x * right * size.x + a_offset.y * up * size.y;\n\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying vec2 v_offset;\nvarying vec4 v_random;\nvarying vec3 v_worldPosition;\nvarying float v_alpha;\n\nvoid main() {\n    vec3 color = vec3(1.0);// * getShadowFromLights(v_worldPosition);\n    float alpha = smoothstep(1.0, mix(0.0, 0.9, v_random.y), length(v_offset)) * mix(0.05, 0.1, v_random.z);\n    alpha *= v_alpha;\n    gl_FragColor = vec4(color * alpha, alpha);\n}\n",{a_offset:0,a_random:1,a_spawnTime:2,a_spawnPosition:3,a_spawnVelocity:4}),this.snowProgram=i(e,"\nprecision highp float;\n\nattribute vec2 a_offset;\nattribute vec4 a_random;\nattribute vec3 a_spawnPosition;\nattribute float a_spawnTime;\n\nuniform float u_time;\nuniform vec3 u_cameraPosition;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_viewMatrix;\n\nvarying vec2 v_offset;\nvarying vec3 v_worldPosition;\nvarying vec4 v_random;\n\nconst float floorY = -4.25;\nconst float GRAVITY = -0.8;\n\nvarying float v_alpha;\n\nvoid main () {\n    v_offset = a_offset;\n    v_random = a_random;\n\n    float elapsedTime = u_time - a_spawnTime;\n    vec3 particlePosition = a_spawnPosition + vec3(0.0, GRAVITY, 0.0) * elapsedTime;\n\n    float hitTime = a_spawnTime + (floorY - a_spawnPosition.y) / GRAVITY;\n    float timeSinceHit = u_time - hitTime;\n\n    bool hit = timeSinceHit > 0.0;\n    v_alpha = smoothstep(2.0, 1.0, timeSinceHit);\n\n    vec3 toCamera = u_cameraPosition - particlePosition;\n    vec3 forwardDirection = hit ? vec3(0.0, 1.0, 0.0) : toCamera;\n\n    vec3 right = normalize(cross(vec3(0.0, 1.0, 0.1), forwardDirection));\n    vec3 up = normalize(cross(forwardDirection, right));\n\n    particlePosition.y = max(particlePosition.y, floorY);\n\n    vec2 size = vec2(mix(0.005, 0.01, a_random.x));\n    if (hit) size *= 3.0;\n    vec3 worldPosition = particlePosition + a_offset.x * right * size.x + a_offset.y * up * size.y;\n\n    v_worldPosition = worldPosition;\n\n    gl_Position = u_projectionMatrix * u_viewMatrix * vec4(worldPosition, 1.0);\n}\n",m+"\nvarying vec2 v_offset;\nvarying vec4 v_random;\nvarying vec3 v_worldPosition;\nvarying float v_alpha;\n\nvoid main() {\n    vec3 color = vec3(1.0);// * getShadowFromLights(v_worldPosition);\n    float alpha = smoothstep(1.0, mix(0.0, 0.9, v_random.y), length(v_offset)) * mix(0.5, 1.0, v_random.z);\n    alpha *= v_alpha;\n    gl_FragColor = vec4(color * alpha, alpha);\n}\n",{a_offset:0,a_random:1,a_spawnTime:2,a_spawnPosition:3}),this.hatProgram=i(e,K,m+"\nvarying vec3 v_worldPosition;\nvarying vec3 v_color;\nvarying vec3 v_normal;\n\nvoid main () {\n    vec3 diffuseColor = v_color;\n\n    float roughness = 0.8;\n    float f0 = 0.05;\n\n    vec3 color = shadeSurfaceWithLights(v_worldPosition, v_normal, diffuseColor, roughness, f0);\n\n    gl_FragColor = vec4(color, 0.0);\n}\n",{a_data:0,a_normal:1}),this.hatDepthProgram=i(e,"#define SHADOW \n"+K,Q,{a_data:0}),this.sssBlurProgram=i(e,$,j(17),{a_position:0}),this.fxaaProgram=i(e,$,"\nprecision highp float;\n\nvarying vec2 v_coordinates;\n\nuniform sampler2D u_input;\n\nuniform vec2 u_resolution;\n\nconst float FXAA_SPAN_MAX = 8.0;\nconst float FXAA_REDUCE_MUL = 1.0 / 8.0;\nconst float FXAA_REDUCE_MIN = 1.0 / 128.0;\n\nvec4 sampleFXAA() {\n    vec2 delta = 1.0 / u_resolution;\n\n    vec3 rgbNW = texture2D(u_input, v_coordinates + vec2(-1.0, -1.0) * delta).rgb;\n    vec3 rgbNE = texture2D(u_input, v_coordinates + vec2(1.0, -1.0) * delta).rgb;\n    vec3 rgbSW = texture2D(u_input, v_coordinates + vec2(-1.0, 1.0) * delta).rgb;\n    vec3 rgbSE = texture2D(u_input, v_coordinates + vec2(1.0, 1.0) * delta).rgb;\n    vec3 rgbM = texture2D(u_input, v_coordinates).rgb;\n\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    vec2 dir = vec2(\n        -((lumaNW + lumaNE) - (lumaSW + lumaSE)),\n        ((lumaNW + lumaSW) - (lumaNE + lumaSE)));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX), dir * rcpDirMin)) * delta.xy;\n\n    vec3 rgbA = 0.5 * (texture2D(u_input, v_coordinates.xy + dir * (1.0 / 3.0 - 0.5)).xyz + texture2D(u_input, v_coordinates.xy + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (texture2D(u_input, v_coordinates.xy + dir * -0.5).xyz + texture2D(u_input, v_coordinates.xy + dir * 0.5).xyz);\n    float lumaB = dot(rgbB, luma);\n\n    if (lumaB < lumaMin || lumaB > lumaMax) {\n        return vec4(rgbA, 1.0);\n    } else {\n        return vec4(rgbB, 1.0);\n    }\n}\n \nvoid main () {\n    vec4 sample = sampleFXAA();\n    gl_FragColor = sample;\n}\n",{a_position:0}),this.colorCorrectProgram=i(e,$,"\nprecision highp float;\n\nuniform sampler2D u_input;\n\nuniform float u_gamma;\nvarying vec2 v_coordinates;\n\nvoid main () {\n    gl_FragColor = pow(texture2D(u_input, v_coordinates), vec4(1.0 / u_gamma));\n}\n",{a_position:0}),this.quadVertexBuffer=u(e,e.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW),this.triangleVertexBuffer=u(e,e.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),e.STATIC_DRAW),this.setViewMatrix(c.makeTranslation([],-h[0],-h[1],-h[2])),this.backgroundTexture=s(e,0,n,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR),this.backgroundTextureResolution=[n.width,n.height],this.floorTexture=s(e,0,r,e.REPEAT,e.REPEAT,e.LINEAR,e.LINEAR),this.noiseTexture=s(e,0,a,e.REPEAT,e.REPEAT,e.LINEAR,e.LINEAR),this.lights.push(new tt(e,.65*-Math.PI,0*Math.PI,20,1.76)),this.lights.push(new tt(e,.2*Math.PI,0*Math.PI,20,.2)),this.framebuffer=e.createFramebuffer(),this.shadowFramebuffer=e.createFramebuffer(),this.colorTexture=o(e,0,e.RGBA,e.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR),this.colorTextureTemp=o(e,0,e.RGBA,e.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,e.CLAMP_TO_EDGE,e.CLAMP_TO_EDGE,e.LINEAR,e.LINEAR),this.renderbuffer=l(e,e.DEPTH_STENCIL,this.canvas.width,this.canvas.height),this.resize(),this.startTime=Date.now()/1e3,this.lastTime=0,this.dust=new X(e,!0,10,this.projectionViewMatrix),this.snow=new O(e,!1,600,this.projectionViewMatrix),this.tongueGeometry=function(t){for(var e=[],n=0;n<20;++n)for(var i=n/19.5,r=i<.5?1:Math.sqrt(1-Math.pow(Object(f.j)(.5,1,i),2)),o=0;o<16;++o){var a=2*Math.PI*o/16;e.push(.15*Math.cos(a)*r,.075*Math.sin(a)*r,i)}for(var s=[],l=0;l<19;++l)for(o=0;o<16;++o){var c=16*l+o,h=16*l+(o+1)%16,d=c+16,p=h+16;s.push(c,h,p),s.push(p,d,c)}for(o=1;o<15;++o)s.push(304),s.push(304+o),s.push(304+o+1);var m=Object(f.c)(e,s,.3);return{positionsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),normalsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(m),t.STATIC_DRAW),indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),t.STATIC_DRAW),indexCount:s.length}}(e),this.hatGeometry=function(t){var e=[],n=0;function i(t,i,r){for(var o=9*t,a=0;a<16;++a)e.push(a),e.push(o),e.push(i),e.push(r);n+=1}for(var r=0;r<10;++r){var o=r/9;i(.2*o,s=1+.2*Math.sqrt(1-Math.pow(2*o-1,2)),0)}for(r=0;r<10;++r){var a=r/9,s=Object(f.l)(1,.1,a);i(Object(f.l)(.2,1,a),s,1)}for(r=0;r<10;++r){var l=r/9;i(1+.2*l,s=.4*Math.sqrt(1-Math.pow(2*l-1,2)),0)}for(var c=[],h=0;h<n-1;++h)for(r=0;r<16;++r){var d=16*h+r,p=16*h+(r+1)%16,m=d+16,g=p+16;c.push(d,p,g),c.push(g,m,d)}var v=[];for(r=0;r<16;++r){var b=2*Math.PI*r/16;v.push([-Math.cos(b),-Math.sin(b),0])}var y=[];for(r=0;r<e.length/4;++r){var x=e[4*r+0],w=e[4*r+1];s=.3*e[4*r+2];y.push(v[x][0]*s,v[x][1]*s,.8*w/9)}var _=Object(f.c)(y,c,2.1);return{dataBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),normalsBuffer:u(t,t.ARRAY_BUFFER,new Float32Array(_),t.STATIC_DRAW),indexBuffer:u(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),t.STATIC_DRAW),indexCount:c.length}}(e),this.setStaticLightingUniforms(this.blobProgram),this.setStaticLightingUniforms(this.eyeProgram),this.setStaticLightingUniforms(this.mouthProgram),this.setStaticLightingUniforms(this.tongueProgram),this.setStaticLightingUniforms(this.floorProgram),this.setStaticLightingUniforms(this.hatProgram),this.floorYOffset=new d.a(-10,(function(t){return 1-Math.pow(1-t,3)})),this.floorYOffset.change(0,1.5),this.backgroundZoom=new d.a(1,(function(t){return Object(f.m)(0,1,t)})),this.backgroundZoom.change(1,1.5),this.dustScale.change(1,1)}return t.prototype.resize=function(){var t=this.canvas.clientWidth,e=this.canvas.clientHeight;this.canvas.width===t&&this.canvas.height===e||(this.canvas.width=t,this.canvas.height=e,this.onResize()),this.recalculateProjectionMatrix()},t.prototype.recalculateProjectionMatrix=function(){var t=Math.PI/8,e=this.canvas.height-2*this.paddingHeight,n=this.canvas.width/e;if(n<1){var i=2*Math.atan(1*Math.tan(t/2));t=2*Math.atan(1/n*Math.tan(i/2)),t=Math.min(t,.9*Math.PI)}c.makePerspective(this.projectionMatrix,t,this.canvas.width/e,.01,100),c.invert(this.inverseProjectionMatrix,this.projectionMatrix),c.makeInfinitePerspective(this.infiniteProjectionMatrix,t,this.canvas.width/e,.01,100),c.makeInfinitePerspective(this.referenceProjectionMatrix,t,16/9,.01,100),c.premultiply(this.projectionViewMatrix,this.viewMatrix,this.projectionMatrix)},t.prototype.onResize=function(){var t=this.gl;a(t,this.colorTexture,0,t.RGBA,t.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),a(t,this.colorTextureTemp,0,t.RGBA,t.UNSIGNED_BYTE,this.canvas.width,this.canvas.height,null,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE,t.LINEAR,t.LINEAR),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.canvas.width,this.canvas.height)},t.prototype.getWorldRayDirection=function(t,e,n){t[0]=e,t[1]=n,t[2]=1,t[3]=1;var i=c.multiplyVector(t,this.inverseProjectionMatrix,t);i[0]/=i[3],i[1]/=i[3],i[2]/=i[3],h.a.normalize(i,i);var r=c.transformDirection(t,i,this.inverseViewMatrix);return h.a.normalize(r,r),r},t.prototype.getScreenPosition=function(t,e){var n=c.multiplyVector(t,this.viewMatrix,[e[0],e[1],e[2],1]),i=c.multiplyVector(t,this.projectionMatrix,n);return i[0]/=i[3],i[1]/=i[3],t},t.prototype.setStaticLightingUniforms=function(t){var e=this.gl;e.useProgram(t.program),e.uniform3f(t.uniformLocations.u_cameraPosition,this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]),e.uniform1f(t.uniformLocations.u_gamma,J);for(var n=0;n<this.lights.length;++n){var i=this.lights[n];e.uniform3fv(t.uniformLocations["u_lightPosition"+n.toFixed(0)],i.position),e.uniform3fv(t.uniformLocations["u_lightColor"+n.toFixed(0)],i.color),e.uniform2f(t.uniformLocations["u_shadowResolution"+n.toFixed(0)],i.shadowMapWidth,i.shadowMapWidth),e.uniformMatrix4fv(t.uniformLocations["u_lightProjectionViewMatrix"+n.toFixed(0)],!1,i.projectionViewMatrix),e.uniform1i(t.uniformLocations["u_shadowDepthTexture"+n.toFixed(0)],1+n)}},t.prototype.unbindLightingTextures=function(){for(var t=this.gl,e=0;e<this.lights.length;++e)t.activeTexture(t.TEXTURE0+1+e),t.bindTexture(t.TEXTURE_2D,null)},t.prototype.bindLightingTextures=function(){for(var t=this.gl,e=0;e<this.lights.length;++e)t.activeTexture(t.TEXTURE0+1+e),t.bindTexture(t.TEXTURE_2D,this.lights[e].depthColorTexture)},t.prototype.setViewMatrix=function(t){c.copy(this.viewMatrix,t),c.invert(this.inverseViewMatrix,this.viewMatrix),this.cameraPosition[0]=this.inverseViewMatrix[12],this.cameraPosition[1]=this.inverseViewMatrix[13],this.cameraPosition[2]=this.inverseViewMatrix[14],c.premultiply(this.projectionViewMatrix,this.viewMatrix,this.projectionMatrix)},t.prototype.render=function(t){this.resize();var e=Date.now()/1e3-this.startTime,n=e-this.lastTime;this.lastTime=e;for(var i=!1,r=0,o=t;r<o.length;r++){(I=o[r]).isDragging&&(i=!0)}var a=this.gl;this.unbindLightingTextures();for(var s=0,l=this.lights;s<l.length;s++){var u=l[s];a.bindFramebuffer(a.FRAMEBUFFER,this.shadowFramebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,u.depthColorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,u.depthRenderbuffer),a.viewport(0,0,u.shadowMapWidth,u.shadowMapWidth),a.clearColor(1,1,1,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(this.blobDepthProgram.program),a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_projectionMatrix,!1,u.projectionMatrix),a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_viewMatrix,!1,u.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enable(a.DEPTH_TEST);for(var h=0,d=t;h<d.length;h++){if((I=d[h]).state!==P.Offscreen){a.uniformMatrix4fv(this.blobDepthProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,I.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,I.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.indexBuffer),a.enable(a.CULL_FACE),a.drawElements(a.TRIANGLES,I.renderingIndexCount,a.UNSIGNED_SHORT,0),a.disable(a.CULL_FACE);for(var p=0,m=I.eyes;p<m.length;p++){var g=m[p];a.bindBuffer(a.ARRAY_BUFFER,g.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g.indexBuffer),a.drawElements(a.TRIANGLES,g.indexCount,a.UNSIGNED_SHORT,0)}}}a.disableVertexAttribArray(1),a.disable(a.CULL_FACE),a.useProgram(this.mouthDepthProgram.program),a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_projectionMatrix,!1,u.projectionMatrix),a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_viewMatrix,!1,u.viewMatrix),a.enableVertexAttribArray(0),a.enable(a.DEPTH_TEST);for(var v=0,b=t;v<b.length;v++){(I=b[v]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.mouthDepthProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.uniform1i(this.mouthDepthProgram.uniformLocations.u_vertexCount,12),a.uniform3fv(this.mouthDepthProgram.uniformLocations["u_positions[0]"],I.getMouthPositions()),a.bindBuffer(a.ARRAY_BUFFER,I.mouthGeometry.vertexBuffer),a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.mouthGeometry.indexBuffer),a.drawElements(a.TRIANGLES,I.mouthGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.useProgram(this.hatDepthProgram.program),a.uniformMatrix4fv(this.hatDepthProgram.uniformLocations.u_projectionMatrix,!1,u.projectionMatrix),a.uniformMatrix4fv(this.hatDepthProgram.uniformLocations.u_viewMatrix,!1,u.viewMatrix),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.hatGeometry.dataBuffer),a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.hatGeometry.indexBuffer),a.enable(a.DEPTH_TEST),a.enable(a.CULL_FACE);for(var y=0,x=t;y<x.length;y++){1!==(I=x[y]).hatOffset.evaluate()&&(I.state!==P.Offscreen&&(a.uniformMatrix4fv(this.hatDepthProgram.uniformLocations.u_modelMatrix,!1,I.getHatModelMatrix()),a.uniform3fv(this.hatDepthProgram.uniformLocations["u_profilePoints[0]"],I.getBrimPositions()),a.uniform3fv(this.hatDepthProgram.uniformLocations["u_splinePositions[0]"],I.hat.getSplinePositions()),a.uniform3fv(this.hatDepthProgram.uniformLocations["u_splineTangents[0]"],I.hat.getSplineTangents()),a.uniform3fv(this.hatDepthProgram.uniformLocations["u_splineNormals[0]"],I.hat.getSplineNormals()),a.drawElements(a.TRIANGLES,this.hatGeometry.indexCount,a.UNSIGNED_SHORT,0)))}a.disable(a.CULL_FACE)}a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.clearColor(0,0,0,0),a.clearStencil(0),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT),a.viewport(0,this.paddingHeight,this.canvas.width,this.canvas.height-2*this.paddingHeight),this.bindLightingTextures(),a.useProgram(this.blobProgram.program),a.uniform3fv(this.blobProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1i(this.blobProgram.uniformLocations.u_texture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.noiseTexture),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enable(a.DEPTH_TEST);for(var w=0;w<t.length;++w){if((I=t[w]).state!==P.Offscreen){a.uniform1i(this.blobProgram.uniformLocations.u_blobIndex,w),a.uniform3fv(this.blobProgram.uniformLocations.u_color,I.bodyColor);var _=I.isDragging?.2:0;a.uniform3f(this.blobProgram.uniformLocations.u_rimColor,_,_,_),a.uniformMatrix4fv(this.blobProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,I.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,I.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,I.uvsBuffer),a.vertexAttribPointer(2,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.indexBuffer),a.drawElements(a.TRIANGLES,I.renderingIndexCount,a.UNSIGNED_SHORT,0)}}a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.useProgram(this.eyeProgram.program),a.uniform3fv(this.eyeProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.eyeProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enable(a.DEPTH_TEST);for(w=0;w<t.length;++w){if((I=t[w]).state!==P.Offscreen){a.uniform1i(this.eyeProgram.uniformLocations.u_blobIndex,w),a.uniformMatrix4fv(this.eyeProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.uniform3fv(this.eyeProgram.uniformLocations.u_bodyColor,I.bodyColor),a.uniform1i(this.eyeProgram.uniformLocations.u_hipnotized,!I.isDragging&&I.isSinging&&i?1:0),a.uniform1f(this.eyeProgram.uniformLocations.u_bottomEyelidAngle,I.getBottomEyelidAngle()),a.uniform1f(this.eyeProgram.uniformLocations.u_topEyelidAngle,I.getTopEyelidAngle());for(var A=I.eyes.length-1;A>=0;--A){g=I.eyes[A];a.uniform3fv(this.eyeProgram.uniformLocations.u_eyePosition,g.centerPosition),a.uniform3fv(this.eyeProgram.uniformLocations.u_lookDirection,g.lookDirection),a.bindBuffer(a.ARRAY_BUFFER,g.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,g.restPositionsBuffer),a.vertexAttribPointer(2,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,g.indexBuffer),a.drawElements(a.TRIANGLES,g.indexCount,a.UNSIGNED_SHORT,0)}}}a.depthMask(!0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.useProgram(this.mouthProgram.program),a.uniform3fv(this.mouthProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enable(a.DEPTH_TEST);for(w=0;w<t.length;++w){(I=t[w]).state!==P.Offscreen&&(a.uniform1i(this.mouthProgram.uniformLocations.u_blobIndex,w),a.uniform3fv(this.mouthProgram.uniformLocations.u_color,I.mouthColor),a.uniformMatrix4fv(this.mouthProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.uniform1i(this.mouthProgram.uniformLocations.u_vertexCount,12),a.uniform3fv(this.mouthProgram.uniformLocations["u_positions[0]"],I.getMouthPositions()),a.bindBuffer(a.ARRAY_BUFFER,I.mouthGeometry.vertexBuffer),a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.mouthGeometry.indexBuffer),a.drawElements(a.TRIANGLES,I.mouthGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.enable(a.STENCIL_TEST),a.stencilOp(a.KEEP,a.KEEP,a.REPLACE),a.useProgram(this.mouthInsideProgram.program),a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enable(a.DEPTH_TEST),a.depthMask(!1);for(w=0;w<t.length;++w){(I=t[w]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.mouthInsideProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.bindBuffer(a.ARRAY_BUFFER,I.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,I.mouthTriangleIndexBuffer),a.stencilFunc(a.ALWAYS,1<<t.length-1-w,1<<t.length-1-w),a.drawElements(a.TRIANGLES,I.mouthTriangleIndexCount,a.UNSIGNED_SHORT,0))}a.depthMask(!0),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.useProgram(this.tongueProgram.program),a.uniform3fv(this.tongueProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.bindBuffer(a.ARRAY_BUFFER,this.tongueGeometry.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.tongueGeometry.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.tongueGeometry.indexBuffer),a.enable(a.DEPTH_TEST);for(w=0;w<t.length;++w){(I=t[w]).state!==P.Offscreen&&(a.uniformMatrix4fv(this.tongueProgram.uniformLocations.u_modelMatrix,!1,I.modelMatrix),a.uniform3fv(this.tongueProgram.uniformLocations["u_splinePositions[0]"],I.getTonguePositions()),a.uniform3fv(this.tongueProgram.uniformLocations["u_splineTangents[0]"],I.getTongueTangents()),a.uniform3fv(this.tongueProgram.uniformLocations["u_splineNormals[0]"],I.getTongueNormals()),a.stencilFunc(a.EQUAL,1<<t.length-1-w,4294967295),a.drawElements(a.TRIANGLES,this.tongueGeometry.indexCount,a.UNSIGNED_SHORT,0))}a.disableVertexAttribArray(1),a.disable(a.STENCIL_TEST),a.useProgram(this.hatProgram.program),a.uniform3fv(this.hatProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.hatProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.hatProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.bindBuffer(a.ARRAY_BUFFER,this.hatGeometry.dataBuffer),a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.hatGeometry.normalsBuffer),a.vertexAttribPointer(1,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.hatGeometry.indexBuffer),a.enable(a.DEPTH_TEST);for(var S=0,R=t;S<R.length;S++){1!==(I=R[S]).hatOffset.evaluate()&&(I.state!==P.Offscreen&&(a.uniformMatrix4fv(this.hatProgram.uniformLocations.u_modelMatrix,!1,I.getHatModelMatrix()),a.uniform3fv(this.hatProgram.uniformLocations["u_profilePoints[0]"],I.getBrimPositions()),a.uniform3fv(this.hatProgram.uniformLocations["u_splinePositions[0]"],I.hat.getSplinePositions()),a.uniform3fv(this.hatProgram.uniformLocations["u_splineTangents[0]"],I.hat.getSplineTangents()),a.uniform3fv(this.hatProgram.uniformLocations["u_splineNormals[0]"],I.hat.getSplineNormals()),a.drawElements(a.TRIANGLES,this.hatGeometry.indexCount,a.UNSIGNED_SHORT,0)))}a.disableVertexAttribArray(1),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null),a.clear(a.COLOR_BUFFER_BIT),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.useProgram(this.sssBlurProgram.program),a.uniform1i(this.sssBlurProgram.uniformLocations.u_colorTexture,0),a.uniform2f(this.sssBlurProgram.uniformLocations.u_resolution,this.canvas.width,this.canvas.height),a.uniformMatrix4fv(this.sssBlurProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.uniform2f(this.sssBlurProgram.uniformLocations.u_direction,1,0),a.drawArrays(a.TRIANGLES,0,3),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTextureTemp),a.uniform2f(this.sssBlurProgram.uniformLocations.u_direction,0,1),a.drawArrays(a.TRIANGLES,0,3),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTextureTemp,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null),a.disable(a.DEPTH_TEST),a.clear(a.COLOR_BUFFER_BIT),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.useProgram(this.colorCorrectProgram.program),a.uniform1i(this.colorCorrectProgram.uniformLocations.u_input,0),a.uniform1f(this.colorCorrectProgram.uniformLocations.u_gamma,J),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.drawArrays(a.TRIANGLES,0,3);var T=this.colorTexture;this.colorTexture=this.colorTextureTemp,this.colorTextureTemp=T,a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.viewport(0,this.paddingHeight,this.canvas.width,this.canvas.height-2*this.paddingHeight),a.enable(a.DEPTH_TEST),a.depthMask(!1);var E=c.premultiply(new Float32Array(16),this.backgroundOriginalViewMatrix,this.projectionMatrix);i?this.backgroundIntensity.change(1,2.5):this.backgroundIntensity.change(0,1),a.useProgram(this.backgroundProgram.program),a.uniformMatrix4fv(this.backgroundProgram.uniformLocations.u_projectionMatrix,!1,this.infiniteProjectionMatrix),a.uniformMatrix4fv(this.backgroundProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniformMatrix4fv(this.backgroundProgram.uniformLocations.u_referenceProjectionViewMatrix,!1,E),a.uniform1f(this.backgroundProgram.uniformLocations.u_time,e),a.uniform1f(this.backgroundProgram.uniformLocations.u_intensity,this.backgroundIntensity.evaluate()),a.uniform1f(this.backgroundProgram.uniformLocations.u_zoom,this.backgroundZoom.evaluate()),a.uniform2f(this.backgroundProgram.uniformLocations.u_screenResolution,this.canvas.width,this.canvas.height),a.uniform2f(this.backgroundProgram.uniformLocations.u_imageResolution,this.backgroundTextureResolution[0],this.backgroundTextureResolution[1]),a.uniform1i(this.backgroundProgram.uniformLocations.u_texture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.quadVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.useProgram(this.floorProgram.program),a.uniform3fv(this.floorProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.floorProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.floorProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.floorProgram.uniformLocations.u_scale,Object(f.l)(1,.5,this.backgroundIntensity.evaluate())),a.uniform1f(this.floorProgram.uniformLocations.u_gamma,J),a.uniform1f(this.floorProgram.uniformLocations.u_yOffset,this.floorYOffset.evaluate()),a.uniform1i(this.floorProgram.uniformLocations.u_texture,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.floorTexture),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.quadVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),a.disable(a.BLEND),a.enable(a.DEPTH_TEST),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.colorTexture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderbuffer),a.depthMask(!1),this.snowSpawnRate>0?this.dustScale.change(0,5):this.dustScale.change(1,2);var M=c.premultiply(new Float32Array(16),this.viewMatrix,this.projectionMatrix);this.dust.update(e,n,10,M),a.useProgram(this.dustProgram.program),a.uniform3fv(this.dustProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.dustProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.dustProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.dustProgram.uniformLocations.u_scale,this.dustScale.evaluate()),a.uniform1f(this.dustProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enableVertexAttribArray(3),a.enableVertexAttribArray(4),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.dust.offsetBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.randomBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnTimeBuffer),a.vertexAttribPointer(2,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnPositionBuffer),a.vertexAttribPointer(3,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.dust.spawnVelocityBuffer),a.vertexAttribPointer(4,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.dust.indexBuffer),a.drawElements(a.TRIANGLES,6*this.dust.particleCount,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.disableVertexAttribArray(4),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.depthMask(!1),this.snow.update(e,n,this.snowSpawnRate,M),a.useProgram(this.snowProgram.program),a.uniform3fv(this.snowProgram.uniformLocations.u_cameraPosition,this.cameraPosition),a.uniformMatrix4fv(this.snowProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.snowProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.uniform1f(this.snowProgram.uniformLocations.u_time,e),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.enableVertexAttribArray(2),a.enableVertexAttribArray(3),a.enable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindBuffer(a.ARRAY_BUFFER,this.snow.offsetBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.randomBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.spawnTimeBuffer),a.vertexAttribPointer(2,1,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,this.snow.spawnPositionBuffer),a.vertexAttribPointer(3,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.snow.indexBuffer),a.drawElements(a.TRIANGLES,6*this.snow.particleCount,a.UNSIGNED_SHORT,0),a.disableVertexAttribArray(1),a.disableVertexAttribArray(2),a.disableVertexAttribArray(3),a.disable(a.DEPTH_TEST),a.depthMask(!0),a.disable(a.BLEND),a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.canvas.width,this.canvas.height),a.useProgram(this.fxaaProgram.program),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.uniform1i(this.fxaaProgram.uniformLocations.u_input,0),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,this.colorTexture),a.uniform2f(this.fxaaProgram.uniformLocations.u_resolution,this.canvas.width,this.canvas.height),a.drawArrays(a.TRIANGLES,0,3),a.useProgram(this.uiProgram.program),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_projectionMatrix,!1,this.projectionMatrix),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_viewMatrix,!1,this.viewMatrix),a.enableVertexAttribArray(0),a.enableVertexAttribArray(1),a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);for(var k=0,F=t;k<F.length;k++){var I;if((I=F[k]).state!==P.Offscreen)for(var B=0,C=[I.pitchUI,I.vowelUI];B<C.length;B++){var D=C[B];0!==D.alpha.evaluate()&&(a.uniform1f(this.uiProgram.uniformLocations.u_alpha,D.alpha.evaluate()*D.overrideAlpha.evaluate()),a.uniformMatrix4fv(this.uiProgram.uniformLocations.u_modelMatrix,!1,D.getModelMatrix()),a.bindBuffer(a.ARRAY_BUFFER,D.lines.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,D.lines.colorsBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.drawArrays(a.LINES,0,D.lines.vertexCount),a.bindBuffer(a.ARRAY_BUFFER,D.triangles.positionsBuffer),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,D.triangles.colorsBuffer),a.vertexAttribPointer(1,4,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,D.triangles.indexBuffer),a.drawArrays(a.TRIANGLES,0,D.triangles.vertexCount))}}a.disableVertexAttribArray(1),a.disable(a.BLEND);var L=Object(f.m)(this.startTime,this.startTime+1,Date.now()/1e3);L<1&&(a.disable(a.DEPTH_TEST),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.useProgram(this.colorProgram.program),a.uniform4f(this.colorProgram.uniformLocations.u_color,0,0,0,1-L),a.enableVertexAttribArray(0),a.bindBuffer(a.ARRAY_BUFFER,this.triangleVertexBuffer),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.disable(a.BLEND))},t}(),nt=n(10),it=n(7),rt=n(33);var ot=function(){function t(t){this.chunks=[],this.currentChunkIndex=0;var e=rt.RecordedLibrettos.decode(t);!function(t){var e,n,i;for(i=t.length-1;i>0;i--)e=Math.floor(Math.random()*(i+1)),n=t[i],t[i]=t[e],t[e]=n}(e.librettos);for(var n=[],i=0,r=e.librettos;i<r.length;i++)for(var o=0,a=r[i].notes;o<a.length;o++){var s=a[o];if(s.name!==rt.RecordedLibrettos.Phoneme.sil){var l=s.endTimeSeconds-s.startTimeSeconds;n.push({name:s.name,duration:l})}}for(var u=0;u<n.length-1;++u)Object(f.i)(n[u].name)&&!Object(f.i)(n[u+1].name)&&(n[u].duration=.2),Object(f.i)(n[u].name)&&Object(f.i)(n[u+1].name)&&(n[u].duration=.05);for(var c=0;!Object(f.i)(n[c].name)||Object(f.i)(n[c+1].name);)c++;var h=n[c],d=[];do{c+=1,Object(f.i)(n[c].name)&&!Object(f.i)(n[c+1].name)?(this.chunks.push({vowel:h,suffix:d}),h=n[c],d=[]):Object(f.i)(n[c].name)||d.push(n[c])}while(c<n.length-2)}return t.prototype.getNextChunk=function(t){this.currentChunkIndex+=1;var e=this.chunks[this.currentChunkIndex];return e.vowel.name=t,e},t}(),at=function(){function t(t,e,n){this.frames=[],this.secondsInCurrentFrame=0,this.onFrameUsed=null,this.clock=t,this.timestepSeconds=e,this.delaySeconds=n}return t.prototype.update=function(){if(this.frames.length>=2)for(this.secondsInCurrentFrame+=this.clock.getDeltaTimeS();this.secondsInCurrentFrame>=this.timestepSeconds&&this.frames.length>=2;)this.onFrameUsed&&this.onFrameUsed(this.frames[0].buffer),this.frames.splice(0,1),this.secondsInCurrentFrame-=this.timestepSeconds;else this.secondsInCurrentFrame=this.timestepSeconds-this.delaySeconds},t.prototype.addFrame=function(t){this.frames.push(t)},t.prototype.getCurrentFrame=function(){return this.frames.length>0?this.frames[0]:null},t}(),st=function(){function t(t){this.fromValue=[],this.targetValue=[];for(var e=0;e<t.length;++e)this.fromValue[e]=t[e],this.targetValue[e]=t[e];this.tweenDuration=1,this.tweenStartTime=-99999}return t.prototype.change=function(t,e){if(!Object(f.a)(this.targetValue,t)){this.evaluate(this.fromValue);for(var n=0;n<this.targetValue.length;++n)this.targetValue[n]=t[n];this.tweenDuration=1e3*e,this.tweenStartTime=Date.now()}},t.prototype.evaluate=function(t){if(0===this.tweenDuration)return this.targetValue;for(var e=Object(f.m)(this.tweenStartTime,this.tweenStartTime+this.tweenDuration,Date.now()),n=0;n<this.fromValue.length;++n)t[n]=Object(f.l)(this.fromValue[n],this.targetValue[n],e);return t},t}();var lt=function(){function t(){this.timeMs=0,this.deltaTimeMs=0}return t.prototype.tick=function(t){this.deltaTimeMs=t,this.timeMs+=t},t.prototype.getTimeMs=function(){return this.timeMs},t.prototype.getTimeS=function(){return this.timeMs/1e3},t.prototype.getDeltaTimeMs=function(){return this.deltaTimeMs},t.prototype.getDeltaTimeS=function(){return this.deltaTimeMs/1e3},t}(),ut=[[67,69,71,72,74,76,77,79,81,83,84],[60,62,64,65,67,69,71,72,74,76],[48,50,52,53,55,57,59,60,62,64,65,67],[43,45,47,48,50,52,53,55,57,59,60]],ct=Math.floor(20),ht=-3;function ft(t,e,n){var i=n.getBoundingClientRect();t.x=e.clientX-i.left,t.y=e.clientY-i.top}function dt(t,e){return Math.ceil(t.duration/e)}var pt=function(){function t(){this.buffersBySize={},this.buffersCreated=0}return t.prototype.getBuffersOfSize=function(t){var e=t.toFixed(0);return e in this.buffersBySize||(this.buffersBySize[e]=[]),this.buffersBySize[e]},t.prototype.allocateBuffers=function(t,e){for(var n=this.getBuffersOfSize(t),i=0;i<e;++i)this.buffersCreated+=1,n.push(new ArrayBuffer(t))},t.prototype.getBuffer=function(t){var e=this.getBuffersOfSize(t),n=null;return e.length>0?n=e.pop():(this.buffersCreated+=1,n=new ArrayBuffer(t)),n},t.prototype.returnBuffer=function(t){this.getBuffersOfSize(t.byteLength).push(t)},t.prototype.returnBuffers=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];this.returnBuffer(i)}},t}(),mt=function(){function t(t){this.sampleCount=t,this.samples=[]}return t.prototype.add=function(t){this.samples.length===this.sampleCount&&this.samples.splice(0,1),this.samples.push(t)},t.prototype.get=function(){if(0===this.samples.length)return 0;for(var t=0,e=0;e<this.samples.length;++e)t+=this.samples[e];return t/this.samples.length},t.prototype.enoughSamples=function(){return this.samples.length===this.sampleCount},t.prototype.reset=function(){this.samples.length=0},t}(),gt=function(){function t(t,e,n,i,r,o){this.previousChunk={vowel:{name:x.b.a,duration:.2},suffix:[{name:x.b.m,duration:.05}]},this.currentChunk={vowel:{name:x.b.a,duration:.2},suffix:[{name:x.b.m,duration:.05}]},this.frameInCurrentPhoneme=0,this.streamIndex=t,this.audioParameters=n,this.currentMidiNote=r,this.currentMuted=!0,this.voiceNet=e,this.bufferPool=i,this.epoch=o,this.frameInCurrentPhoneme=dt(this.currentChunk.vowel,this.audioParameters.frameHopSeconds)}return t.prototype.singNote=function(t,e,n,i,r,o){var a=this;void 0===o&&(o=.2);var s=this.audioParameters.frameHopSeconds*r,l=0,u=Math.round(o/s),c=dt(this.currentChunk.vowel,s)-this.frameInCurrentPhoneme-Math.ceil(u/2),h=function(o,h,d,p,m,g){for(var v=dt(m,s),b=o;b<h;++b){var y=Object(f.l)(a.currentMidiNote,e,Object(f.j)(c,c+u,l)),x=new nt.a(a.bufferPool.getBuffer(nt.a.getSizeBytes()));x.setPhoneme(m.name),x.setPreviousPhoneme(p.name),x.setNextPhoneme(g.name),x.setPhonemePosition(b/(v-1)),x.setF0(Object(f.k)(y)),x.setSingerIndex(a.streamIndex),x.setMidiNote(e),x.setMuted(d?a.currentMuted:n),x.setVowel(d?a.currentChunk.vowel.name:t.vowel.name),x.setControlled(i),x.setSubsteps(r),x.setSendTime(Date.now()-a.epoch+l*s*1e3);for(var w=r,_=[],P=0;P<w;++P){var A=Object(f.l)(a.currentMidiNote,e,Object(f.j)(c*w,(c+u)*w,l*w+P)),S=new it.a(a.bufferPool.getBuffer(it.a.getSizeBytes()));S.setPhoneme(m.name),S.setPreviousPhoneme(p.name),S.setNextPhoneme(g.name);var R=(b*w+P)/(v*w-1);S.setPhonemePosition(R),S.setF0(Object(f.k)(A)),S.setSingerIndex(a.streamIndex),S.setMidiNote(e),S.setMuted(d?a.currentMuted:n),S.setVowel(d?a.currentChunk.vowel.name:t.vowel.name),S.setControlled(i),_.push(S)}a.voiceNet.generate(a.streamIndex,x,_),l+=1}};h(this.frameInCurrentPhoneme,dt(this.currentChunk.vowel,s),!0,this.previousChunk.suffix[this.previousChunk.suffix.length-1],this.currentChunk.vowel,this.currentChunk.suffix[0]);for(var d=0;d<this.currentChunk.suffix.length;++d){var p=this.currentChunk.suffix[d];h(0,dt(p,s),!1,0===d?this.currentChunk.vowel:this.currentChunk.suffix[d-1],p,d===this.currentChunk.suffix.length-1?t.vowel:this.currentChunk.suffix[d+1])}var m=dt(t.vowel,s),g=Math.floor(m*(t.vowel.name===x.b.sil?.9:.3));h(0,g,!1,this.currentChunk.suffix[this.currentChunk.suffix.length-1],t.vowel,t.suffix[0]),this.frameInCurrentPhoneme=g,this.previousChunk=this.currentChunk,this.currentChunk=t,this.currentMidiNote=e,this.currentMuted=n},t}(),vt=[[60,88],[60,83],[45,72],[36,66]];function bt(t,e){for(var n=0;n<4;++n)if(!(e<vt[n][0]||e>vt[n][1])&&e>t[n])return n;return e>=vt[3][0]&&e<=vt[3][1]?3:-1}var yt=[x.b.n,x.b.r,x.b.l,x.b.t,x.b.s,x.b.d,x.b.m,x.b.p,x.b.v,x.b.c,x.b.ch,x.b.f,x.b.j,x.b.b,x.b.qu,x.b.h,x.b.g];function xt(){return yt[Math.floor(Math.random()*yt.length)]}var wt=[x.b.u,x.b.o,x.b.i,x.b.e,x.b.a];function _t(t){var e=Math.floor(t/20);return wt[Object(f.b)(e,0,wt.length-1)]}var Pt,At,St=function(){function t(t,e){var n=this;this.lastActiveNotes=[],this.activeNotes=[],this.singingNotes=[{pitch:0,vowel:x.b.a},{pitch:0,vowel:x.b.a},{pitch:0,vowel:x.b.a},{pitch:0,vowel:x.b.a}],this.singers=t,this.opera=e;try{navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then((function(t){t.inputs.forEach((function(t){t.onmidimessage=n.onMidiMessage.bind(n)}))})).catch((function(t){}))}catch(t){}}return t.prototype.onMidiMessage=function(t){var e=this;if(!(t.data[0]>=240)){var n=t.data[0]>>4,i=0,r=0;if(9===n)i=t.data[1],r=t.data[2];else{if(8!==n)return;i=t.data[1],r=0}r>0?this.activeNotes.push({pitch:i,vowel:_t(r)}):0===r&&(this.activeNotes=this.activeNotes.filter((function(t){return t.pitch!==i}))),this.activeNotes=this.activeNotes.sort((function(t,e){return e.pitch-t.pitch})),window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){for(var t=[],n=[],i=function(n){e.activeNotes.find((function(t){return t.pitch===e.lastActiveNotes[n].pitch}))||t.push(e.lastActiveNotes[n])},r=0;r<e.lastActiveNotes.length;++r)i(r);var o=function(t){e.lastActiveNotes.find((function(n){return n.pitch===e.activeNotes[t].pitch}))||n.push(e.activeNotes[t])};for(r=0;r<e.activeNotes.length;++r)o(r);for(var a=e.singingNotes.map((function(t){return{pitch:t.pitch,vowel:t.vowel}})),s=0,l=t;s<l.length;s++){var u=l[s];for(r=0;r<4;++r)if(a[r].pitch===u.pitch){a[r].pitch=0;break}}for(var c=0,h=n;c<h.length;c++){u=h[c];var f=bt(a.map((function(t){return t.pitch})),u.pitch);f>-1&&(a[f]=u)}var d=e.opera.clock.getTimeMs();for(r=0;r<4;++r)if(a[r].pitch!==e.singingNotes[r].pitch)if(0===a[r].pitch){var p={vowel:{name:x.b.sil,duration:.1},suffix:[{name:xt(),duration:.05}]};e.singers[r].singNote(p,e.singingNotes[r].pitch,!0,!1,1,.1),e.opera.addNoteToRecording(r,d,e.singingNotes[r].pitch,p,!1)}else{p={vowel:{name:a[r].vowel,duration:.1},suffix:[{name:xt(),duration:.05}]};e.singers[r].singNote(p,a[r].pitch,!1,!1,1,.1),e.opera.addNoteToRecording(r,d,a[r].pitch,p,!1)}e.singingNotes=a,e.lastActiveNotes=e.activeNotes.slice(0)}),50)}},t}();function Rt(t){for(var e=[0,0,0],n=0,i=t;n<i.length;n++){var r=i[n];h.a.add(e,e,r)}return h.a.multiplyByScalar(e,e,1/t.length),e}!function(t){t[t.Main=0]="Main",t[t.Playing=1]="Playing"}(Pt||(Pt={})),function(t){t[t.Normal=0]="Normal",t[t.Festive=1]="Festive"}(At||(At={}));var Tt,Et=["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],Mt=Object(f.e)(-30),kt=[0,0,3],Ft=Mt+Math.PI/2,It=[Math.cos(Ft),0,Math.sin(Ft)],Bt=[0,.7,0],Ct=[[1,1,1,1],[1,1,2,3],[2,2,3,4],[2,3,6,5]],Dt=function(){function t(t,e,n,i,r,o,a,s,l,u,p,m,g,v,b,y){var x=this;this.frameTrackers=[],this.silenced=[!1,!1,!1,!1],this.stateChangeListeners=[],this.singers=[],this.blobs=[],this.state=Pt.Main,this.isRecording=!1,this.currentRecording=null,this.recordingStartTime=0,this.playing=!1,this.playingRecording=null,this.playbackStartTime=0,this.playbackIndex=[0,0,0,0],this.mouseX=.5,this.mouseY=.5,this.firstNoteTime=0,this.cameraPositionCache=[0,0,0],this.rendererPadding=new d.a(0,(function(t){return Object(f.m)(0,1,t)})),this.prompts=[],this.silenceButtons=[],this.lastSentF0s=[440,440,440,440],this.harmonizationTimeouts=["Empty","Empty","Empty","Empty"],this.lastSungNote={midiPitch:0,vowel:null},this.lastSungNotes=[{midiPitch:0,vowel:null},{midiPitch:0,vowel:null},{midiPitch:0,vowel:null},{midiPitch:0,vowel:null}],this.blobController=null,this.lastControlledIndex=-1,this.tutorialState={kind:"Pitch",pitchesChanged:0,notesSung:0},this.personIndicators=[],this.suspended=!0,this.requestedFrame=-1,this.showingPrompts=!0,this.viewMatrix=new Float32Array(16),this.onTutorialFinished=null,this.onBlobInteraction=null,this.pitchPrompt={element:document.getElementById("pitch-prompt"),text:"",visible:!1,sounding:!1},this.vowelPrompt={element:document.getElementById("vowel-prompt"),text:"",visible:!1,sounding:!1},this.epoch=Date.now(),this.averageGenerationTime=new mt(200),this.worldRayDirection=[0,0,0,0],this.pos={x:0,y:0},this.lookPosition=[0,0,0],this.silenceWorldPositions=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]],this.tempScreenPosition=[0,0,0,0],this.substepLevel=y,this.substeps=Ct[this.substepLevel],this.clock=new lt,this.frameHopSeconds=v,this.theme=At.Normal,"Recording"===g.kind&&g.recording.theme===At.Festive&&(this.theme=At.Festive),this.snowSpawnRate=new d.a(this.theme===At.Festive?600:0),this.canvas=t,this.harmonizer=o,this.voiceNet=a,this.voiceNet.setParameters(s.synthRunner.audioParameters),this.audio=s,this.audio.synthRunner.onFrameUsed=function(t){x.bufferPool.returnBuffer(t)},this.libretto=new ot(m),this.bufferPool=new pt,this.bufferPool.allocateBuffers(it.a.getSizeBytes(),1e3),this.bufferPool.allocateBuffers(nt.a.getSizeBytes(),1e3);for(var w=0;w<4;++w){var _=new at(this.clock,s.synthRunner.audioParameters.frameHopSeconds,s.synthRunner.audioParameters.scriptProcessorBufferSize/s.sampleRate);_.onFrameUsed=function(t){x.bufferPool.returnBuffer(t)},this.frameTrackers.push(_)}var P=[];for(w=0;w<4;++w){var A=[(R=w-1.5)*Math.cos(Mt)*1.8,0,R*Math.sin(Mt)*1.8];P.push(A)}this.cameraPositions=[];for(w=0;w<4;++w){var S=Rt(P.slice(w)),R=Object(f.j)(0,3,w),T=Object(f.l)(19.5,14,R),E=Object(f.l)(3.5,2.5,R);this.cameraPositions.push(h.a.add([],S,[0,E,T]))}var M=c.makeTranslation(new Float32Array(16),-this.cameraPositions[0][0],-this.cameraPositions[0][1],-this.cameraPositions[0][2]);this.renderer=new et(this.canvas,e,l,u,p,this.cameraPositions[0],M);for(w=0;w<4;++w)this.blobs.push(new C(this.renderer.gl,n,i,r,ut[w],P[w],w/4,b.blobSubdivisions));if(this.theme===At.Festive)for(var k=0,F=this.blobs;k<F.length;k++){F[k].hatOffset.change(0,0)}t.addEventListener("mousedown",this.onMouseDown.bind(this)),t.addEventListener("mousemove",this.onMouseMove.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),t.addEventListener("touchstart",this.onTouchStart.bind(this)),t.addEventListener("touchmove",this.onTouchMove.bind(this)),t.addEventListener("touchend",this.onTouchEnd.bind(this)),t.addEventListener("touchcancel",this.onTouchCancel.bind(this));var I=function(t){a.addListener(t,(function(e,n){var i=Date.now()-x.epoch-e.getSendTime();i/=e.getSubsteps(),x.averageGenerationTime.add(i),x.averageGenerationTime.enoughSamples()&&(x.averageGenerationTime.get()>30?(x.substepLevel+=1,x.substepLevel=Math.min(x.substepLevel,3),x.substeps=Ct[x.substepLevel],x.averageGenerationTime.reset()):x.averageGenerationTime.get()<0&&(x.substepLevel-=1,x.substepLevel=Math.max(x.substepLevel,0),x.substeps=Ct[x.substepLevel],x.averageGenerationTime.reset())),x.onGeneratedFrame(t,e,n)}))};for(w=0;w<4;++w)I(w);var B=[72,64,55,48];for(w=0;w<4;++w)this.singers.push(new gt(w,a,this.audio.synthRunner.audioParameters,this.bufferPool,B[w],this.epoch));this.audio.start(),this.prompts=[document.getElementById("soprano-prompt"),document.getElementById("alto-prompt"),document.getElementById("tenor-prompt"),document.getElementById("bass-prompt")],this.silenceButtons=[document.getElementById("soprano-silence"),document.getElementById("alto-silence"),document.getElementById("tenor-silence"),document.getElementById("bass-silence")].map((function(t){return{element:t,visible:!1,silenced:!1,hideTime:0}}));var D=function(t){var e=function(e){e.preventDefault(),x.silenced[t]?x.silenced[t]=!1:(x.sendSilence(t),x.silenced[t]=!0)};L.silenceButtons[t].element.addEventListener("click",e),L.silenceButtons[t].element.addEventListener("touchstart",e)},L=this;for(w=0;w<this.silenceButtons.length;++w)D(w);if("Default"===g.kind)this.rendererPadding=new d.a(0,(function(t){return Object(f.m)(0,1,t)})),this.cameraPosition=new st(this.cameraPositions[0]),this.blobs[3].startFalling(0),this.state=Pt.Main;else if("Recording"===g.kind){this.state=Pt.Playing,this.cameraPosition=new st(this.cameraPositions[0]),this.rendererPadding=new d.a(0,(function(t){return Object(f.m)(0,1,t)})),this.playingRecording=g.recording,this.currentRecording=null,this.playing=!1;for(w=0;w<this.blobs.length;++w)this.blobs[w].startFalling(10*w);this.startPlayback(2)}this.midiController=new St(this.singers,this),this.resume()}return t.prototype.onMouseDown=function(t){ft(this.pos,t,this.canvas),this.mouseX=this.pos.x/this.canvas.width,this.mouseY=1-this.pos.y/this.canvas.height;var e=this.renderer.cameraPosition,n=this.renderer.getWorldRayDirection(this.worldRayDirection,2*this.mouseX-1,2*this.mouseY-1);if(!this.blobController)for(var i=0;i<this.blobs.length;++i){var r=F(this.blobs[i],e,n);if(r){"Finished"===this.tutorialState.kind&&(this.tutorialState.hasInteracted=!0),this.blobController=new B(this.blobs[i],r.draggingRestPosition),this.onBlobInteraction&&this.onBlobInteraction(i);break}}this.audio.tryUnlock()},t.prototype.onMouseMove=function(t){ft(this.pos,t,this.canvas),this.mouseX=this.pos.x/this.canvas.width,this.mouseY=1-this.pos.y/this.canvas.height},t.prototype.onMouseUp=function(){this.blobController&&(this.blobController=null)},t.prototype.onTouchStart=function(t){t.preventDefault(),1===t.touches.length&&this.onMouseDown(t.targetTouches[0])},t.prototype.onTouchMove=function(t){t.preventDefault(),this.onMouseMove(t.targetTouches[0])},t.prototype.onTouchEnd=function(t){t.preventDefault(),t.touches.length>0||this.onMouseUp()},t.prototype.onTouchCancel=function(t){t.preventDefault(),t.touches.length>0||this.onMouseUp()},t.prototype.positionElementWorld=function(t,e,n,i){var r=this.renderer.getScreenPosition(this.tempScreenPosition,e),o=this.canvas.width*(.5*r[0]+.5),a=this.canvas.height*(1-(.5*r[1]+.5)),s="translate("+o.toFixed(0)+"px, "+a.toFixed(0)+"px) ";"left"===n?s+="translate(0, ":"right"===n?s+="translate(-100%, ":"center"===n&&(s+="translate(-50%, "),"bottom"===i?s+="-100%)":"center"===i?s+="-50%)":"top"===i&&(s+="0)"),t.style.transform=s},t.prototype.update=function(t){var e=this;this.clock.tick(t);for(var n=0,i=this.frameTrackers;n<i.length;n++){i[n].update()}var r=this.renderer.cameraPosition,o=this.renderer.getWorldRayDirection(this.worldRayDirection,2*this.mouseX-1,2*this.mouseY-1);this.blobController&&this.blobController.step(r,o),Object(f.h)(this.lookPosition,kt,It,r,o);for(var a=0,s=this.blobs;a<s.length;a++){(p=s[a]).lookPosition=this.lookPosition}for(var l=0;l<4;++l){this.silenced[l]?(this.blobs[l].eyeTopOpenness.change(0,.3),this.blobs[l].eyeBottomOpenness.change(0,.3)):(this.blobs[l].eyeTopOpenness.change(1,.3),this.blobs[l].eyeBottomOpenness.change(0,.3))}for(l=0;l<this.blobs.length;++l){var u=this.frameTrackers[l].getCurrentFrame(),d=[];this.blobController&&this.blobs[l]===this.blobController.blob&&d.push({yScale:this.blobController.yScale,zOffset:this.blobController.zOffset,isSelf:!0}),this.blobs[l].step(d,u||null)}for(l=0;l<this.blobs.length;++l)this.blobs[l].isDragging?(this.silenced[l]=!1,this.audio.synthRunner.setOverrideFrequency(l,!0),this.audio.synthRunner.addOverrideF0(l,Object(f.k)(this.blobs[l].liveMidiNote.evaluate()+ht))):this.audio.synthRunner.setOverrideFrequency(l,!1);if(null!==this.blobController){var p=this.blobController.blob,m=this.blobs.indexOf(p);this.lastControlledIndex=m;var g=0===this.lastSungNote.midiPitch,v=g?.05:.2;if(!S(this.lastSungNote,p.currentPitchVowel)&&p.getTimeOnCurrentNote()>v&&this.voiceNet.framesBeingGenerated<ct){var b=this.clock.getTimeMs();if(this.state===Pt.Main)if("Pitch"===this.tutorialState.kind)this.tutorialState.notesSung+=1,p.currentPitchVowel.midiPitch!==this.lastSungNote.midiPitch&&(this.tutorialState.pitchesChanged+=1,4===this.tutorialState.pitchesChanged&&this.blobs[2].startFalling(0));else if("Vowel"===this.tutorialState.kind&&2===m){this.tutorialState.notesSung+=1,p.currentPitchVowel.vowel!==this.lastSungNote.vowel&&(this.tutorialState.vowelsChanged+=1,3===this.tutorialState.vowelsChanged&&this.blobs[1].startFalling(0))}else"Harmonization"===this.tutorialState.kind&&1===m?(this.tutorialState.notesSung+=1,2===this.tutorialState.notesSung&&this.blobs[0].startFalling(0)):"Mute"===this.tutorialState.kind&&0===m&&(this.tutorialState.notesSung+=1);g&&(this.firstNoteTime=b),this.audio.synthRunner.setPans(this.audio.synthRunner.audioParameters.pans[m]);var y=p.currentPitchVowel;this.lastSungNote=y;var w=this.libretto.getNextChunk(y.vowel);if(this.singers[m].singNote(w,y.midiPitch+ht,!1,!1,this.substeps[m]),this.addNoteToRecording(m,b,y.midiPitch+ht,w,!0),this.state===Pt.Main){var _=y.midiPitch;2!==m&&3!==m||(_+=12),this.harmonizer.harmonize(_).then((function(t){for(var n=function(n){var i=200*(n-m),r=e.firstNoteTime+i;"Empty"===e.harmonizationTimeouts[n]&&"Fired"!==e.harmonizationTimeouts[n]?("Empty"!==e.harmonizationTimeouts[n]&&window.clearTimeout(e.harmonizationTimeouts[n]),e.harmonizationTimeouts[n]=window.setTimeout((function(){var r=e.singers[m].previousChunk;if(!Object(f.a)(r.suffix.map((function(t){return t.name})),e.singers[n].currentChunk.suffix.map((function(t){return t.name})))){var o={vowel:{name:x.b.sil,duration:r.vowel.duration},suffix:r.suffix};e.singers[n].singNote(o,e.singers[n].currentMidiNote,!0,!1,1)}e.singers[n].singNote(e.singers[m].currentChunk,t[n].midiNote+ht,!1,!1,e.substeps[n]),e.addNoteToRecording(n,b+i,t[n].midiNote+ht,e.singers[m].currentChunk,!1),e.harmonizationTimeouts[n]="Fired"}),r-e.clock.getTimeMs())):"Fired"===e.harmonizationTimeouts[n]&&(e.singers[n].singNote(w,t[n].midiNote+ht,!1,!1,e.substeps[n]),e.addNoteToRecording(n,b,t[n].midiNote+ht,w,!1))},i=m+1;i<4;++i)n(i)}))}}}if(null===this.blobController&&0!==this.lastSungNote.midiPitch){var A=this.libretto.getNextChunk(x.b.sil),R=this.clock.getTimeMs();if(this.state===Pt.Main)for(l=0;l<4;++l)this.singers[l].currentMuted||(this.singers[l].singNote(A,this.singers[l].currentMidiNote,!0,!1,this.substeps[l]),this.addNoteToRecording(l,R,this.singers[l].currentMidiNote,A,!1));else if(this.state===Pt.Playing){var T=this.lastControlledIndex;-1!==T&&(this.singers[T].currentMuted||this.singers[T].singNote(A,this.singers[T].currentMidiNote,!0,!1,this.substeps[T]))}for(l=0;l<this.harmonizationTimeouts.length;++l)"Empty"!==this.harmonizationTimeouts[l]&&"Fired"!==this.harmonizationTimeouts[l]&&window.clearTimeout(this.harmonizationTimeouts[l]),this.harmonizationTimeouts[l]="Empty";this.lastSungNote={midiPitch:0,vowel:null},this.lastControlledIndex=-1}if(this.state===Pt.Playing&&this.playing){var E=Math.max(0,(this.clock.getTimeMs()-this.playbackStartTime)/1e3);for(l=0;l<4;++l)for(var M=this.playingRecording.parts[l].notes;this.playbackIndex[l]<M.length&&M[this.playbackIndex[l]].timeSeconds<E;){var k=M[this.playbackIndex[l]],F=k.librettoChunk.vowel.duration<=.11;this.blobs[l].isDragging||this.singers[l].singNote(k.librettoChunk,k.midiPitch,k.librettoChunk.vowel.name===x.b.sil,k.controlled,this.substeps[l],F?.1:.2),this.playbackIndex[l]+=1}(function(t,e){for(var n=0;n<4;++n)if(e[n]<t.parts[n].notes.length)return!1;return!0})(this.playingRecording,this.playbackIndex)&&this.startPlayback(1)}if("Finished"===this.tutorialState.kind)for(l=0;l<4;++l)this.prompts[l].classList.remove("visible");else for(l=0;l<4;++l){var I=c.transformPosition([],h.a.add([],this.blobs[l].getVertexPosition(this.blobs[l].mouthIndex),[-.3,0,0]),this.blobs[l].modelMatrix);if(this.positionElementWorld(this.prompts[l],I,"right","center"),this.blobs[l].state!==P.Falling){var B=!1;3===l?B="Pitch"===this.tutorialState.kind:2===l?B="Vowel"===this.tutorialState.kind:1===l?B="Harmonization"===this.tutorialState.kind:0===l&&(B="Mute"===this.tutorialState.kind),B&&this.state===Pt.Main&&this.showingPrompts?this.prompts[l].classList.add("visible"):this.prompts[l].classList.remove("visible")}}for(l=0;l<4;++l){!(this.state===Pt.Main&&"Mute"===this.tutorialState.kind&&this.tutorialState.notesSung>0||"Finished"===this.tutorialState.kind||this.state===Pt.Playing)||this.isDraggingBlob()&&"Mute"!==this.tutorialState.kind||!this.showingPrompts?this.silenceButtons[l].visible&&(this.silenceButtons[l].element.classList.remove("visible"),this.silenceButtons[l].visible=!1):this.silenceButtons[l].visible||(this.silenceButtons[l].element.classList.add("visible"),this.silenceButtons[l].visible=!0),this.silenced[l]?this.silenceButtons[l].silenced||(this.silenceButtons[l].element.classList.add("silenced"),this.silenceButtons[l].silenced=!0):this.silenceButtons[l].silenced&&(this.silenceButtons[l].element.classList.remove("silenced"),this.silenceButtons[l].silenced=!1,this.silenceButtons[l].hideTime=Date.now()),this.silenceButtons[l].visible&&(h.a.add(this.silenceWorldPositions[l],this.blobs[l].getVertexPosition(this.blobs[l].topIndex),Bt),c.transformPosition(this.silenceWorldPositions[l],this.silenceWorldPositions[l],this.blobs[l].modelMatrix),this.positionElementWorld(this.silenceButtons[l].element,this.silenceWorldPositions[l],"left","bottom"))}if(this.rendererPadding.change(this.state===Pt.Playing?60:0,1),this.renderer.paddingHeight=this.rendererPadding.evaluate(),"Pitch"===this.tutorialState.kind&&this.state===Pt.Main&&null!==this.blobController&&this.showingPrompts){this.pitchPrompt.visible||(this.pitchPrompt.element.classList.add("visible"),this.pitchPrompt.visible=!0);p=this.blobController.blob;var C=c.transformPosition([],[.3,p.pitchUI.indicatorY.evaluate(),0],p.pitchUI.getModelMatrix()),D=Et[(p.pitchUI.currentDraggedValue+ht)%12].toUpperCase();this.pitchPrompt.text!==D&&(document.getElementById("pitch-prompt-pitch").innerText=D,this.pitchPrompt.text=D),this.positionElementWorld(this.pitchPrompt.element,C,"left","center"),p.pitchUI.currentSoundedValue===p.pitchUI.currentDraggedValue?this.pitchPrompt.sounding||(document.getElementById("pitch-prompt-pitch").classList.add("sounding"),this.pitchPrompt.sounding=!0):this.pitchPrompt.sounding&&(document.getElementById("pitch-prompt-pitch").classList.remove("sounding"),this.pitchPrompt.sounding=!1)}else this.pitchPrompt.visible&&(this.pitchPrompt.element.classList.remove("visible"),this.pitchPrompt.visible=!1);if("Vowel"===this.tutorialState.kind&&this.state===Pt.Main&&null!==this.blobController&&2===this.blobs.indexOf(this.blobController.blob)&&this.showingPrompts){this.vowelPrompt.visible||(this.vowelPrompt.element.classList.add("visible"),this.vowelPrompt.visible=!0);p=this.blobController.blob,C=c.transformPosition([],[-.2,p.vowelUI.indicatorY.evaluate(),0],p.vowelUI.getModelMatrix());var L=Object(x.c)(p.vowelUI.currentDraggedValue);this.vowelPrompt.text!==L&&(document.getElementById("vowel-prompt-vowel").innerText=Object(x.c)(p.vowelUI.currentDraggedValue),this.vowelPrompt.text=L),this.positionElementWorld(this.vowelPrompt.element,C,"center","bottom"),p.vowelUI.currentSoundedValue===p.vowelUI.currentDraggedValue?this.vowelPrompt.sounding||(document.getElementById("vowel-prompt-vowel").classList.add("sounding"),this.vowelPrompt.sounding=!0):this.vowelPrompt.sounding&&(document.getElementById("vowel-prompt-vowel").classList.remove("sounding"),this.vowelPrompt.sounding=!1)}else this.vowelPrompt.visible&&(this.vowelPrompt.element.classList.remove("visible"),this.vowelPrompt.visible=!1);this.state!==Pt.Main||this.isDraggingBlob()||(this.cameraPosition.change(this.cameraPositions[this.getUnlockedVoiceIndex()],1.5),"Finished"!==this.tutorialState.kind&&("Pitch"===this.tutorialState.kind&&this.tutorialState.pitchesChanged>=4?this.tutorialState={kind:"Vowel",vowelsChanged:0,notesSung:0}:"Vowel"===this.tutorialState.kind&&this.tutorialState.vowelsChanged>=3?this.tutorialState={kind:"Harmonization",notesHarmonized:0,notesSung:0}:"Harmonization"===this.tutorialState.kind&&this.tutorialState.notesSung>=2?this.tutorialState={kind:"Mute",notesSung:0}:"Mute"===this.tutorialState.kind&&this.tutorialState.notesSung>0&&(this.tutorialState={kind:"Finished",hasInteracted:!1},this.audio.samplePlayer.play("applause"),this.onTutorialFinished&&this.onTutorialFinished())));for(l=0;l<this.blobs.length;++l)this.state===Pt.Main&&("Pitch"===this.tutorialState.kind||"Vowel"===this.tutorialState.kind&&3===l)?this.blobs[l].vowelUI.overrideAlpha.change(0,.5,.5):this.blobs[l].vowelUI.overrideAlpha.change(1,.5,.5),this.state===Pt.Main&&"Vowel"===this.tutorialState.kind&&3!==l?(2===l&&this.blobs[l].vowelUI.yOffset.change(3.5,0),this.blobs[l].pitchUI.overrideAlpha.change(0,.5)):(l>=2&&this.blobs[l].vowelUI.yOffset.change(0,1,0),this.blobs[l].pitchUI.overrideAlpha.change(1,.5));this.cameraPosition.evaluate(this.cameraPositionCache),this.renderer.setViewMatrix(c.makeTranslation(this.viewMatrix,-this.cameraPositionCache[0],-this.cameraPositionCache[1],-this.cameraPositionCache[2])),this.theme===At.Festive?this.snowSpawnRate.change(600,1):this.snowSpawnRate.change(0,1),this.renderer.snowSpawnRate=this.snowSpawnRate.evaluate(),this.renderer.render(this.blobs)},t.prototype.addNoteToRecording=function(t,e,n,i,r){this.isRecording&&this.currentRecording.parts[t].notes.push({timeSeconds:(e-this.recordingStartTime)/1e3,librettoChunk:i,midiPitch:n,controlled:r})},t.prototype.onGeneratedFrame=function(t,e,n){if(this.lastSentF0s[t]=e.getF0(),!this.silenced[t])for(var i=0;i<n.length;++i){var r=this.bufferPool.getBuffer(it.a.getSizeBytes());Object(f.d)(n[i].buffer,r),this.frameTrackers[t].addFrame(new it.a(r))}if(!this.silenced[t]&&!this.audio.isMuted()){this.audio.synthRunner.addSpectralFrame(t,e);for(i=0;i<n.length;++i)this.audio.synthRunner.addExcitationFrame(t,n[i])}},t.prototype.sendSilence=function(t){for(var e=this,n=new nt.a(this.bufferPool.getBuffer(nt.a.getSizeBytes())),i=n.getSpectral(),r=0;r<60;++r)i[r]=-120;var o=function(n){n.setMuted(!0),n.setF0(e.lastSentF0s[t]),n.setMidiNote(Object(f.g)(e.lastSentF0s[t])),n.setPhoneme(x.b.sil),n.setNextPhoneme(x.b.sil),n.setVowel(x.b.sil),n.setSingerIndex(t),n.setPreviousPhoneme(x.b.sil),n.setPhonemePosition(0)};o(n),n.setSubsteps(this.substeps[t]),n.setSendTime(Date.now()-this.epoch);var a=[];for(r=0;r<1;++r){var s=new it.a(this.bufferPool.getBuffer(it.a.getSizeBytes()));o(s);for(var l=s.getAperiodic(),u=0;u<4;++u)l[u]=-120;a.push(s)}this.onGeneratedFrame(t,n,a)},t.prototype.addStateChangeListener=function(t){this.stateChangeListeners.push(t)},t.prototype.fireStateChangeListeners=function(){for(var t=0,e=this.stateChangeListeners;t<e.length;t++){(0,e[t])(this.state)}},t.prototype.getUnlockedVoiceIndex=function(){return"Pitch"===this.tutorialState.kind?3:"Vowel"===this.tutorialState.kind?2:"Harmonization"===this.tutorialState.kind?1:"Finished"===this.tutorialState.kind||"Mute"===this.tutorialState.kind?0:void 0},t.prototype.setAudioParameters=function(t){this.audio.synthRunner.setAudioParameters(t),this.voiceNet.setParameters(t)},t.prototype.freeze=function(){this.suspended||(this.audio.suspend(),cancelAnimationFrame(this.requestedFrame),this.suspended=!0)},t.prototype.resume=function(){var t=this;if(this.suspended){this.audio.resume();var e=!0,n=0,i=function(r){var o=e?1e3/60:r-n;t.update(o),t.requestedFrame=requestAnimationFrame(i),n=r,e&&(e=!1)};this.requestedFrame=requestAnimationFrame(i),this.suspended=!1}},t.prototype.completedTutorial=function(){return"Finished"===this.tutorialState.kind},t.prototype.isDraggingBlob=function(){return null!==this.blobController},t.prototype.exitPlaying=function(){this.stopPlayback()},t.prototype.enterMain=function(){if(this.state!==Pt.Main){this.state===Pt.Playing&&this.exitPlaying();for(var t=0;t<this.getUnlockedVoiceIndex();++t)this.blobs[t].startRising(10*t);this.state=Pt.Main,this.fireStateChangeListeners()}},t.prototype.enterPlaying=function(t){if(this.state===Pt.Main){for(var e=0;e<this.getUnlockedVoiceIndex();++e)this.blobs[e].state!==P.Idle&&this.blobs[e].startFalling(10*e);this.cameraPosition.change(this.cameraPositions[0],1)}else this.state,Pt.Playing;this.state=Pt.Playing,this.setTheme(t.theme),this.playingRecording=t,this.playing=!1,this.startPlayback(0),this.fireStateChangeListeners()},t.prototype.startNewRecording=function(){this.isRecording=!0,this.currentRecording={theme:At.Normal,parts:[{notes:[],startSuffix:[]},{notes:[],startSuffix:[]},{notes:[],startSuffix:[]},{notes:[],startSuffix:[]}]},this.recordingStartTime=this.clock.getTimeMs(),"Finished"===this.tutorialState.kind&&(this.tutorialState.hasInteracted=!0)},t.prototype.finishRecording=function(){if(!this.isRecording)return null;var t=this.currentRecording;return function(t,e){for(var n=1/0,i=0,r=t.parts;i<r.length;i++){(l=r[i]).notes.length>0&&(n=Math.min(n,l.notes[0].timeSeconds))}for(var o=e-n,a=0,s=t.parts;a<s.length;a++)for(var l,u=0,c=(l=s[a]).notes;u<c.length;u++){c[u].timeSeconds+=o}}(t,.2),this.isRecording=!1,this.currentRecording=null,t},t.prototype.togglePlayback=function(){this.state===Pt.Playing&&(this.playing?this.stopPlayback():this.startPlayback(0))},t.prototype.startPlayback=function(t){this.state===Pt.Playing&&(this.playing=!0,this.playbackStartTime=this.clock.getTimeMs()+1e3*t,this.playbackIndex=[0,0,0,0])},t.prototype.stopPlayback=function(){if(this.state===Pt.Playing&&this.playing){this.playing=!1;for(var t=this.libretto.getNextChunk(x.b.sil),e=0;e<4;++e)this.singers[e].currentMuted||this.singers[e].singNote(t,this.singers[e].currentMidiNote,!0,!1,1)}},t.prototype.skipTutorial=function(){if(this.state===Pt.Main){for(var t=this.getUnlockedVoiceIndex()-1;t>=0;t-=1){var e=this.getUnlockedVoiceIndex()-(t+1);this.blobs[t].startFalling(10*e)}this.tutorialState={kind:"Finished",hasInteracted:!0}}},t.prototype.setTheme=function(t){if(this.theme=t,this.theme===At.Festive)for(var e=0;e<4;++e)this.blobs[e].hatOffset.change(0,.5,.1*(3-e));else for(e=0;e<4;++e)this.blobs[e].hatOffset.change(1,.5,.1*e)},t.prototype.getAudioRTF=function(){return this.audio.synthRunner.getAverageTime()},t.prototype.getAudioRTFEnoughSamples=function(){return this.audio.synthRunner.getEnoughSamples()},t}(),Lt=(Tt="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(t){var e,n,i=void 0!==(t=t||{})?t:{};i.ready=new Promise((function(t,i){e=t,n=i}));var r,o={};for(r in i)i.hasOwnProperty(r)&&(o[r]=i[r]);var a,s=[],l="";"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),Tt&&(l=Tt),l=0!==l.indexOf("blob:")?l.substr(0,l.lastIndexOf("/")+1):"",i.print||console.log.bind(console);var u,c,h=i.printErr||console.warn.bind(console);for(r in o)o.hasOwnProperty(r)&&(i[r]=o[r]);o=null,i.arguments&&(s=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit,i.wasmBinary&&(u=i.wasmBinary),i.noExitRuntime&&i.noExitRuntime,"object"!=typeof WebAssembly&&k("no native wasm support detected");var f=!1;function d(t){var e,n=i["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",n||k("Assertion failed: "+e),n}function p(t,e,n,i,r){var o={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);!function(t,e,n){!function(t,e,n,i){if(!(i>0))return 0;for(var r=n+i-1,o=0;o<t.length;++o){var a=t.charCodeAt(o);if(a>=55296&&a<=57343){var s=t.charCodeAt(++o);a=65536+((1023&a)<<10)|1023&s}if(a<=127){if(n>=r)break;e[n++]=a}else if(a<=2047){if(n+1>=r)break;e[n++]=192|a>>6,e[n++]=128|63&a}else if(a<=65535){if(n+2>=r)break;e[n++]=224|a>>12,e[n++]=128|a>>6&63,e[n++]=128|63&a}else{if(n+3>=r)break;e[n++]=240|a>>18,e[n++]=128|a>>12&63,e[n++]=128|a>>6&63,e[n++]=128|63&a}}e[n]=0}(t,v,e,n)}(t,e=Q(n),n)}return e},array:function(t){var e=Q(t.length);return function(t,e){g.set(t,e)}(t,e),e}},a=d(t),s=[],l=0;if(i)for(var u=0;u<i.length;u++){var c=o[n[u]];c?(0===l&&(l=J()),s[u]=c(i[u])):s[u]=i[u]}var h=a.apply(null,s);return h=function(t){return"string"===e?(n=t)?function(t,e,n){for(var i=e+n,r=e;t[r]&&!(r>=i);)++r;if(r-e>16&&t.subarray&&y)return y.decode(t.subarray(e,r));for(var o="";e<r;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var l=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&t[e++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}(v,n,i):"":"boolean"===e?Boolean(t):t;var n,i}(h),0!==l&&Z(l),h}var m,g,v,b,y="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function x(t){m=t,i.HEAP8=g=new Int8Array(t),i.HEAP16=new Int16Array(t),i.HEAP32=b=new Int32Array(t),i.HEAPU8=v=new Uint8Array(t),i.HEAPU16=new Uint16Array(t),i.HEAPU32=new Uint32Array(t),i.HEAPF32=new Float32Array(t),i.HEAPF64=new Float64Array(t)}var w,_=i.INITIAL_MEMORY||16777216;(c=i.wasmMemory?i.wasmMemory:new WebAssembly.Memory({initial:_/65536,maximum:32768}))&&(m=c.buffer),_=m.byteLength,x(m);var P=[],A=[],S=[],R=[],T=0,E=null,M=null;function k(t){i.onAbort&&i.onAbort(t),h(t+=""),f=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw n(e),e}function F(t){return e=t,n="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(n):0===e.indexOf(n);var e,n}i.preloadedImages={},i.preloadedAudios={};var I,B="blobmodule.wasm";function C(){try{if(u)return new Uint8Array(u);if(a)return a(B);throw"both async and sync fetching of the wasm failed"}catch(t){k(t)}}function D(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?w.get(n)():w.get(n)(e.arg):n(void 0===e.arg?null:e.arg)}else e(i)}}F(B)||(I=B,B=i.locateFile?i.locateFile(I,l):l+I);var L=0,O=4,N=8,U=12,j=13,z=16;function G(t){this.excPtr=t,this.ptr=t-z,this.set_type=function(t){b[this.ptr+N>>2]=t},this.get_type=function(){return b[this.ptr+N>>2]},this.set_destructor=function(t){b[this.ptr+L>>2]=t},this.get_destructor=function(){return b[this.ptr+L>>2]},this.set_refcount=function(t){b[this.ptr+O>>2]=t},this.set_caught=function(t){t=t?1:0,g[this.ptr+U>>0]=t},this.get_caught=function(){return 0!=g[this.ptr+U>>0]},this.set_rethrown=function(t){t=t?1:0,g[this.ptr+j>>0]=t},this.get_rethrown=function(){return 0!=g[this.ptr+j>>0]},this.init=function(t,e){this.set_type(t),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=b[this.ptr+O>>2];b[this.ptr+O>>2]=t+1},this.release_ref=function(){var t=b[this.ptr+O>>2];return b[this.ptr+O>>2]=t-1,1===t}}function V(){return V.uncaught_exceptions>0}function H(t){try{return c.grow(t-m.byteLength+65535>>>16),x(c.buffer),1}catch(t){}}A.push({func:function(){q()}});var Y,W={c:function(t){return X(t+z)+z},b:function(t,e,n){throw new G(t).init(e,n),"uncaught_exception"in V?V.uncaught_exceptions++:V.uncaught_exceptions=1,t},d:function(){k()},e:function(t,e,n){v.copyWithin(t,e,e+n)},f:function(t){t>>>=0;var e=v.length;if(t>2147483648)return!1;for(var n,i,r=1;r<=4;r*=2){var o=e*(1+.2/r);if(o=Math.min(o,t+100663296),H(Math.min(2147483648,((n=Math.max(16777216,t,o))%(i=65536)>0&&(n+=i-n%i),n))))return!0}return!1},a:c},q=(function(){var t={a:W};function e(t,e){var n=t.exports;i.asm=n,w=i.asm.g,function(t){if(T--,i.monitorRunDependencies&&i.monitorRunDependencies(T),0==T&&(null!==E&&(clearInterval(E),E=null),M)){var e=M;M=null,e()}}()}function r(t){e(t.instance)}function o(e){return(u||"function"!=typeof fetch?Promise.resolve().then(C):fetch(B,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+B+"'";return t.arrayBuffer()})).catch((function(){return C()}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){h("failed to asynchronously prepare wasm: "+t),k(t)}))}if(T++,i.monitorRunDependencies&&i.monitorRunDependencies(T),i.instantiateWasm)try{return i.instantiateWasm(t,e)}catch(t){return h("Module.instantiateWasm callback failed with error: "+t),!1}(u||"function"!=typeof WebAssembly.instantiateStreaming||F(B)||"function"!=typeof fetch?o(r):fetch(B,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(r,(function(t){return h("wasm streaming compile failed: "+t),h("falling back to ArrayBuffer instantiation"),o(r)}))}))).catch(n)}(),i.___wasm_call_ctors=function(){return(q=i.___wasm_call_ctors=i.asm.h).apply(null,arguments)}),X=(i._createBlob=function(){return(i._createBlob=i.asm.i).apply(null,arguments)},i._blobStep=function(){return(i._blobStep=i.asm.j).apply(null,arguments)},i._blobReset=function(){return(i._blobReset=i.asm.k).apply(null,arguments)},i._blobAddImpulse=function(){return(i._blobAddImpulse=i.asm.l).apply(null,arguments)},i._blobGetMouthIndex=function(){return(i._blobGetMouthIndex=i.asm.m).apply(null,arguments)},i._blobGetTopIndex=function(){return(i._blobGetTopIndex=i.asm.n).apply(null,arguments)},i._blobGetVertexCount=function(){return(i._blobGetVertexCount=i.asm.o).apply(null,arguments)},i._blobGetPositions=function(){return(i._blobGetPositions=i.asm.p).apply(null,arguments)},i._blobGetRestPositions=function(){return(i._blobGetRestPositions=i.asm.q).apply(null,arguments)},i._blobGetNormals=function(){return(i._blobGetNormals=i.asm.r).apply(null,arguments)},i._blobGetUVs=function(){return(i._blobGetUVs=i.asm.s).apply(null,arguments)},i._blobGetIndices=function(){return(i._blobGetIndices=i.asm.t).apply(null,arguments)},i._blobGetIndexCount=function(){return(i._blobGetIndexCount=i.asm.u).apply(null,arguments)},i._blobGetRenderingVertexCount=function(){return(i._blobGetRenderingVertexCount=i.asm.v).apply(null,arguments)},i._blobGetRenderingPositions=function(){return(i._blobGetRenderingPositions=i.asm.w).apply(null,arguments)},i._blobGetRenderingNormals=function(){return(i._blobGetRenderingNormals=i.asm.x).apply(null,arguments)},i._blobGetRenderingUVs=function(){return(i._blobGetRenderingUVs=i.asm.y).apply(null,arguments)},i._blobGetRenderingIndices=function(){return(i._blobGetRenderingIndices=i.asm.z).apply(null,arguments)},i._blobGetRenderingIndexCount=function(){return(i._blobGetRenderingIndexCount=i.asm.A).apply(null,arguments)},i._blobGetMouthTriangleIndexCount=function(){return(i._blobGetMouthTriangleIndexCount=i.asm.B).apply(null,arguments)},i._blobGetMouthTriangleIndices=function(){return(i._blobGetMouthTriangleIndices=i.asm.C).apply(null,arguments)},i._blobGetMouthPositionCount=function(){return(i._blobGetMouthPositionCount=i.asm.D).apply(null,arguments)},i._blobGetMouthPositions=function(){return(i._blobGetMouthPositions=i.asm.E).apply(null,arguments)},i._blobRayIntersect=function(){return(i._blobRayIntersect=i.asm.F).apply(null,arguments)},i._blobSetDamping=function(){return(i._blobSetDamping=i.asm.G).apply(null,arguments)},i._blobSetMouthDamping=function(){return(i._blobSetMouthDamping=i.asm.H).apply(null,arguments)},i._blobSetMouthScale=function(){return(i._blobSetMouthScale=i.asm.I).apply(null,arguments)},i._blobSetMouthBend=function(){return(i._blobSetMouthBend=i.asm.J).apply(null,arguments)},i._blobSetMouthNoiseScale=function(){return(i._blobSetMouthNoiseScale=i.asm.K).apply(null,arguments)},i._blobSetMouthNoiseOffset=function(){return(i._blobSetMouthNoiseOffset=i.asm.L).apply(null,arguments)},i._blobSetMouthNoiseFrequency=function(){return(i._blobSetMouthNoiseFrequency=i.asm.M).apply(null,arguments)},i._blobSetIsDragging=function(){return(i._blobSetIsDragging=i.asm.N).apply(null,arguments)},i._blobSetNoiseParameters=function(){return(i._blobSetNoiseParameters=i.asm.O).apply(null,arguments)},i._blobSetBreathVolumeScale=function(){return(i._blobSetBreathVolumeScale=i.asm.P).apply(null,arguments)},i._blobGetEye=function(){return(i._blobGetEye=i.asm.Q).apply(null,arguments)},i._blobGetBrimPositions=function(){return(i._blobGetBrimPositions=i.asm.R).apply(null,arguments)},i._blobGetTongue=function(){return(i._blobGetTongue=i.asm.S).apply(null,arguments)},i._eyeGetVertexCount=function(){return(i._eyeGetVertexCount=i.asm.T).apply(null,arguments)},i._tongueGetPointCount=function(){return(i._tongueGetPointCount=i.asm.U).apply(null,arguments)},i._tongueGetPositions=function(){return(i._tongueGetPositions=i.asm.V).apply(null,arguments)},i._tongueGetTangents=function(){return(i._tongueGetTangents=i.asm.W).apply(null,arguments)},i._tongueGetNormals=function(){return(i._tongueGetNormals=i.asm.X).apply(null,arguments)},i._tongueSetWindForce=function(){return(i._tongueSetWindForce=i.asm.Y).apply(null,arguments)},i._tongueSetOscillationScale=function(){return(i._tongueSetOscillationScale=i.asm.Z).apply(null,arguments)},i._eyeGetPositions=function(){return(i._eyeGetPositions=i.asm._).apply(null,arguments)},i._eyeGetRestPositions=function(){return(i._eyeGetRestPositions=i.asm.$).apply(null,arguments)},i._eyeGetNormals=function(){return(i._eyeGetNormals=i.asm.aa).apply(null,arguments)},i._eyeGetCenterPosition=function(){return(i._eyeGetCenterPosition=i.asm.ba).apply(null,arguments)},i._eyeGetIndices=function(){return(i._eyeGetIndices=i.asm.ca).apply(null,arguments)},i._eyeGetIndexCount=function(){return(i._eyeGetIndexCount=i.asm.da).apply(null,arguments)},i._blobGetHat=function(){return(i._blobGetHat=i.asm.ea).apply(null,arguments)},i._hatGetPointCount=function(){return(i._hatGetPointCount=i.asm.fa).apply(null,arguments)},i._hatGetPositions=function(){return(i._hatGetPositions=i.asm.ga).apply(null,arguments)},i._hatGetTangents=function(){return(i._hatGetTangents=i.asm.ha).apply(null,arguments)},i._hatGetNormals=function(){return(i._hatGetNormals=i.asm.ia).apply(null,arguments)},i._malloc=function(){return(X=i._malloc=i.asm.ja).apply(null,arguments)}),J=i.stackSave=function(){return(J=i.stackSave=i.asm.ka).apply(null,arguments)},Z=i.stackRestore=function(){return(Z=i.stackRestore=i.asm.la).apply(null,arguments)},Q=i.stackAlloc=function(){return(Q=i.stackAlloc=i.asm.ma).apply(null,arguments)};function K(t){function n(){Y||(Y=!0,i.calledRun=!0,f||(D(A),D(S),e(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)t=i.postRun.shift(),R.unshift(t);var t;D(R)}()))}t=t||s,T>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)t=i.preRun.shift(),P.unshift(t);var t;D(P)}(),T>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),n()}),1)):n()))}if(i.ccall=p,i.cwrap=function(t,e,n,i){var r=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&r&&!i?d(t):function(){return p(t,e,n,arguments)}},M=function t(){Y||K(),Y||(M=t)},i.run=K,i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return K(),t.ready}),Ot=n(18),Nt=n(5),Ut=function(){var t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return function(e){var n,i,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(t,e){n=t,i=e}));var o,a={};for(o in r)r.hasOwnProperty(o)&&(a[o]=r[o]);var s,l=[],u="";"undefined"!=typeof document&&document.currentScript&&(u=document.currentScript.src),t&&(u=t),u=0!==u.indexOf("blob:")?u.substr(0,u.lastIndexOf("/")+1):"";r.print||console.log.bind(console);var c,h,f=r.printErr||console.warn.bind(console);for(o in a)a.hasOwnProperty(o)&&(r[o]=a[o]);a=null,r.arguments&&(l=r.arguments),r.thisProgram&&r.thisProgram,r.quit&&r.quit,r.wasmBinary&&(c=r.wasmBinary),r.noExitRuntime&&r.noExitRuntime,"object"!=typeof WebAssembly&&F("no native wasm support detected");var d=!1;function p(t){var e,n=r["_"+t];return e="Cannot call unknown function "+t+", make sure it is exported",n||F("Assertion failed: "+e),n}function m(t,e,n,i,r){var o={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);(function(t,e,n){(function(t,e,n,i){if(!(i>0))return 0;for(var r=n,o=n+i-1,a=0;a<t.length;++a){var s=t.charCodeAt(a);if(s>=55296&&s<=57343){var l=t.charCodeAt(++a);s=65536+((1023&s)<<10)|1023&l}if(s<=127){if(n>=o)break;e[n++]=s}else if(s<=2047){if(n+1>=o)break;e[n++]=192|s>>6,e[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;e[n++]=224|s>>12,e[n++]=128|s>>6&63,e[n++]=128|63&s}else{if(n+3>=o)break;e[n++]=240|s>>18,e[n++]=128|s>>12&63,e[n++]=128|s>>6&63,e[n++]=128|63&s}}e[n]=0})(t,y,e,n)})(t,e=K(n),n)}return e},array:function(t){var e=K(t.length);return function(t,e){b.set(t,e)}(t,e),e}};var a=p(t),s=[],l=0;if(i)for(var u=0;u<i.length;u++){var c=o[n[u]];c?(0===l&&(l=Z()),s[u]=c(i[u])):s[u]=i[u]}var h=a.apply(null,s);return h=function(t){return"string"===e?(n=t)?function(t,e,n){for(var i=e+n,r=e;t[r]&&!(r>=i);)++r;if(r-e>16&&t.subarray&&g)return g.decode(t.subarray(e,r));for(var o="";e<r;){var a=t[e++];if(128&a){var s=63&t[e++];if(192!=(224&a)){var l=63&t[e++];if((a=224==(240&a)?(15&a)<<12|s<<6|l:(7&a)<<18|s<<12|l<<6|63&t[e++])<65536)o+=String.fromCharCode(a);else{var u=a-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&a)<<6|s)}else o+=String.fromCharCode(a)}return o}(y,n,i):"":"boolean"===e?Boolean(t):t;var n,i}(h),0!==l&&Q(l),h}var g="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;var v,b,y,x;function w(t){v=t,r.HEAP8=b=new Int8Array(t),r.HEAP16=new Int16Array(t),r.HEAP32=x=new Int32Array(t),r.HEAPU8=y=new Uint8Array(t),r.HEAPU16=new Uint16Array(t),r.HEAPU32=new Uint32Array(t),r.HEAPF32=new Float32Array(t),r.HEAPF64=new Float64Array(t)}var _,P=r.INITIAL_MEMORY||16777216;(h=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:P/65536,maximum:32768}))&&(v=h.buffer),P=v.byteLength,w(v);var A=[],S=[],R=[],T=[];var E=0,M=null,k=null;function F(t){r.onAbort&&r.onAbort(t),f(t+=""),d=!0,1,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw i(e),e}r.preloadedImages={},r.preloadedAudios={};function I(t){return e=t,n="data:application/octet-stream;base64,",String.prototype.startsWith?e.startsWith(n):0===e.indexOf(n);var e,n}var B,C="synthmodule.wasm";function D(){try{if(c)return new Uint8Array(c);if(s)return s(C);throw"both async and sync fetching of the wasm failed"}catch(t){F(t)}}function L(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?_.get(n)():_.get(n)(e.arg):n(void 0===e.arg?null:e.arg)}else e(r)}}I(C)||(B=C,C=r.locateFile?r.locateFile(B,u):u+B);var O=0,N=4,U=8,j=12,z=13,G=16;function V(t){this.excPtr=t,this.ptr=t-G,this.set_type=function(t){x[this.ptr+U>>2]=t},this.get_type=function(){return x[this.ptr+U>>2]},this.set_destructor=function(t){x[this.ptr+O>>2]=t},this.get_destructor=function(){return x[this.ptr+O>>2]},this.set_refcount=function(t){x[this.ptr+N>>2]=t},this.set_caught=function(t){t=t?1:0,b[this.ptr+j>>0]=t},this.get_caught=function(){return 0!=b[this.ptr+j>>0]},this.set_rethrown=function(t){t=t?1:0,b[this.ptr+z>>0]=t},this.get_rethrown=function(){return 0!=b[this.ptr+z>>0]},this.init=function(t,e){this.set_type(t),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=x[this.ptr+N>>2];x[this.ptr+N>>2]=t+1},this.release_ref=function(){var t=x[this.ptr+N>>2];return x[this.ptr+N>>2]=t-1,1===t}}function H(){return H.uncaught_exceptions>0}function Y(t){try{return h.grow(t-v.byteLength+65535>>>16),w(h.buffer),1}catch(t){}}S.push({func:function(){X()}});var W,q={b:function(t){return J(t+G)+G},c:function(t,e,n){throw new V(t).init(e,n),t,"uncaught_exception"in H?H.uncaught_exceptions++:H.uncaught_exceptions=1,t},d:function(){F()},e:function(t,e,n){y.copyWithin(t,e,e+n)},f:function(t){t>>>=0;var e=y.length;if(t>2147483648)return!1;for(var n,i,r=1;r<=4;r*=2){var o=e*(1+.2/r);if(o=Math.min(o,t+100663296),Y(Math.min(2147483648,((n=Math.max(16777216,t,o))%(i=65536)>0&&(n+=i-n%i),n))))return!0}return!1},a:h},X=(function(){var t={a:q};function e(t,e){var n=t.exports;r.asm=n,_=r.asm.g,function(t){if(E--,r.monitorRunDependencies&&r.monitorRunDependencies(E),0==E&&(null!==M&&(clearInterval(M),M=null),k)){var e=k;k=null,e()}}()}function n(t){e(t.instance)}function o(e){return(c||"function"!=typeof fetch?Promise.resolve().then(D):fetch(C,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+C+"'";return t.arrayBuffer()})).catch((function(){return D()}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){f("failed to asynchronously prepare wasm: "+t),F(t)}))}if(E++,r.monitorRunDependencies&&r.monitorRunDependencies(E),r.instantiateWasm)try{return r.instantiateWasm(t,e)}catch(t){return f("Module.instantiateWasm callback failed with error: "+t),!1}(c||"function"!=typeof WebAssembly.instantiateStreaming||I(C)||"function"!=typeof fetch?o(n):fetch(C,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(n,(function(t){return f("wasm streaming compile failed: "+t),f("falling back to ArrayBuffer instantiation"),o(n)}))}))).catch(i)}(),r.___wasm_call_ctors=function(){return(X=r.___wasm_call_ctors=r.asm.h).apply(null,arguments)}),J=(r._createSynth=function(){return(r._createSynth=r.asm.i).apply(null,arguments)},r._synthGetBuffer=function(){return(r._synthGetBuffer=r.asm.j).apply(null,arguments)},r._synthStep=function(){return(r._synthStep=r.asm.k).apply(null,arguments)},r._synthHasEnoughExcitationFrames=function(){return(r._synthHasEnoughExcitationFrames=r.asm.l).apply(null,arguments)},r._synthHasEnoughSpectralFrames=function(){return(r._synthHasEnoughSpectralFrames=r.asm.m).apply(null,arguments)},r._synthSetOnlyNoise=function(){return(r._synthSetOnlyNoise=r.asm.n).apply(null,arguments)},r._synthGetVoice=function(){return(r._synthGetVoice=r.asm.o).apply(null,arguments)},r._voiceAddSpectralFrame=function(){return(r._voiceAddSpectralFrame=r.asm.p).apply(null,arguments)},r._voiceAddExcitationFrame=function(){return(r._voiceAddExcitationFrame=r.asm.q).apply(null,arguments)},r._voiceSetGain=function(){return(r._voiceSetGain=r.asm.r).apply(null,arguments)},r._createSpectralFrame=function(){return(r._createSpectralFrame=r.asm.s).apply(null,arguments)},r._spectralFrameReset=function(){return(r._spectralFrameReset=r.asm.t).apply(null,arguments)},r._spectralFrameGetSpectrogram=function(){return(r._spectralFrameGetSpectrogram=r.asm.u).apply(null,arguments)},r._createExcitationFrame=function(){return(r._createExcitationFrame=r.asm.v).apply(null,arguments)},r._excitationFrameReset=function(){return(r._excitationFrameReset=r.asm.w).apply(null,arguments)},r._excitationFrameGetAperiodic=function(){return(r._excitationFrameGetAperiodic=r.asm.x).apply(null,arguments)},r._excitationFrameGetPeriodic=function(){return(r._excitationFrameGetPeriodic=r.asm.y).apply(null,arguments)},r._clearBuffer=function(){return(r._clearBuffer=r.asm.z).apply(null,arguments)},r._copyBuffer=function(){return(r._copyBuffer=r.asm.A).apply(null,arguments)},r._createReverbContext=function(){return(r._createReverbContext=r.asm.B).apply(null,arguments)},r._createDCReverbContext=function(){return(r._createDCReverbContext=r.asm.C).apply(null,arguments)},r._reverbContextProcess=function(){return(r._reverbContextProcess=r.asm.D).apply(null,arguments)},r._heavySendMessage=function(){return(r._heavySendMessage=r.asm.E).apply(null,arguments)},r._synthBenchmarkSpectrumGeneration=function(){return(r._synthBenchmarkSpectrumGeneration=r.asm.F).apply(null,arguments)},r._malloc=function(){return(J=r._malloc=r.asm.G).apply(null,arguments)}),Z=r.stackSave=function(){return(Z=r.stackSave=r.asm.H).apply(null,arguments)},Q=r.stackRestore=function(){return(Q=r.stackRestore=r.asm.I).apply(null,arguments)},K=r.stackAlloc=function(){return(K=r.stackAlloc=r.asm.J).apply(null,arguments)};function $(t){function e(){W||(W=!0,r.calledRun=!0,d||(!0,L(S),L(R),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)t=r.postRun.shift(),T.unshift(t);var t;L(T)}()))}t=t||l,E>0||(!function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)t=r.preRun.shift(),A.unshift(t);var t;L(A)}(),E>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),e()}),1)):e()))}if(r.ccall=m,r.cwrap=function(t,e,n,i){var r=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&r&&!i?p(t):function(){return m(t,e,n,arguments)}},k=function t(){W||$(),W||(k=t)},r.run=$,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return!0,$(),e.ready}}(),jt=n(8);function zt(){return null!==(null!==navigator.userAgent.match(/Android/i)||null!==navigator.userAgent.match(/webOS/i)||null!==navigator.userAgent.match(/iPhone/i)||null!==navigator.userAgent.match(/iPad/i)||null!==navigator.userAgent.match(/iPod/i)||null!==navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function Gt(){return null!==navigator.userAgent.match(/Android/i)}function Vt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Ht=function(){function t(t){this.sampleCount=t,this.samples=[]}return t.prototype.add=function(t){this.samples.length===this.sampleCount&&this.samples.splice(0,1),this.samples.push(t)},t.prototype.get=function(){if(0===this.samples.length)return 0;for(var t=0,e=0;e<this.samples.length;++e)t+=this.samples[e];return t/this.samples.length},t.prototype.enoughSamples=function(){return this.samples.length===this.sampleCount},t}(),Yt=function(){function t(t,e,n,i,r,o,a,s,l){var u=this;this.timingEnabled=!0,this.onFrameUsed=null,this.audioContext=t,this.scriptNode=this.audioContext.createScriptProcessor(l,0,2),this.audioParameters=s,this.synth=new Ot.a(e,n,i,r,o,a,s,l),this.synth.onFrameUsed=function(t){u.onFrameUsed&&u.onFrameUsed(t)};var c=Math.floor(5*t.sampleRate/l);this.runningAverage=new Ht(c),this.bufferSize=s.scriptProcessorBufferSize}return t.prototype.start=function(){var t=this,e=1e3*this.bufferSize/this.synth.sampleRate;this.scriptNode.onaudioprocess=function(n){var i=[n.outputBuffer.getChannelData(0),n.outputBuffer.getChannelData(1)],r=performance.now();t.synth.process(i,t.scriptNode.bufferSize);var o=performance.now()-r;t.timingEnabled&&t.runningAverage.add(e/Math.max(1,o))},this.scriptNode.connect(this.audioContext.destination)},t.prototype.setTimingEnabled=function(t){this.timingEnabled=t},t.prototype.getAverageTime=function(){return this.runningAverage.get()},t.prototype.getEnoughSamples=function(){return this.runningAverage.enoughSamples()},t.prototype.setPans=function(t){this.synth.setPans(t)},t.prototype.addSpectralFrame=function(t,e){this.synth.addSpectralFrame(t,e)},t.prototype.addExcitationFrame=function(t,e){this.synth.addExcitationFrame(t,e)},t.prototype.setOverrideFrequency=function(t,e){this.synth.setOverrideFrequency(t,e)},t.prototype.addOverrideF0=function(t,e){this.synth.addOverrideF0(t,e)},t.prototype.setAudioParameters=function(t){this.synth.setAudioParameters(t)},t}();var Wt=[32e3,24e3,22050];function qt(t,e,i,r){var o=null;o=0!==i?new(window.AudioContext||window.webkitAudioContext)({sampleRate:i}):new(window.AudioContext||window.webkitAudioContext);for(var a=1;Math.floor(o.sampleRate/a)>r;)a*=2;for(var s=o.sampleRate/a,l=0,u=0;u<Wt.length&&!((l=Wt[u])<=s);++u);var c=Object(jt.a)("seeds"+l.toFixed(0)+".flat"),h=null;return h=!function(t){return t.audioWorklet&&t.audioWorklet instanceof AudioWorklet&&"function"==typeof t.audioWorklet.addModule&&window.AudioWorkletNode}(o)||e.forceScriptProcessor?function(t,e,n,i,r,o){return Promise.all([Ut(),Object(Nt.a)(e),Object(Nt.a)(n)]).then((function(e){return new Yt(t,e[0],new Uint8Array(e[1]),new Uint8Array(e[2]),t.sampleRate,r,o,i,i.scriptProcessorBufferSize)}))}(o,c,t,e,s,l):n.e(3).then(n.bind(null,45)).then((function(n){return n.createAudioWorkletSynthRunner(o,c,t,e,l)})),Promise.all([h,Xt(o,"applause","/blob-opera/applause.mp3")]).then((function(t){var e=t[1];return new Qt(o,t[0],new Jt(o,{applause:e}),s)}))}function Xt(t,e,n){return fetch(n).then((function(t){return t.arrayBuffer()})).then((function(n){return new Promise((function(i,r){t.decodeAudioData(n,(function(t){i({name:e,audioBuffer:t})}),(function(t){i(null)}))}))}))}var Jt=function(){function t(t,e){this.samples={},this.audioContext=t,this.samples=e}return t.prototype.play=function(t){var e=this.samples[t];if(e){var n=this.audioContext.createBufferSource();n.buffer=e.audioBuffer,n.loop=!1;var i=this.audioContext.createGain();i.gain.value=.2,n.connect(i),i.connect(this.audioContext.destination),n.start(0)}},t}();function Zt(t,e){var n;for(n=e;t>1;t--)n+=e;return n}var Qt=function(){function t(t,e,n,i){this.hasPlayedTrack=!1,this.audioContext=t,this.synthRunner=e,this.sampleRate=t.sampleRate,this.samplePlayer=n,this.processingSampleRate=i,this.audioContext.resume()}return t.prototype.start=function(){this.audioContext.resume(),this.synthRunner.start();var t=this.audioContext,e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(0)},t.prototype.tryUnlock=function(){if(Vt()&&!this.hasPlayedTrack){var t=document.createElement("div");t.innerHTML="<audio x-webkit-airplay='deny'></audio>",this.tag=t.children.item(0),this.tag.controls=!1,this.tag.disableRemotePlayback=!0,this.tag.preload="auto",this.tag.src="data:audio/mpeg;base64,//uQx"+Zt(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+Zt(16,"gICA")+Zt(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+Zt(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+Zt(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+Zt(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+Zt(97,"V")+"Q==",this.tag.loop=!0,this.tag.load();try{this.tag.play()}catch(t){}this.hasPlayedTrack=!0}this.audioContext.resume()},t.prototype.isMuted=function(){return"running"!==this.audioContext.state},t.prototype.suspend=function(){this.audioContext.suspend()},t.prototype.resume=function(){this.audioContext.resume()},t}();var Kt=function(){function t(t){var e=this;this.queuedPromises=[],this.worker=t,this.worker.onmessage=function(t){var n=t.data;"Notes"===n.type&&(e.queuedPromises[0](n.notes),e.queuedPromises.splice(0,1))}}return t.prototype.harmonize=function(t){var e=this;return new Promise((function(n,i){var r={note:t};e.queuedPromises.push(n),e.worker.postMessage(r)}))},t}();var $t=function(){function t(t,e){var n=this;this.workers=[],this.listeners=[],this.framesBeingGenerated=0,this.workerCount=t,this.workers=e;for(var i=0;i<4;++i)this.listeners.push([]);for(var r=function(t){o.workers[t].onmessage=function(e){var i=e.data;if("Frames"===i.type){n.framesBeingGenerated-=i.excitationFrames.length,n.framesBeingGenerated<0&&(n.framesBeingGenerated=0);for(var r=new nt.a(i.spectralFrame),o=r.getId(),a=t+o*n.workerCount,s=i.excitationFrames.map((function(t){return new it.a(t)})),l=0,u=n.listeners[a];l<u.length;l++){(0,u[l])(r,s)}}}},o=this,a=0;a<this.workers.length;++a)r(a)}return t.prototype.generate=function(t,e,n){this.framesBeingGenerated+=n.length;var i=t%this.workerCount,r=Math.floor(t/this.workerCount);e.setId(r);for(var o=0,a=n;o<a.length;o++){a[o].setId(r)}var s={type:"Generate",spectralFrame:e.buffer,excitationFrames:n.map((function(t){return t.buffer}))},l=[e.buffer].concat(s.excitationFrames);this.workers[i].postMessage(s,l)},t.prototype.addListener=function(t,e){this.listeners[t].push(e)},t.prototype.setParameters=function(t){for(var e=0,n=this.workers;e<n.length;e++){var i={type:"Parameters",parameters:t};n[e].postMessage(i)}},t}(),te=n(34);for(var ee=function(){function t(){}return t.prototype.loadRecording=function(e){return function(t){return t.length&&!t.match(/[.$\[\]#\/]/)}(e)?fetch(t.ROUTE+"/"+e).then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(t){return fetch(t.url)})).then((function(t){return t.arrayBuffer()})).then((function(t){return te.RecordingMessage.decode(new Uint8Array(t))})):Promise.reject("Invalid recording ID")},t.prototype.saveRecording=function(e){var n=te.RecordingMessage.encode(e).finish();return fetch(t.ROUTE,{method:"PUT",body:n}).then((function(t){if(!t.ok)throw Error(t.statusText);return t.json()})).then((function(t){return{id:t.id}}))},t.ROUTE="https://cilex-aeiopera.uc.r.appspot.com/recording",t}(),ne=(function(){function t(){}t.prototype.loadRecording=function(t){return new Promise((function(t,e){}))},t.prototype.saveRecording=function(t){return new Promise((function(t,e){window.setTimeout((function(){t({id:"temp"})}),1e3)}))}}(),n(36)),ie={},re=n.n(ne).a,oe=re[0].slice(1),ae=0,se=oe;ae<se.length;ae++){var le=se[ae];ie[le]={}}for(var ue=1;ue<re.length;++ue)for(var ce=re[ue],he=ce[0],fe=0;fe<oe.length;++fe)ie[oe[fe]][he]=ce[1+fe];function de(t,e){for(var n=t.toFixed(0).slice(0,e);n.length<e;)n="0"+n;return n}function pe(t){var e=Math.floor(t/60),n=Math.floor(t%60),i=Math.floor(t%1*100);return de(e,2)+":"+de(n,2)+"."+de(i,2)}var me=[{recordingID:"jinglebells",stringID:"song_jingle_bells"},{recordingID:"silentnight",stringID:"song_silent_night"},{recordingID:"joytotheworld",stringID:"song_joy_to_the_world"},{recordingID:"harktheheraldangelssing",stringID:"song_hark_the_herald_angels_sing"},{recordingID:"awayinamanger",stringID:"song_away_in_a_manger"},{recordingID:"ocomeallyefaithful",stringID:"song_o_come_all_ye_faithful"},{recordingID:"thefirstnoel",stringID:"song_the_first_noel"},{recordingID:"onceinroyaldavidscity",stringID:"song_once_in_royal_davids_city"}];function ge(t){return void 0!==me.find((function(e){return e.recordingID===t}))}function ve(t){t.predicate()?t.hasClass||(t.element.classList.add(t.className),t.hasClass=!0):t.hasClass&&(t.element.classList.remove(t.className),t.hasClass=!1)}var be=function(){function t(){this.elements=[]}return t.prototype.add=function(t,e,n){for(var i=document.querySelectorAll(t),r=0;r<i.length;++r)this.elements.push({predicate:n,element:i[r],className:e,hasClass:i[0].classList.contains(e)});return this},t.prototype.update=function(){for(var t=0,e=this.elements;t<e.length;t++){ve(e[t])}},t}();function ye(t){return t===Pt.Main?"single":t===Pt.Playing?"autoplay":void 0}var xe=function(){function t(t,e,n,i){var r=this;this.controlledElements=new be,this.saveState={kind:"None"},this.showingInfo=!1,this.showingFestivePlaylist=!1,this.hasStoppedRecording=!1,this.hasShownPlaylist=!1,this.hasShared=!1,this.hasSharedCarol=!1,this.hasToggledFestive=!1,this.hasShownPerformanceWarning=!1,this.showingPerformanceWarning=!1,this.opera=t,this.opera.addStateChangeListener(this.onStateChange.bind(this)),this.environment=e,this.environment.onLocationChange=this.onLocationChange.bind(this),this.language=i,this.backend=new ee,"Recording"===n.kind&&(this.saveState={kind:"Saved",savedRecordingID:n.recordingID,isFestiveSong:ge(n.recordingID)});var o=document.getElementById("skip"),a=function(){r.opera.skipTutorial(),r.environment.track({action:"skip-tutorial"})};o.addEventListener("click",a),o.addEventListener("touchstart",a),document.getElementById("record").addEventListener("click",(function(){r.opera.isRecording?r.endRecording():(r.opera.startNewRecording(),r.environment.track({action:"tap-record"}))})),document.getElementById("stop-record").addEventListener("click",(function(){r.opera.isRecording&&r.endRecording()})),document.getElementById("save").addEventListener("click",this.saveRecording.bind(this)),document.getElementById("startstop").addEventListener("click",this.opera.togglePlayback.bind(this.opera)),document.getElementById("play").addEventListener("click",this.opera.enterMain.bind(this.opera)),document.getElementById("back").addEventListener("click",(function(){r.opera.enterMain(),r.updatePlaylistUI(),"Previewing"===r.saveState.kind&&r.environment.track({action:"tap-discard"}),r.environment.track({action:"tap-back",label:"Saved"===r.saveState.kind?r.saveState.savedRecordingID:""})})),document.getElementById("info").addEventListener("click",(function(){r.showingInfo=!r.showingInfo;ye(r.opera.state);"Saved"===r.saveState.kind&&r.saveState.savedRecordingID,r.environment.track({action:"tap-question",label:ye(r.opera.state)})})),document.getElementById("close-info").addEventListener("click",(function(){r.showingInfo=!1})),document.getElementById("festive-playlist").addEventListener("click",(function(t){t.stopPropagation(),r.hasShownPlaylist=!0,r.showingFestivePlaylist?r.showingFestivePlaylist=!1:(r.showingFestivePlaylist=!0,r.hasShownPlaylist=!0)})),document.addEventListener("click",(function(){r.showingFestivePlaylist=!1})),document.getElementById("performance-warning-dismiss").addEventListener("click",(function(t){r.showingPerformanceWarning=!1}));var s=function(){return r.opera.state===Pt.Playing&&!t.completedTutorial()},l=function(){return t.state===Pt.Main&&"Pitch"===t.tutorialState.kind&&0===t.tutorialState.notesSung||s()},u=function(){return(t.state===Pt.Main&&t.completedTutorial()&&!t.isRecording||t.state===Pt.Playing&&t.completedTutorial())&&!r.opera.isDraggingBlob()&&!r.showingInfo},c=function(){return u()&&t.theme===At.Festive&&(t.state===Pt.Main&&!t.isRecording||t.state===Pt.Playing&&(t.state===Pt.Playing&&"Saved"===r.saveState.kind&&r.saveState.isFestiveSong||"Loading"===r.saveState.kind&&r.saveState.isFestiveSong))&&!r.opera.isDraggingBlob()};this.controlledElements.add("#skip","visible",(function(){return r.opera.state===Pt.Main&&!("Finished"===t.tutorialState.kind||"Pitch"===t.tutorialState.kind&&0===t.tutorialState.notesSung)&&!r.showingInfo})).add("#info","visible",(function(){return!l()&&!r.showingInfo})).add("#splash","visible",(function(){return l()&&!r.showingInfo})).add("#title-small","visible",(function(){return!l()&&!r.showingInfo})).add("#festive-container","visible",(function(){return!(r.opera.state===Pt.Main&&!t.completedTutorial()||r.opera.state===Pt.Playing&&!r.opera.completedTutorial()||r.showingInfo)})).add("#record-container","visible",(function(){return r.opera.state===Pt.Main&&t.completedTutorial()&&!t.isRecording&&!t.isDraggingBlob()&&!r.showingInfo})).add("#record-container","recording",(function(){return r.opera.isRecording})).add("#stop-recording-container","visible",(function(){return r.opera.state===Pt.Main&&r.opera.isRecording})).add("#save-container","visible",(function(){return t.state===Pt.Playing&&!r.showingInfo})).add("#save-container","saving",(function(){return"SaveRequested"===r.saveState.kind})).add("#discard-container","visible",(function(){return"Previewing"===r.saveState.kind&&!r.showingInfo})).add("#recording-copy-link-container","visible",(function(){return"Saved"===r.saveState.kind&&!r.showingInfo})).add("#startstop-container","visible",(function(){return t.state===Pt.Playing&&!r.showingInfo})).add("#startstop-container","playing",(function(){return t.playing})).add("#play","visible",(function(){return t.state===Pt.Playing&&!t.completedTutorial()&&!r.showingInfo})).add("#back-container","visible",(function(){return t.state===Pt.Playing&&t.completedTutorial()&&!r.showingInfo})).add("#muted-container","visible",(function(){return t.state===Pt.Playing&&t.audio.isMuted()&&!t.suspended})).add("#festive-switch-container","visible",(function(){return u()})).add("#festive-playlist","visible",(function(){return c()})).add("#info-overlay","visible",(function(){return r.showingInfo})).add("#share-recording-prompt","visible",(function(){return t.state===Pt.Playing&&"Previewing"===r.saveState.kind&&!r.hasShared&&!r.showingInfo&&!t.isDraggingBlob()})).add("#share-carol-prompt","visible",(function(){return t.state===Pt.Playing&&"Saved"===r.saveState.kind&&r.saveState.isFestiveSong&&!r.hasSharedCarol&&!r.showingInfo&&!r.showingFestivePlaylist&&!t.isDraggingBlob()})).add("#festive-songs-container","visible",(function(){return r.showingFestivePlaylist&&!r.opera.isDraggingBlob()&&!r.showingInfo})).add("#festive-playlist","depressed",(function(){return r.showingFestivePlaylist&&!r.showingInfo})).add("#recording-indicator","visible",(function(){return t.isRecording&&!r.showingInfo})).add("#carols-prompt","visible",(function(){return t.theme===At.Festive&&!r.hasShownPlaylist&&!s()&&t.completedTutorial()&&!t.isDraggingBlob()&&c()})).add("#tutorial-prompt-pitch","visible",(function(){return t.state===Pt.Main&&"Pitch"===t.tutorialState.kind&&t.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-vowel","visible",(function(){return t.state===Pt.Main&&"Vowel"===t.tutorialState.kind&&t.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-harmonization","visible",(function(){return t.state===Pt.Main&&"Harmonization"===t.tutorialState.kind&&t.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-mute","visible",(function(){return t.state===Pt.Main&&"Mute"===t.tutorialState.kind&&t.tutorialState.notesSung>0&&!r.showingInfo})).add("#tutorial-prompt-end","visible",(function(){return t.state===Pt.Main&&"Finished"===t.tutorialState.kind&&!t.tutorialState.hasInteracted&&!r.showingInfo})).add("#recording-frame-bottom-left","visible",(function(){return t.state===Pt.Main&&"Finished"===t.tutorialState.kind&&t.isRecording})).add("#recording-frame-bottom-right","visible",(function(){return t.state===Pt.Main&&"Finished"===t.tutorialState.kind&&t.isRecording})).add("#recording-frame-top-left","visible",(function(){return t.state===Pt.Main&&"Finished"===t.tutorialState.kind&&t.isRecording})).add("#recording-frame-top-right","visible",(function(){return t.state===Pt.Main&&"Finished"===t.tutorialState.kind&&t.isRecording})).add("#performance-warning","visible",(function(){return r.showingPerformanceWarning})).add("#disclaimer","visible",(function(){return l()&&t.state===Pt.Main&&!r.showingInfo}));var h=document.querySelector("input[name=festive]");t.theme===At.Festive?h.setAttribute("checked","true"):h.removeAttribute("checked"),h.addEventListener("change",(function(e){t.theme===At.Normal?(r.opera.setTheme(At.Festive),r.hasToggledFestive=!0):r.opera.setTheme(At.Normal),r.environment.track({action:"tap-christmas-logo",label:ye(r.opera.state)})}));for(var f=document.getElementById("festive-songs"),d=function(t){var e=document.createElement("li");e.innerHTML='<div class="spinner"></div><span class="material-icons md-18">play_circle_outline</span><span class="song-name">'+ie[i][t.stringID]+"</span>",e.addEventListener("click",(function(e){e.stopPropagation(),r.playFestiveSong(t.recordingID),r.environment.track({action:"tap-song",label:ye(r.opera.state)+"_"+t.recordingID})})),f.appendChild(e)},p=0,m=me;p<m.length;p++){d(m[p])}var g=["soprano","mezzo-soprano","tenor","bass"];t.onBlobInteraction=function(t){r.environment.track({action:"blob-interaction",label:g[t]+"_"+ye(r.opera.state)+("Saved"===r.saveState.kind?"_"+r.saveState.savedRecordingID:"")})},t.onTutorialFinished=function(){r.environment.track({action:"finished-tutorial"})},document.getElementById("credit").addEventListener("click",(function(t){r.environment.openURL("https://david.li")})),this.onStateChange(this.opera.state);var v=function(t){r.update(t),requestAnimationFrame(v)};requestAnimationFrame(v)}return t.prototype.onLocationChange=function(t){"Default"===t.kind?this.opera.enterMain():"Recording"===t.kind&&this.playRecording(t.recordingID)},t.prototype.onStateChange=function(t){t===Pt.Main&&(this.saveState={kind:"None"}),t===Pt.Main&&this.environment.changeLocation({kind:"Default"})},t.prototype.endRecording=function(){var t=this.opera.finishRecording();(function(t){for(var e=0,n=t.parts;e<n.length;e++){if(n[e].notes.length>0)return!1}return!0})(t)||(this.hasStoppedRecording=!0,t.theme=this.opera.theme,this.opera.enterPlaying(t),this.saveState={kind:"Previewing"})},t.prototype.saveRecording=function(){var t=this,e="Saved"===this.saveState.kind&&this.saveState.isFestiveSong?ie[this.language].axl_share_recording_cc.replace("<song>",ie[this.language][me.find((function(e){return e.recordingID===t.saveState.savedRecordingID})).stringID]):ie[this.language].axl_share_recording_ugc;"Previewing"===this.saveState.kind?(this.saveState={kind:"SaveRequested"},this.opera.playingRecording.theme=this.opera.theme,this.hasShared=!0,this.backend.saveRecording(this.opera.playingRecording).then((function(n){t.saveState={kind:"Saved",savedRecordingID:n.id,isFestiveSong:!1},t.environment.changeLocation({kind:"Recording",recordingID:n.id}),t.environment.share({kind:"Recording",recordingID:t.saveState.savedRecordingID},e),t.environment.track({action:"tap-share",label:n.id})})).catch((function(e){console.log(e),t.saveState={kind:"Previewing"}}))):"Saved"===this.saveState.kind&&("Saved"===this.saveState.kind&&this.saveState.isFestiveSong&&(this.hasSharedCarol=!0),this.environment.share({kind:"Recording",recordingID:this.saveState.savedRecordingID},e),this.environment.track({action:"tap-share",label:this.saveState.savedRecordingID}))},t.prototype.update=function(t){var e=this.opera;e.showingPrompts=!this.showingInfo,this.controlledElements.update();var n,i,r,o,a,s=document.getElementById("playback-timecode"),l=document.querySelector(".progress-ring"),u=document.querySelector(".progress-circle");if(e.state===Pt.Playing){var c=e.playing?Math.max(0,e.clock.getTimeMs()-e.playbackStartTime)/1e3:0;s.innerText=pe(c);var h=Object(f.b)(c/function(t){for(var e=0,n=0,i=t.parts;n<i.length;n++){var r=i[n];r.notes.length>0&&(e=Math.max(e,r.notes[r.notes.length-1].timeSeconds))}return e}(e.playingRecording),0,1);l.setAttribute("d",(n=u.cx.baseVal.value,i=u.cy.baseVal.value,r=u.r.baseVal.value,o=h,a=-2*Math.PI*o-Math.PI/2,"M "+n+" "+(i-r)+" A "+r+" "+r+(o<.5?" 0 0 1 ":" 0 1 1 ")+(n+-Math.cos(a)*r)+" "+(i+Math.sin(a)*r)))}var d=document.getElementById("recording-timecode");if(this.opera.isRecording){c=Math.max(0,(e.clock.getTimeMs()-e.recordingStartTime)/1e3);d.innerText=pe(c)}e.getAudioRTFEnoughSamples()&&e.getAudioRTF().toFixed(1);e.audio.processingSampleRate.toFixed(0),zt()&&e.getAudioRTFEnoughSamples()&&"visible"===document.visibilityState&&!this.hasShownPerformanceWarning&&e.getAudioRTF()<3&&(e.onMouseUp(),this.hasShownPerformanceWarning=!0,this.showingPerformanceWarning=!0)},t.prototype.playFestiveSong=function(t){this.playRecording(t),this.updatePlaylistUI()},t.prototype.playRecording=function(t){var e=this;if(this.opera.state!==Pt.Playing||"Saved"!==this.saveState.kind||this.saveState.savedRecordingID!==t){this.opera.stopPlayback();var n=Object.assign({},this.saveState);this.saveState={kind:"Loading",loadingRecordingID:t,isFestiveSong:ge(t)},this.backend.loadRecording(t).then((function(n){e.opera.enterPlaying(n),e.saveState={kind:"Saved",savedRecordingID:t,isFestiveSong:e.saveState.isFestiveSong},e.showingFestivePlaylist=!1,e.updatePlaylistUI()})).catch((function(t){e.saveState=n,e.updatePlaylistUI()}))}},t.prototype.updatePlaylistUI=function(){for(var t=document.getElementById("festive-songs").querySelectorAll("li"),e=0;e<me.length;++e){var n=me[e];("Loading"===this.saveState.kind?this.saveState.loadingRecordingID===n.recordingID:this.opera.state===Pt.Playing&&"Saved"===this.saveState.kind&&this.saveState.savedRecordingID===n.recordingID)?(t[e].classList.add("playing"),t[e].querySelector(".material-icons").innerHTML="volume_up","Loading"===this.saveState.kind&&this.saveState.loadingRecordingID===n.recordingID?t[e].classList.add("loading"):t[e].classList.remove("loading")):(t[e].classList.remove("playing"),t[e].querySelector(".material-icons").innerHTML="play_circle_outline",t[e].classList.remove("loading"))}},t}(),we=n(37),_e=n.n(we),Pe=n(35),Ae={insert:"head",singleton:!1};_e()(Pe.a,Ae),Pe.a.locals;function Se(t){var e=t.hash;return""===e?{kind:"Default"}:"#/r/"===e.substr(0,"#/r/".length)?{kind:"Recording",recordingID:t.hash.slice("#/r/".length)}:{kind:"Default"}}var Re=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+window.location.pathname+(window.location.search?window.location.search:"");function Te(t){return"Default"===t.kind?"#/":"Recording"===t.kind?"#/r/"+t.recordingID:void 0}function Ee(t){navigator.clipboard?navigator.clipboard.writeText(t).then((function(){}),(function(t){})):function(t){var e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(t){}document.body.removeChild(e)}(t)}var Me=function(){function t(){this.onResume=null,this.onFreeze=null,this.onLocationChange=null,this.location=Se(window.location),window.addEventListener("hashchange",this.onHashChange.bind(this))}return t.prototype.track=function(t){},t.prototype.onHashChange=function(t){this.location=Se(window.location),this.onLocationChange&&this.onLocationChange(this.location)},t.prototype.changeLocation=function(t){this.location=t,window.location.hash=Te(t),this.onLocationChange&&this.onLocationChange(t)},t.prototype.share=function(t,e){Ee(function(t){return Re+Te(t)}(t))},t.prototype.openURL=function(t){window.open(t,"_blank")},t}();function ke(){return n.e(0).then(n.bind(null,46)).then((function(t){return new Promise((function(e,n){var i=t.default,r=new i,o=r.handshake().then((function(t){return function(t){return"r"in t?{kind:"Recording",recordingID:t.r}:"nye"in t?(alert("NYE"),{kind:"Recording",recordingID:"jinglebells"}):{kind:"Default"}}(t)})),a=new Promise((function(t,e){var n=!1;r.registerMessageCallback(i.HostToChild.RESUME,(function(){n||(t(),n=!0)}))})),s=function(){function t(t,e){var n=this;this.onLocationChange=null,this.onResume=null,this.onFreeze=null,this.axl=t,this.location=e,t.registerMessageCallback(i.HostToChild.RESUME,(function(){n.onResume&&n.onResume()})),t.registerMessageCallback(i.HostToChild.FREEZE,(function(){n.onFreeze&&n.onFreeze()}))}return t.prototype.track=function(t){r.sendMessage(i.ChildToHost.TRACK,t)},t.prototype.changeLocation=function(t){this.location=t,r.sendMessage(i.ChildToHost.SET_URL_PARAMS,function(t){return"Recording"===t.kind?{r:t.recordingID}:"Default"===t.kind?{}:void 0}(t))},t.prototype.share=function(t,e){this.changeLocation(t),"Recording"===t.kind&&r.sendMessage(i.ChildToHost.SHARE,{title:e})},t.prototype.openURL=function(t){r.sendMessage(i.ChildToHost.NAVIGATE,t)},t}();return Promise.all([o,a]).then((function(t){e(new s(r,t[0]))}))}))}))}function Fe(t){var e=t.match(/\*[^*]+?\*/);if(e)for(var n=0,i=e;n<i.length;n++){var r=i[n];t=t.replace(r,"<span>"+r.replace(/\*/g,"")+"</span>")}return e&&(t=Fe(t)),t}function Ie(t){var e=t.split("\n");if(e.length>1){for(var n="",i=0,r=e;i<r.length;i++){n+="<p>"+r[i]+"</p>"}return n}return t}function Be(t){var e=t.match(/David Li/);if(e)for(var n=0,i=e;n<i.length;n++){var r=i[n];t=t.replace(r,'<span id="credit">'+r.replace(/\*/g,"")+"</span>")}return e&&(t=Fe(t)),t}function Ce(t,e){var n=t.match(/{{(\w+)}}/g);if(n)for(var i=0,r=n;i<r.length;i++){var o=r[i],a=e[o.replace("{{","").replace("}}","")];a=(a=Be(a=Fe(a=Ie(a)))).replace("-","&#8209;"),t=t.replace(o,a)}return t}var De=n(11),Le="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==Le&&Le,Oe="URLSearchParams"in Le,Ne="Symbol"in Le&&"iterator"in Symbol,Ue="FileReader"in Le&&"Blob"in Le&&function(){try{return new Blob,!0}catch(t){return!1}}(),je="FormData"in Le,ze="ArrayBuffer"in Le;if(ze)var Ge=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Ve=ArrayBuffer.isView||function(t){return t&&Ge.indexOf(Object.prototype.toString.call(t))>-1};function He(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||""===t)throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function Ye(t){return"string"!=typeof t&&(t=String(t)),t}function We(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return Ne&&(e[Symbol.iterator]=function(){return e}),e}function qe(t){this.map={},t instanceof qe?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function Xe(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function Je(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function Ze(t){var e=new FileReader,n=Je(e);return e.readAsArrayBuffer(t),n}function Qe(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function Ke(){return this.bodyUsed=!1,this._initBody=function(t){var e;this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:Ue&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:je&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:Oe&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():ze&&Ue&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=Qe(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ze&&(ArrayBuffer.prototype.isPrototypeOf(t)||Ve(t))?this._bodyArrayBuffer=Qe(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Oe&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Ue&&(this.blob=function(){var t=Xe(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=Xe(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(Ze)}),this.text=function(){var t,e,n,i=Xe(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=Je(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},je&&(this.formData=function(){return this.text().then(en)}),this.json=function(){return this.text().then(JSON.parse)},this}qe.prototype.append=function(t,e){t=He(t),e=Ye(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},qe.prototype.delete=function(t){delete this.map[He(t)]},qe.prototype.get=function(t){return t=He(t),this.has(t)?this.map[t]:null},qe.prototype.has=function(t){return this.map.hasOwnProperty(He(t))},qe.prototype.set=function(t,e){this.map[He(t)]=Ye(e)},qe.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},qe.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),We(t)},qe.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),We(t)},qe.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),We(t)},Ne&&(qe.prototype[Symbol.iterator]=qe.prototype.entries);var $e=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function tn(t,e){if(!(this instanceof tn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,i,r=(e=e||{}).body;if(t instanceof tn){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new qe(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new qe(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),$e.indexOf(i)>-1?i:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==e.cache&&"no-cache"!==e.cache)){var o=/([?&])_=[^&]*/;if(o.test(this.url))this.url=this.url.replace(o,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function en(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}})),e}function nn(t,e){if(!(this instanceof nn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"",this.headers=new qe(e.headers),this.url=e.url||"",this._initBody(t)}tn.prototype.clone=function(){return new tn(this,{body:this._bodyInit})},Ke.call(tn.prototype),Ke.call(nn.prototype),nn.prototype.clone=function(){return new nn(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new qe(this.headers),url:this.url})},nn.error=function(){var t=new nn(null,{status:0,statusText:""});return t.type="error",t};var rn=[301,302,303,307,308];nn.redirect=function(t,e){if(-1===rn.indexOf(e))throw new RangeError("Invalid status code");return new nn(null,{status:e,headers:{location:t}})};var on=Le.DOMException;try{new on}catch(t){(on=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack}).prototype=Object.create(Error.prototype),on.prototype.constructor=on}function an(t,e){return new Promise((function(n,i){var r=new tn(t,e);if(r.signal&&r.signal.aborted)return i(new on("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}o.onload=function(){var t,e,i={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new qe,t.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(t){return 0===t.indexOf("\n")?t.substr(1,t.length):t})).forEach((function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();e.append(i,r)}})),e)};i.url="responseURL"in o?o.responseURL:i.headers.get("X-Request-URL");var r="response"in o?o.response:o.responseText;setTimeout((function(){n(new nn(r,i))}),0)},o.onerror=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){i(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){i(new on("Aborted","AbortError"))}),0)},o.open(r.method,function(t){try{return""===t&&Le.location.href?Le.location.href:t}catch(e){return t}}(r.url),!0),"include"===r.credentials?o.withCredentials=!0:"omit"===r.credentials&&(o.withCredentials=!1),"responseType"in o&&(Ue?o.responseType="blob":ze&&r.headers.get("Content-Type")&&-1!==r.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!e||"object"!=typeof e.headers||e.headers instanceof qe?r.headers.forEach((function(t,e){o.setRequestHeader(e,t)})):Object.getOwnPropertyNames(e.headers).forEach((function(t){o.setRequestHeader(t,Ye(e.headers[t]))})),r.signal&&(r.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&r.signal.removeEventListener("abort",a)}),o.send(void 0===r._bodyInit?null:r._bodyInit)}))}an.polyfill=!0,Le.fetch||(Le.fetch=an,Le.Headers=qe,Le.Request=tn,Le.Response=nn);n(40);function sn(t){var e=document.createElement("div");document.body.appendChild(e),e.outerHTML=t}var ln=document.createElement("canvas");ln.style.zIndex="-1",ln.style.position="fixed",ln.style.width="100%",ln.style.height="100%",ln.style.display="block";var un,cn=ln.getContext("webgl",{alpha:!1});if(null!==cn&&(window.AudioContext||window.webkitAudioContext)&&window.Worker&&"object"==typeof WebAssembly){sn(Ce('<div id="splash" class="hideable-unclickable visible"> <div id="intro">{{splash_intro}}</div> <div id="title" class="title"><img id="title-image" src="/blob-opera/logo-2x.png"></div> <div id="tagline">{{splash_description}}</div> <div id="loading" class="loading-visible"> <div id="loading-bar"> <div id="loading-fill"><div id="loading-play">{{button_begin}}</div></div> </div> <div id="audio-prompt">{{splash_sound_hint}}</div> <div id="silent-hint"><span class="material-icons" style="vertical-align:middle">notifications</span>{{splash_silent_hint}}</div> </div> </div> <div id="disclaimer" class="hideable-unclickable visible"> {{disclaimer}} </div> <div id="landscape-warning-overlay"> <div> <div id="landscape-warning-desktop"> <div class="landscape-warning-icon"><span class="material-icons">fullscreen</span></div> <div class="landscape-warning-text">{{landscape_warning_desktop}}</div> </div> <div id="landscape-warning-mobile"> <div class="landscape-warning-icon"><span class="material-icons">screen_rotation</span></div> <div class="landscape-warning-text">{{landscape_warning_mobile}}</div> </div> </div> </div>',ie["en-GB"])),Vt()&&document.getElementById("silent-hint").classList.add("silent-hint-show");var hn=function(){window.innerHeight<400?(zt()?(document.getElementById("landscape-warning-desktop").style.display="none",document.getElementById("landscape-warning-mobile").style.display="block"):(document.getElementById("landscape-warning-mobile").style.display="none",document.getElementById("landscape-warning-desktop").style.display="block"),document.getElementById("landscape-warning-overlay").style.display="flex"):(document.getElementById("landscape-warning-overlay").style.display="none",window.scrollTo(0,1))};window.addEventListener("resize",hn),hn();(function(t,e){for(var n=t.length,i=0,r=0,o=t;r<o.length;r++){o[r].then((function(){e((i+=1)/n)}))}return Promise.all(t)})([Lt(),(un=Object(jt.a)("jittertemplates.proto"),Promise.resolve(De.a).then((function(t){Gt()&&(t.scriptProcessorBufferSize=8192);var e=zt()?0:32e3,n=zt()?24e3:32e3;return qt(un,t,e,n)}))),Object(Nt.a)(Object(jt.a)((Gt(),"squidgylow.msgpack"))),Object(Nt.a)(Object(jt.a)("eye.msgpack")),new Promise((function(t,e){var n=new Worker(Object(jt.a)("harmonizerworker.js"));n.onmessage=function(e){"Loaded"===e.data.type&&t(new Kt(n))}})),function(t){for(var e=[],n=0;n<t;++n)e.push(new Worker(Object(jt.a)("voicenetworker.js")));return Promise.all([Object(Nt.a)(Object(jt.a)("spectral.flat")),Object(Nt.a)(Object(jt.a)("aperiodic.flat"))]).then((function(n){var i=new Uint8Array(n[0]),r=new Uint8Array(n[1]),o={type:"Init",streamCount:Math.ceil(4/t),spectralParametersBuffer:i,aperiodicParametersBuffer:r};return Promise.all(e.map((function(t){return new Promise((function(e,n){t.onmessage=function(n){var i=n.data;i instanceof ArrayBuffer||"Loaded"!==i.type||e(t)},t.postMessage(o)}))})))})).then((function(e){return new $t(t,e)}))}(Gt()?1:4),Object(Nt.b)(Object(jt.a)("background.jpg")),Object(Nt.b)(Object(jt.a)("floorblurred.jpg")),Object(Nt.b)(Object(jt.a)("noise.png")),Object(Nt.a)(Object(jt.a)("recordedlibrettos.proto")),("1"===new URLSearchParams(window.location.search).get("axl")?ke():Promise.resolve(new Me)).then((function(t){var e,n=t.location;return(e=n,"Recording"===e.kind?(new ee).loadRecording(e.recordingID).then((function(t){return{kind:"Recording",recording:t,recordingID:e.recordingID}})).catch((function(t){return{kind:"Default"}})):Promise.resolve({kind:"Default"})).then((function(e){return[t,e]}))}))],(function(t){document.getElementById("loading-fill").style.width=Math.round(100*t).toFixed(0)+"%"})).then((function(t){var e=!1,n=function(){if(!e){e=!0;var n=t[10][0],i=t[10][1];document.body.appendChild(ln),sn(Ce('<div id="skip" class="hideable-clickable"> {{label_skip_tutorial}} &gt; </div> <div id="title-small" class="title hideable-unclickable"><img id="title-small-image" src="/blob-opera/logo-1x.png"></div> <div id="soprano-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_soprano}}</div> <div id="alto-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_mezzo}}</div> <div id="tenor-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_tenor}}</div> <div id="bass-prompt" class="voice-prompt prompt prompt-right-arrow hideable-unclickable">{{prompt_bass}}</div> <div id="pitch-prompt" class="prompt prompt-left-arrow hideable-unclickable">{{prompt_pitch}}&nbsp;<span id="pitch-prompt-pitch"></span></div> <div id="vowel-prompt" class="prompt prompt-bottom-arrow hideable-unclickable">{{prompt_vowel}}&nbsp;<span id="vowel-prompt-vowel"></span></div> <svg style="width:0;height:0;position:absolute;z-index:-1"> <defs> <g id="silence-line"> <line x1="10" y1="10" x2="40" y2="40"></line> </g> <g id="silence-icon"> <path d="\r\n                M 10 20\r\n                L 10 30\r\n                L 19 30\r\n                L 30 40\r\n                L 30 10\r\n                L 19 20\r\n                Z\r\n            " fill="white" stroke="white" stroke-width="1" stroke-linecap="butt" stroke-linejoin="round"/> <path d="\r\n            M 33 20\r\n            A 10 10 0 0 1 33 30\r\n\r\n            M 35 15\r\n            A 15 15 0 0 1 35 35\r\n            " fill="transparent" stroke="white" stroke-width="1.5"></path> </g> </defs> </svg> <div id="soprano-silence" class="silence-button hideable-clickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="silence-line-mask-0" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <use class="silence-line" xlink:href="#silence-line" stroke="black" stroke-width="6"></use> </mask> <use class="silence-line" xlink:href="#silence-line" stroke="white" stroke-width="4"></use> <use mask="url(#silence-line-mask-0)" xlink:href="#silence-icon"></use> </svg> </div> <div id="alto-silence" class="silence-button hideable-clickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="silence-line-mask-1" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <use class="silence-line" xlink:href="#silence-line" stroke="black" stroke-width="6"></use> </mask> <use class="silence-line" xlink:href="#silence-line" stroke="white" stroke-width="4"></use> <use mask="url(#silence-line-mask-1)" xlink:href="#silence-icon"></use> </svg> </div> <div id="tenor-silence" class="silence-button hideable-clickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="silence-line-mask-2" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <use class="silence-line" xlink:href="#silence-line" stroke="black" stroke-width="6"></use> </mask> <use class="silence-line" xlink:href="#silence-line" stroke="white" stroke-width="4"></use> <use mask="url(#silence-line-mask-2)" xlink:href="#silence-icon"></use> </svg> </div> <div id="bass-silence" class="silence-button hideable-clickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="silence-line-mask-3" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <use class="silence-line" xlink:href="#silence-line" stroke="black" stroke-width="6"></use> </mask> <use class="silence-line" xlink:href="#silence-line" stroke="white" stroke-width="4"></use> <use mask="url(#silence-line-mask-3)" xlink:href="#silence-icon"></use> </svg> </div> <div id="record-container" class="button-container hideable-clickable"> <div id="record"> <div id="record-start"></div> </div> <div id="record-text" class="button-text">{{label_record}}</div> </div> <div id="stop-recording-container" class="button-container hideable-clickable recording"> <div id="recording-timecode" class="timecode"></div> <div id="stop-record"> <div id="record-start"></div> </div> <div id="finish-text" class="button-text">{{label_finish}}</div> </div> <div id="stop-recording-prompt" class="prompt prompt-left-arrow hideable-unclickable">{{prompt_stop_recording}}</div> <div id="share-recording-prompt" class="prompt prompt-bottom-arrow share-prompt hideable-unclickable">{{prompt_share}}</div> <div id="share-carol-prompt" class="prompt prompt-bottom-arrow share-prompt hideable-unclickable">{{prompt_share_carol}}</div> <div id="festive-prompt" class="prompt prompt-bottom-arrow hideable-clickable">{{prompt_festive}}</div> <div id="carols-prompt" class="prompt prompt-bottom-arrow hideable-clickable">{{prompt_carols}}</div> <div id="save-container" class="button-container hideable-clickable"> <div id="save" class="button material-icons">share</div> <div id="save-text" class="button-text">{{label_share}}</div> <div id="saving-text" class="button-text">{{label_saving}}</div> </div> <div id="startstop-container" class="button-container hideable-clickable"> <div id="playback-timecode" class="timecode"></div> <svg id="startstop-ring" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 58 58"> <circle class="progress-circle" r="26" cx="29" cy="29" stroke-width="6" stroke="rgba(255, 255, 255, 0.2)" fill="transparent"/> <path class="progress-ring" d="" stroke-width="6" stroke="white" fill="transparent"/> </svg> <div id="startstop" class=""> <div id="startstop-play"></div> <div id="startstop-stop"></div> </div> <div id="play-text" class="button-text">{{label_play}}</div> <div id="stop-text" class="button-text">{{label_stop}}</div> </div> <div id="back-container" class="button-container hideable-clickable"> <div class="button-text">{{label_back}}</div> <div id="back" class="button material-icons">arrow_back</div> </div> <div id="festive-switch-container" class="hideable-clickable"> <label class="switch" id="festive-switch"> <input type="checkbox" name="festive"> <span class="slider round"></span> </label> </div> <div id="festive-playlist" class="festive-button material-icons hideable-clickable">queue_music</div> <div id="play" class="hideable-clickable">{{prompt_in_playback_shared}}</div> <div id="muted-container" class="hideable-unclickable"> <svg width="100%" height="100%" viewBox="-10 -10 70 70" xmlns="http://www.w3.org/2000/svg"> <mask id="line-mask" width="200%"> <rect x="-10" y="-10" width="160" height="100" fill="white"></rect> <line x1="10" y1="10" x2="40" y2="40" stroke="black" stroke-width="4"></line> </mask> <path d="\r\n            M 10 20\r\n            L 10 30\r\n            L 19 30\r\n            L 30 40\r\n            L 30 10\r\n            L 19 20\r\n            Z\r\n        " mask="url(#line-mask)" fill="white" stroke="white" stroke-width="1" stroke-linecap="butt" stroke-linejoin="round"/> <line x1="10" y1="10" x2="40" y2="40" stroke="white" stroke-width="2"></line> <path d="\r\n        M 33 20\r\n        A 10 10 0 0 1 33 30\r\n\r\n        M 35 15\r\n        A 15 15 0 0 1 35 35\r\n        " mask="url(#line-mask)" fill="transparent" stroke="white" stroke-width="1.5"></path> </svg> <div id="muted-text">{{prompt_unmute}}</div> </div> <div id="info" class="hideable-clickable">?</div> <div id="info-overlay" class="hideable-clickable"> <div id="info-container"> <div id="info-title" class="title"><img id="title-small-image" src="/blob-opera/logo-1x.png"></div> <p> {{info_body}} </p> <div id="close-info" class="button material-icons">close</div> </div> </div> <div id="festive-songs-container" class="hideable-clickable prompt-bottom-arrow"> <ul id="festive-songs"></ul> </div> <svg id="recording-frame-top-left" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 0 L 0 0 L 0 1" fill="transparent"></path> </svg> <svg id="recording-frame-top-right" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 0 0 L 1 0 L 1 1" fill="transparent"></path> </svg> <svg id="recording-frame-bottom-left" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 1 L 0 1 L 0 0" fill="transparent"></path> </svg> <svg id="recording-frame-bottom-right" viewbox="0 0 1 1" class="recording-frame-corner hideable-unclickable"> <path d="M 1 0 L 1 1 L 0 1" fill="transparent"></path> </svg> <div id="recording-indicator" class="hideable-unclickable"> <div id="recording-icon"></div>RECORDING </div> <div id="tutorial-prompt-pitch" class="hideable-unclickable tutorial-prompt">{{tutorial_pitch}}</div> <div id="tutorial-prompt-vowel" class="hideable-unclickable tutorial-prompt">{{tutorial_vowel}}</div> <div id="tutorial-prompt-harmonization" class="hideable-unclickable tutorial-prompt">{{tutorial_harmonization}}</div> <div id="tutorial-prompt-mute" class="hideable-unclickable tutorial-prompt">{{tutorial_mute}}</div> <div id="tutorial-prompt-end" class="hideable-unclickable tutorial-prompt">{{tutorial_end}}</div> <div id="timer"></div> <div id="performance-warning" class="hideable-clickable"> <div id="performance-warning-content"> <div id="performance-warning-icon" class="material-icons">warning</div> <div id="performance-warning-text">{{performance_warning}}</div> <div id="performance-warning-dismiss">{{performance_warning_dismiss}}</div> </div> </div>',ie["en-GB"]));var r=t[0],o=t[1],a=Gt()?3:0,s=new Dt(ln,cn,r,new Uint8Array(t[2]),new Uint8Array(t[3]),t[4],t[5],o,t[6],t[7],t[8],new Uint8Array(t[9]),i,o.synthRunner.audioParameters.frameHopSeconds,Gt()?{blobSubdivisions:0}:{blobSubdivisions:1},a),l=(new xe(s,n,i,"en-GB"),document.getElementById("loading"));l.className="loading-hidden",window.setTimeout((function(){l.parentNode.removeChild(l)}),300),n.onFreeze=function(){s.freeze()},n.onResume=function(){s.resume()};var u=function(){s.state===Pt.Playing&&s.stopPlayback(),s.audio.synthRunner.setTimingEnabled(!1)};document.addEventListener("visibilitychange",(function(t){"hidden"===document.visibilityState?u():"visible"===document.visibilityState&&s.audio.synthRunner.setTimingEnabled(!0)})),window.addEventListener("pagehide",u),window.addEventListener("pageshow",(function(){s.audio.synthRunner.setTimingEnabled(!0)})),n.track({action:"launch-experiment"})}},i=function(){t[1].tryUnlock(),n()};Gt()||Vt()?(document.getElementById("loading-bar").className="loading-button",document.getElementById("loading-bar").addEventListener("touchstart",(function(t){t.preventDefault()})),document.getElementById("loading-bar").addEventListener("touchend",i),document.getElementById("loading-bar").addEventListener("click",i)):n()}))}else sn(Ce('<div id="error">Your browser doesn\'t support the required features. Try another browser and/or device!</div>',ie["en-GB"]))}]);